import{Q as I,V as C}from"./three.module.493739a3.js";import{d as b,b as v,g as i,i as g,E as x,h as Q,A as j,u as V}from"./avatarFunctions.6d66cf01.js";import{T as A}from"./SystemUpdateType.772fc25d.js";import{C as y,R as E,p as l,V as S,q as N,t as O,u as P,m as R,N as k,A as T}from"./[projectId].a008d20c.js";import{a as B}from"./AuthService.e8999ddc.js";import{t as D}from"./teleportRigidbody.0bf2d2c0.js";import"./index.7b02be28.js";import"./vendor.475cb2ff.js";import"./upload.bd537b46.js";import"./_app.f0a72417.js";import"./index.81138b53.js";import"./AlertService.5d8abaff.js";import"./feathers.32f4d4e8.js";function q(e){const u=V();R(e).when(k.teleportObject.matches,p=>{const[d,f,m,t,c,o,n]=p.pose,r=u.getNetworkObject(p.networkId),a=i(r,y);if(a){D(a.body,new C(d,f,m),new I(t,c,o,n));return}const s=i(r,T);if(s){const h=i(r,j);s.controller.setPosition(new C(d,f+h.avatarHalfHeight,m)),i(r,S).velocity.setScalar(0)}})}async function $(e,u){const p=b([y]),d=b([E]),f=b([l]),m=b([B,y]);return v.instance.addEventListener(v.EVENTS.ENABLE_SCENE,t=>{typeof t.physics!="undefined"}),e.receptors.add(q),()=>{for(const t of p.exit()){const c=i(t,y);c?.body&&e.physics.removeBody(c.body)}for(const t of d())e.physics.doRaycast(i(t,E));for(const t of p()){const c=i(t,S);if(!c)continue;const o=i(t,y),n=i(t,A),r=i(t,B);if(!(!g&&r.userId!==x.userId||Q(t,j))){if(N(o.body)){const a=o.body,s=a.getGlobalPose();c.velocity.subVectors(s.translation,n.position),s.translation.x=n.position.x,s.translation.y=n.position.y,s.translation.z=n.position.z,s.rotation.x=n.rotation.x,s.rotation.y=n.rotation.y,s.rotation.z=n.rotation.z,s.rotation.w=n.rotation.w,O(o.body)&&a.setKinematicTarget(s),a.setGlobalPose(s,!0)}else if(P(o.body)){const a=o.body,s=a.getLinearVelocity();c.velocity.copy(s);const h=a.getGlobalPose();n.position.copy(h.translation),n.rotation.copy(h.rotation)}}}if(!g)for(const t of m()){const c=i(t,y),o=i(t,A),n=c.body;D(n,o.position,o.rotation)}for(const t of f())i(t,l).collisions=[];for(const t of e.physics.collisionEventQueue){if(t.controllerID){const o=e.physics.controllers.get(t.controllerID).userData;i(o,l).collisions.push(t)}if(t.shapeA){const c=e.physics.bodyIDByShapeID.get(t.shapeA._id),o=e.physics.bodies.get(c),n=e.physics.bodyIDByShapeID.get(t.shapeB._id),r=e.physics.bodies.get(n);if(!o||!r)continue;const a=o.userData?.entity,s=o.userData?.entity;i(a,l).collisions.push({type:t.type,bodySelf:o,bodyOther:r,shapeSelf:t.shapeA,shapeOther:t.shapeB,contacts:t.contacts}),i(s,l).collisions.push({type:t.type,bodySelf:r,bodyOther:o,shapeSelf:t.shapeB,shapeOther:t.shapeA,contacts:t.contacts})}}e.physics.collisionEventQueue=[];for(let t=0;t<e.physics.substeps;t++)e.physics.scene.simulate(e.physics.stepTime/(1e3*e.physics.substeps),!0),e.physics.scene.fetchResults(!0)}}export{$ as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGh5c2ljc1N5c3RlbS5hMDY1MThiOC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZW5naW5lL3NyYy9waHlzaWNzL3N5c3RlbXMvUGh5c2ljc1N5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWZWN0b3IzLCBRdWF0ZXJuaW9uIH0gZnJvbSAndGhyZWUnXG5pbXBvcnQgeyBFbmdpbmVFdmVudHMgfSBmcm9tICcuLi8uLi9lY3MvY2xhc3Nlcy9FbmdpbmVFdmVudHMnXG5pbXBvcnQgeyBkZWZpbmVRdWVyeSwgZ2V0Q29tcG9uZW50LCBoYXNDb21wb25lbnQgfSBmcm9tICcuLi8uLi9lY3MvZnVuY3Rpb25zL0NvbXBvbmVudEZ1bmN0aW9ucydcbmltcG9ydCB7IFRyYW5zZm9ybUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL3RyYW5zZm9ybS9jb21wb25lbnRzL1RyYW5zZm9ybUNvbXBvbmVudCdcbmltcG9ydCB7IENvbGxpZGVyQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9Db2xsaWRlckNvbXBvbmVudCdcbmltcG9ydCB7IE5ldHdvcmtPYmplY3RDb21wb25lbnQgfSBmcm9tICcuLi8uLi9uZXR3b3JraW5nL2NvbXBvbmVudHMvTmV0d29ya09iamVjdENvbXBvbmVudCdcbmltcG9ydCB7IEVuZ2luZSB9IGZyb20gJy4uLy4uL2Vjcy9jbGFzc2VzL0VuZ2luZSdcbmltcG9ydCB7IFZlbG9jaXR5Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50cy9WZWxvY2l0eUNvbXBvbmVudCdcbmltcG9ydCB7IFJheWNhc3RDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL1JheWNhc3RDb21wb25lbnQnXG5pbXBvcnQgeyBSaWdpZEJvZHlUYWdDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL1JpZ2lkQm9keVRhZ0NvbXBvbmVudCdcbmltcG9ydCB7IGlzQ2xpZW50IH0gZnJvbSAnLi4vLi4vY29tbW9uL2Z1bmN0aW9ucy9pc0NsaWVudCdcbmltcG9ydCB7IEF2YXRhckNvbXBvbmVudCB9IGZyb20gJy4uLy4uL2F2YXRhci9jb21wb25lbnRzL0F2YXRhckNvbXBvbmVudCdcbmltcG9ydCB7IE5ldHdvcmtXb3JsZEFjdGlvbiB9IGZyb20gJy4uLy4uL25ldHdvcmtpbmcvZnVuY3Rpb25zL05ldHdvcmtXb3JsZEFjdGlvbidcbmltcG9ydCB7IEF2YXRhckNvbnRyb2xsZXJDb21wb25lbnQgfSBmcm9tICcuLi8uLi9hdmF0YXIvY29tcG9uZW50cy9BdmF0YXJDb250cm9sbGVyQ29tcG9uZW50J1xuaW1wb3J0IHsgU3lzdGVtIH0gZnJvbSAnLi4vLi4vZWNzL2NsYXNzZXMvU3lzdGVtJ1xuaW1wb3J0IHsgV29ybGQgfSBmcm9tICcuLi8uLi9lY3MvY2xhc3Nlcy9Xb3JsZCdcbmltcG9ydCB7IGlzRHluYW1pY0JvZHksIGlzS2luZW1hdGljQm9keSwgaXNTdGF0aWNCb2R5IH0gZnJvbSAnLi4vY2xhc3Nlcy9QaHlzaWNzJ1xuaW1wb3J0IHsgdGVsZXBvcnRSaWdpZGJvZHkgfSBmcm9tICcuLi9mdW5jdGlvbnMvdGVsZXBvcnRSaWdpZGJvZHknXG5pbXBvcnQgeyBDb2xsaXNpb25Db21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnRzL0NvbGxpc2lvbkNvbXBvbmVudCdcbmltcG9ydCBtYXRjaGVzIGZyb20gJ3RzLW1hdGNoZXMnXG5pbXBvcnQgeyB1c2VXb3JsZCB9IGZyb20gJy4uLy4uL2Vjcy9mdW5jdGlvbnMvU3lzdGVtSG9va3MnXG5cbmZ1bmN0aW9uIHBoeXNpY3NBY3Rpb25SZWNlcHRvcihhY3Rpb246IHVua25vd24pIHtcbiAgY29uc3Qgd29ybGQgPSB1c2VXb3JsZCgpXG4gIG1hdGNoZXMoYWN0aW9uKS53aGVuKE5ldHdvcmtXb3JsZEFjdGlvbi50ZWxlcG9ydE9iamVjdC5tYXRjaGVzLCAoYSkgPT4ge1xuICAgIGNvbnN0IFt4LCB5LCB6LCBxWCwgcVksIHFaLCBxV10gPSBhLnBvc2VcbiAgICBjb25zdCBlbnRpdHkgPSB3b3JsZC5nZXROZXR3b3JrT2JqZWN0KGEubmV0d29ya0lkKVxuXG4gICAgY29uc3QgY29sbGlkZXJDb21wb25lbnQgPSBnZXRDb21wb25lbnQoZW50aXR5LCBDb2xsaWRlckNvbXBvbmVudClcbiAgICBpZiAoY29sbGlkZXJDb21wb25lbnQpIHtcbiAgICAgIHRlbGVwb3J0UmlnaWRib2R5KGNvbGxpZGVyQ29tcG9uZW50LmJvZHksIG5ldyBWZWN0b3IzKHgsIHksIHopLCBuZXcgUXVhdGVybmlvbihxWCwgcVksIHFaLCBxVykpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBjb250cm9sbGVyQ29tcG9uZW50ID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQXZhdGFyQ29udHJvbGxlckNvbXBvbmVudClcbiAgICBpZiAoY29udHJvbGxlckNvbXBvbmVudCkge1xuICAgICAgY29uc3QgYXZhdGFyID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQXZhdGFyQ29tcG9uZW50KVxuICAgICAgY29udHJvbGxlckNvbXBvbmVudC5jb250cm9sbGVyLnNldFBvc2l0aW9uKG5ldyBWZWN0b3IzKHgsIHkgKyBhdmF0YXIuYXZhdGFySGFsZkhlaWdodCwgeikpXG4gICAgICBjb25zdCB2ZWxvY2l0eSA9IGdldENvbXBvbmVudChlbnRpdHksIFZlbG9jaXR5Q29tcG9uZW50KVxuICAgICAgdmVsb2NpdHkudmVsb2NpdHkuc2V0U2NhbGFyKDApXG4gICAgfVxuICB9KVxufVxuLyoqXG4gKiBAYXV0aG9yIEh5ZHJhRmlyZSA8Z2l0aHViLmNvbS9IeWRyYUZpcmU+XG4gKiBAYXV0aG9yIEpvc2ggRmllbGQgPGdpdGh1Yi5jb20vSGV4YUZpZWxkPlxuICovXG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIFBoeXNpY3NTeXN0ZW0oXG4gIHdvcmxkOiBXb3JsZCxcbiAgYXR0cmlidXRlczogeyBzaW11bGF0aW9uRW5hYmxlZD86IGJvb2xlYW4gfVxuKTogUHJvbWlzZTxTeXN0ZW0+IHtcbiAgY29uc3QgY29sbGlkZXJRdWVyeSA9IGRlZmluZVF1ZXJ5KFtDb2xsaWRlckNvbXBvbmVudF0pXG4gIGNvbnN0IHJheWNhc3RRdWVyeSA9IGRlZmluZVF1ZXJ5KFtSYXljYXN0Q29tcG9uZW50XSlcbiAgY29uc3QgY29sbGlzaW9uQ29tcG9uZW50ID0gZGVmaW5lUXVlcnkoW0NvbGxpc2lvbkNvbXBvbmVudF0pXG4gIGNvbnN0IG5ldHdvcmtDb2xsaWRlclF1ZXJ5ID0gZGVmaW5lUXVlcnkoW05ldHdvcmtPYmplY3RDb21wb25lbnQsIENvbGxpZGVyQ29tcG9uZW50XSlcblxuICBsZXQgc2ltdWxhdGlvbkVuYWJsZWQgPSB0cnVlXG5cbiAgRW5naW5lRXZlbnRzLmluc3RhbmNlLmFkZEV2ZW50TGlzdGVuZXIoRW5naW5lRXZlbnRzLkVWRU5UUy5FTkFCTEVfU0NFTkUsIChldjogYW55KSA9PiB7XG4gICAgaWYgKHR5cGVvZiBldi5waHlzaWNzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgc2ltdWxhdGlvbkVuYWJsZWQgPSBldi5waHlzaWNzXG4gICAgfVxuICB9KVxuXG4gIHdvcmxkLnJlY2VwdG9ycy5hZGQocGh5c2ljc0FjdGlvblJlY2VwdG9yKVxuXG4gIHJldHVybiAoKSA9PiB7XG4gICAgLy8gZm9yIChjb25zdCBlbnRpdHkgb2Ygc3Bhd25SaWdpZGJvZHlRdWVyeS5lbnRlcigpKSB7XG4gICAgLy8gICBjb25zdCB7IHVuaXF1ZUlkLCBuZXR3b3JrSWQsIHBhcmFtZXRlcnMgfSA9IHJlbW92ZUNvbXBvbmVudChlbnRpdHksIFNwYXduTmV0d29ya09iamVjdENvbXBvbmVudClcblxuICAgIC8vICAgYWRkQ29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50LCB7XG4gICAgLy8gICAgIHBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLmNvcHkocGFyYW1ldGVycy5wb3NpdGlvbiksXG4gICAgLy8gICAgIHJvdGF0aW9uOiBuZXcgUXVhdGVybmlvbigpLmNvcHkocGFyYW1ldGVycy5yb3RhdGlvbiksXG4gICAgLy8gICAgIHNjYWxlOiBuZXcgVmVjdG9yMygxLCAxLCAxKVxuICAgIC8vICAgfSlcblxuICAgIC8vICAgLy8gVE9ETzogZmlndXJlIG91dCBob3cgd2UgYXJlIGdvaW5nIHRvIHNwYXduIHRoZSBib2R5XG5cbiAgICAvLyAgIGlmIChpc0NsaWVudCkge1xuICAgIC8vICAgICBhZGRDb21wb25lbnQoZW50aXR5LCBJbnRlcnBvbGF0aW9uQ29tcG9uZW50LCB7fSlcbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIGRpc3BhdGNoRnJvbVNlcnZlcihOZXR3b3JrV29ybGRBY3Rpb24uY3JlYXRlT2JqZWN0KG5ldHdvcmtJZCwgdW5pcXVlSWQsIFByZWZhYlR5cGUuUmlnaWRCb2R5LCBwYXJhbWV0ZXJzKSlcbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBjb2xsaWRlclF1ZXJ5LmV4aXQoKSkge1xuICAgICAgY29uc3QgY29sbGlkZXJDb21wb25lbnQgPSBnZXRDb21wb25lbnQoZW50aXR5LCBDb2xsaWRlckNvbXBvbmVudClcbiAgICAgIGlmIChjb2xsaWRlckNvbXBvbmVudD8uYm9keSkge1xuICAgICAgICB3b3JsZC5waHlzaWNzLnJlbW92ZUJvZHkoY29sbGlkZXJDb21wb25lbnQuYm9keSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiByYXljYXN0UXVlcnkoKSkge1xuICAgICAgd29ybGQucGh5c2ljcy5kb1JheWNhc3QoZ2V0Q29tcG9uZW50KGVudGl0eSwgUmF5Y2FzdENvbXBvbmVudCkpXG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgY29sbGlkZXJRdWVyeSgpKSB7XG4gICAgICBjb25zdCB2ZWxvY2l0eSA9IGdldENvbXBvbmVudChlbnRpdHksIFZlbG9jaXR5Q29tcG9uZW50KVxuICAgICAgaWYgKCF2ZWxvY2l0eSkgY29udGludWVcbiAgICAgIGNvbnN0IGNvbGxpZGVyID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQ29sbGlkZXJDb21wb25lbnQpXG4gICAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRDb21wb25lbnQoZW50aXR5LCBUcmFuc2Zvcm1Db21wb25lbnQpXG4gICAgICBjb25zdCBuZXR3b3JrID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgTmV0d29ya09iamVjdENvbXBvbmVudClcblxuICAgICAgaWYgKCghaXNDbGllbnQgJiYgbmV0d29yay51c2VySWQgIT09IEVuZ2luZS51c2VySWQpIHx8IGhhc0NvbXBvbmVudChlbnRpdHksIEF2YXRhckNvbXBvbmVudCkpIGNvbnRpbnVlXG5cbiAgICAgIGlmIChpc1N0YXRpY0JvZHkoY29sbGlkZXIuYm9keSkpIHtcbiAgICAgICAgY29uc3QgYm9keSA9IGNvbGxpZGVyLmJvZHkgYXMgUGh5c1guUHhSaWdpZER5bmFtaWNcbiAgICAgICAgY29uc3QgY3VycmVudFBvc2UgPSBib2R5LmdldEdsb2JhbFBvc2UoKVxuXG4gICAgICAgIHZlbG9jaXR5LnZlbG9jaXR5LnN1YlZlY3RvcnMoY3VycmVudFBvc2UudHJhbnNsYXRpb24gYXMgVmVjdG9yMywgdHJhbnNmb3JtLnBvc2l0aW9uKVxuXG4gICAgICAgIGN1cnJlbnRQb3NlLnRyYW5zbGF0aW9uLnggPSB0cmFuc2Zvcm0ucG9zaXRpb24ueFxuICAgICAgICBjdXJyZW50UG9zZS50cmFuc2xhdGlvbi55ID0gdHJhbnNmb3JtLnBvc2l0aW9uLnlcbiAgICAgICAgY3VycmVudFBvc2UudHJhbnNsYXRpb24ueiA9IHRyYW5zZm9ybS5wb3NpdGlvbi56XG4gICAgICAgIGN1cnJlbnRQb3NlLnJvdGF0aW9uLnggPSB0cmFuc2Zvcm0ucm90YXRpb24ueFxuICAgICAgICBjdXJyZW50UG9zZS5yb3RhdGlvbi55ID0gdHJhbnNmb3JtLnJvdGF0aW9uLnlcbiAgICAgICAgY3VycmVudFBvc2Uucm90YXRpb24ueiA9IHRyYW5zZm9ybS5yb3RhdGlvbi56XG4gICAgICAgIGN1cnJlbnRQb3NlLnJvdGF0aW9uLncgPSB0cmFuc2Zvcm0ucm90YXRpb24ud1xuXG4gICAgICAgIGlmIChpc0tpbmVtYXRpY0JvZHkoY29sbGlkZXIuYm9keSkpIHtcbiAgICAgICAgICBib2R5LnNldEtpbmVtYXRpY1RhcmdldChjdXJyZW50UG9zZSlcbiAgICAgICAgfVxuICAgICAgICBib2R5LnNldEdsb2JhbFBvc2UoY3VycmVudFBvc2UsIHRydWUpXG4gICAgICB9IGVsc2UgaWYgKGlzRHluYW1pY0JvZHkoY29sbGlkZXIuYm9keSkpIHtcbiAgICAgICAgY29uc3QgYm9keSA9IGNvbGxpZGVyLmJvZHkgYXMgUGh5c1guUHhSaWdpZER5bmFtaWNcblxuICAgICAgICBjb25zdCBsaW5lYXJWZWxvY2l0eSA9IGJvZHkuZ2V0TGluZWFyVmVsb2NpdHkoKVxuICAgICAgICB2ZWxvY2l0eS52ZWxvY2l0eS5jb3B5KGxpbmVhclZlbG9jaXR5IGFzIFZlY3RvcjMpXG5cbiAgICAgICAgY29uc3QgY3VycmVudFBvc2UgPSBib2R5LmdldEdsb2JhbFBvc2UoKVxuXG4gICAgICAgIHRyYW5zZm9ybS5wb3NpdGlvbi5jb3B5KGN1cnJlbnRQb3NlLnRyYW5zbGF0aW9uIGFzIFZlY3RvcjMpXG5cbiAgICAgICAgdHJhbnNmb3JtLnJvdGF0aW9uLmNvcHkoY3VycmVudFBvc2Uucm90YXRpb24gYXMgUXVhdGVybmlvbilcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIWlzQ2xpZW50KSB7XG4gICAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBuZXR3b3JrQ29sbGlkZXJRdWVyeSgpKSB7XG4gICAgICAgIGNvbnN0IGNvbGxpZGVyID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQ29sbGlkZXJDb21wb25lbnQpXG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IGdldENvbXBvbmVudChlbnRpdHksIFRyYW5zZm9ybUNvbXBvbmVudClcbiAgICAgICAgY29uc3QgYm9keSA9IGNvbGxpZGVyLmJvZHkgYXMgUGh5c1guUHhSaWdpZER5bmFtaWNcbiAgICAgICAgdGVsZXBvcnRSaWdpZGJvZHkoYm9keSwgdHJhbnNmb3JtLnBvc2l0aW9uLCB0cmFuc2Zvcm0ucm90YXRpb24pXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY2xlYXIgY29sbGlzaW9uIGNvbXBvbmVudHNcbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBjb2xsaXNpb25Db21wb25lbnQoKSkge1xuICAgICAgZ2V0Q29tcG9uZW50KGVudGl0eSwgQ29sbGlzaW9uQ29tcG9uZW50KS5jb2xsaXNpb25zID0gW11cbiAgICB9XG5cbiAgICAvLyBwb3B1bGF0ZSBjb2xsaXNpb24gY29tcG9uZW50cyB3aXRoIGV2ZW50cyBvdmVyIGxhc3Qgc2ltdWxhdGlvblxuICAgIGZvciAoY29uc3QgY29sbGlzaW9uRXZlbnQgb2Ygd29ybGQucGh5c2ljcy5jb2xsaXNpb25FdmVudFF1ZXVlKSB7XG4gICAgICBpZiAoY29sbGlzaW9uRXZlbnQuY29udHJvbGxlcklEKSB7XG4gICAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSB3b3JsZC5waHlzaWNzLmNvbnRyb2xsZXJzLmdldChjb2xsaXNpb25FdmVudC5jb250cm9sbGVySUQpXG4gICAgICAgIGNvbnN0IGVudGl0eSA9IChjb250cm9sbGVyIGFzIGFueSkudXNlckRhdGFcbiAgICAgICAgZ2V0Q29tcG9uZW50KGVudGl0eSwgQ29sbGlzaW9uQ29tcG9uZW50KS5jb2xsaXNpb25zLnB1c2goY29sbGlzaW9uRXZlbnQpXG4gICAgICB9XG4gICAgICBpZiAoY29sbGlzaW9uRXZlbnQuc2hhcGVBKSB7XG4gICAgICAgIGNvbnN0IGJvZHlBSUQgPSB3b3JsZC5waHlzaWNzLmJvZHlJREJ5U2hhcGVJRC5nZXQoKGNvbGxpc2lvbkV2ZW50LnNoYXBlQSBhcyBhbnkpLl9pZCkhXG4gICAgICAgIGNvbnN0IGJvZHlBID0gd29ybGQucGh5c2ljcy5ib2RpZXMuZ2V0KGJvZHlBSUQpXG4gICAgICAgIGNvbnN0IGJvZHlCSUQgPSB3b3JsZC5waHlzaWNzLmJvZHlJREJ5U2hhcGVJRC5nZXQoKGNvbGxpc2lvbkV2ZW50LnNoYXBlQiBhcyBhbnkpLl9pZCkhXG4gICAgICAgIGNvbnN0IGJvZHlCID0gd29ybGQucGh5c2ljcy5ib2RpZXMuZ2V0KGJvZHlCSUQpXG4gICAgICAgIGlmICghYm9keUEgfHwgIWJvZHlCKSBjb250aW51ZVxuICAgICAgICBjb25zdCBlbnRpdHlBID0gKGJvZHlBIGFzIGFueSkudXNlckRhdGE/LmVudGl0eVxuICAgICAgICBjb25zdCBlbnRpdHlCID0gKGJvZHlBIGFzIGFueSkudXNlckRhdGE/LmVudGl0eVxuICAgICAgICBnZXRDb21wb25lbnQoZW50aXR5QSwgQ29sbGlzaW9uQ29tcG9uZW50KS5jb2xsaXNpb25zLnB1c2goe1xuICAgICAgICAgIHR5cGU6IGNvbGxpc2lvbkV2ZW50LnR5cGUsXG4gICAgICAgICAgYm9keVNlbGY6IGJvZHlBLFxuICAgICAgICAgIGJvZHlPdGhlcjogYm9keUIsXG4gICAgICAgICAgc2hhcGVTZWxmOiBjb2xsaXNpb25FdmVudC5zaGFwZUEsXG4gICAgICAgICAgc2hhcGVPdGhlcjogY29sbGlzaW9uRXZlbnQuc2hhcGVCLFxuICAgICAgICAgIGNvbnRhY3RzOiBjb2xsaXNpb25FdmVudC5jb250YWN0c1xuICAgICAgICB9KVxuICAgICAgICBnZXRDb21wb25lbnQoZW50aXR5QiwgQ29sbGlzaW9uQ29tcG9uZW50KS5jb2xsaXNpb25zLnB1c2goe1xuICAgICAgICAgIHR5cGU6IGNvbGxpc2lvbkV2ZW50LnR5cGUsXG4gICAgICAgICAgYm9keVNlbGY6IGJvZHlCLFxuICAgICAgICAgIGJvZHlPdGhlcjogYm9keUEsXG4gICAgICAgICAgc2hhcGVTZWxmOiBjb2xsaXNpb25FdmVudC5zaGFwZUIsXG4gICAgICAgICAgc2hhcGVPdGhlcjogY29sbGlzaW9uRXZlbnQuc2hhcGVBLFxuICAgICAgICAgIGNvbnRhY3RzOiBjb2xsaXNpb25FdmVudC5jb250YWN0c1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNsZWFyIGNvbGxpc2lvbiBxdWV1ZVxuICAgIHdvcmxkLnBoeXNpY3MuY29sbGlzaW9uRXZlbnRRdWV1ZSA9IFtdXG5cbiAgICAvLyBzdGVwIHBoeXNpY3Mgd29ybGRcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLnBoeXNpY3Muc3Vic3RlcHM7IGkrKykge1xuICAgICAgd29ybGQucGh5c2ljcy5zY2VuZS5zaW11bGF0ZSh3b3JsZC5waHlzaWNzLnN0ZXBUaW1lIC8gKDEwMDAgKiB3b3JsZC5waHlzaWNzLnN1YnN0ZXBzKSwgdHJ1ZSlcbiAgICAgIHdvcmxkLnBoeXNpY3Muc2NlbmUuZmV0Y2hSZXN1bHRzKHRydWUpXG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjBtQkFzQkEsV0FBK0IsRUFBaUIsTUFDeEMsR0FBUSxNQUNOLEdBQVEsS0FBSyxFQUFtQixlQUFlLFFBQVMsQUFBQyxHQUFNLE1BQy9ELENBQUMsRUFBRyxFQUFHLEVBQUcsRUFBSSxFQUFJLEVBQUksR0FBTSxFQUFFLEtBQzlCLEVBQVMsRUFBTSxpQkFBaUIsRUFBRSxXQUVsQyxFQUFvQixFQUFhLEVBQVEsTUFDM0MsRUFBbUIsR0FDSCxFQUFrQixLQUFNLEdBQUksR0FBUSxFQUFHLEVBQUcsR0FBSSxHQUFJLEdBQVcsRUFBSSxFQUFJLEVBQUksZ0JBSXZGLEdBQXNCLEVBQWEsRUFBUSxNQUM3QyxFQUFxQixNQUNqQixHQUFTLEVBQWEsRUFBUSxLQUNoQixXQUFXLFlBQVksR0FBSSxHQUFRLEVBQUcsRUFBSSxFQUFPLGlCQUFrQixJQUN0RSxFQUFhLEVBQVEsR0FDN0IsU0FBUyxVQUFVLHVCQVVoQyxFQUNBLEVBQ2lCLE1BQ1gsR0FBZ0IsRUFBWSxDQUFDLElBQzdCLEVBQWUsRUFBWSxDQUFDLElBQzVCLEVBQXFCLEVBQVksQ0FBQyxJQUNsQyxFQUF1QixFQUFZLENBQUMsRUFBd0IsYUFJckQsU0FBUyxpQkFBaUIsRUFBYSxPQUFPLGFBQWMsQUFBQyxHQUFZLENBQ2hGLE1BQU8sR0FBRyxT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
