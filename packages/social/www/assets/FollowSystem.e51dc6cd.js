import{p as f}from"./mathUtils.88086a33.js";import{c as l,g as t,a,d as u}from"./avatarFunctions.c7a0e273.js";import{T as j}from"./SystemUpdateType.4e88f289.js";import{c as v,b as C}from"./AutoPilotOverrideComponent.0b4b0ae9.js";import{o as b}from"./three.module.0404e109.js";import{L as m}from"./[projectId].d5e44847.js";import"./AuthService.6db25508.js";import"./_app.009e96ac.js";import"./index.0040ebb6.js";import"./vendor.c8b8cc93.js";import"./upload.38e3baaf.js";import"./index.9af95596.js";import"./AlertService.bfed2141.js";import"./feathers.081246a7.js";const r=l("FollowComponent");function T(n,e){let o=t(e,m);o===void 0&&(o=a(e,m,{})),a(e,v,{overrideCoords:!0,overridePosition:n}),a(e,C,{coords:new b(0,0)})}const g=1,S=10;async function B(n){const e=u([r]);return()=>{for(const o of e(n)){let{targetEid:c,cStep:s,prevTarget:d}=t(o,r);if(s++,t(o,r).cStep=s,s<S)continue;t(o,r).cStep=0;const i=t(c,j);if(i!==void 0){const p=f(i.position,i.rotation,g);p!==d&&(T(p,o),t(o,r).prevTarget=p)}}}}export{B as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRm9sbG93U3lzdGVtLmU1MWRjNmNkLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9lbmdpbmUvc3JjL25hdmlnYXRpb24vY29tcG9uZW50L0ZvbGxvd0NvbXBvbmVudC50cyIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvY29tbW9uL2Z1bmN0aW9ucy9jb21tYW5kSGFuZGxlci50cyIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvbmF2aWdhdGlvbi9zeXN0ZW1zL0ZvbGxvd1N5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWZWN0b3IzIH0gZnJvbSAndGhyZWUnXG5pbXBvcnQgeyBFbnRpdHkgfSBmcm9tICcuLi8uLi9lY3MvY2xhc3Nlcy9FbnRpdHknXG5pbXBvcnQge1xuICBjcmVhdGVNYXBwZWRDb21wb25lbnQsXG4gIGhhc0NvbXBvbmVudCxcbiAgYWRkQ29tcG9uZW50LFxuICBnZXRDb21wb25lbnQsXG4gIHJlbW92ZUNvbXBvbmVudFxufSBmcm9tICcuLi8uLi9lY3MvZnVuY3Rpb25zL0NvbXBvbmVudEZ1bmN0aW9ucydcbmltcG9ydCB7IEF1dG9QaWxvdENvbXBvbmVudCB9IGZyb20gJy4vQXV0b1BpbG90Q29tcG9uZW50J1xuaW1wb3J0IHsgQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudCB9IGZyb20gJy4vQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudCdcblxuZXhwb3J0IHR5cGUgRm9sbG93Q29tcG9uZW50VHlwZSA9IHtcbiAgdGFyZ2V0RWlkOiBFbnRpdHlcbiAgY1N0ZXA6IG51bWJlclxuICBwcmV2VGFyZ2V0OiBWZWN0b3IzXG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVGb2xsb3dDb21wb25lbnQgPSAoZWlkOiBFbnRpdHksIHRhcmdldEVpZDogRW50aXR5KSA9PiB7XG4gIC8vY2hlY2sgaWYgaGFzIGNvbXBvbmVudCwgaWYgc28gdXBkYXRlIGVhcmxpZXIgKGFmdGVyIHRoZSBiaXRlY3MgYnVnKVxuICByZXR1cm4gYWRkQ29tcG9uZW50KGVpZCwgRm9sbG93Q29tcG9uZW50LCB7XG4gICAgdGFyZ2V0RWlkOiB0YXJnZXRFaWQsXG4gICAgY1N0ZXA6IDAsXG4gICAgcHJldlRhcmdldDogbmV3IFZlY3RvcjMoTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIsIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUilcbiAgfSlcbn1cbmV4cG9ydCBjb25zdCByZW1vdmVGb2xsb3dDb21wb25lbnQgPSAoZWlkOiBFbnRpdHkpOiB2b2lkID0+IHtcbiAgaWYgKGhhc0NvbXBvbmVudChlaWQsIEZvbGxvd0NvbXBvbmVudCkpIHtcbiAgICByZW1vdmVDb21wb25lbnQoZWlkLCBGb2xsb3dDb21wb25lbnQpXG4gICAgcmVtb3ZlQ29tcG9uZW50KGVpZCwgQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudClcbiAgICByZW1vdmVDb21wb25lbnQoZWlkLCBBdXRvUGlsb3RDb21wb25lbnQpXG4gIH1cbn1cblxuZXhwb3J0IGNvbnN0IEZvbGxvd0NvbXBvbmVudCA9IGNyZWF0ZU1hcHBlZENvbXBvbmVudDxGb2xsb3dDb21wb25lbnRUeXBlPignRm9sbG93Q29tcG9uZW50JylcbiIsImltcG9ydCB7IFZlY3RvcjMsIFZlY3RvcjIgfSBmcm9tICd0aHJlZSdcbmltcG9ydCB7IEFuaW1hdGlvbkdyYXBoIH0gZnJvbSAnLi4vLi4vYXZhdGFyL2FuaW1hdGlvbnMvQW5pbWF0aW9uR3JhcGgnXG5pbXBvcnQgeyBBdmF0YXJBbmltYXRpb25zLCBBdmF0YXJTdGF0ZXMgfSBmcm9tICcuLi8uLi9hdmF0YXIvYW5pbWF0aW9ucy9VdGlsJ1xuaW1wb3J0IHsgQXZhdGFyQW5pbWF0aW9uQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vYXZhdGFyL2NvbXBvbmVudHMvQXZhdGFyQW5pbWF0aW9uQ29tcG9uZW50J1xuaW1wb3J0IHsgZ2V0Q29tcG9uZW50LCBoYXNDb21wb25lbnQsIGFkZENvbXBvbmVudCB9IGZyb20gJy4uLy4uL2Vjcy9mdW5jdGlvbnMvQ29tcG9uZW50RnVuY3Rpb25zJ1xuaW1wb3J0IHsgTG9jYWxJbnB1dFRhZ0NvbXBvbmVudCB9IGZyb20gJy4uLy4uL2lucHV0L2NvbXBvbmVudHMvTG9jYWxJbnB1dFRhZ0NvbXBvbmVudCdcbmltcG9ydCB7IEF1dG9QaWxvdENsaWNrUmVxdWVzdENvbXBvbmVudCB9IGZyb20gJy4uLy4uL25hdmlnYXRpb24vY29tcG9uZW50L0F1dG9QaWxvdENsaWNrUmVxdWVzdENvbXBvbmVudCdcbmltcG9ydCB7IEF1dG9QaWxvdENvbXBvbmVudCB9IGZyb20gJy4uLy4uL25hdmlnYXRpb24vY29tcG9uZW50L0F1dG9QaWxvdENvbXBvbmVudCdcbmltcG9ydCB7IHJlbW92ZUZvbGxvd0NvbXBvbmVudCwgY3JlYXRlRm9sbG93Q29tcG9uZW50IH0gZnJvbSAnLi4vLi4vbmF2aWdhdGlvbi9jb21wb25lbnQvRm9sbG93Q29tcG9uZW50J1xuaW1wb3J0IHsgc3RvcEF1dG9waWxvdCB9IGZyb20gJy4uLy4uL25hdmlnYXRpb24vZnVuY3Rpb25zL3N0b3BBdXRvcGlsb3QnXG5pbXBvcnQge1xuICBzdWJzY3JpYmVUb0NoYXRTeXN0ZW0sXG4gIHVuc3Vic2NyaWJlRnJvbUNoYXRTeXN0ZW0sXG4gIGdldFN1YnNjcmliZWRDaGF0U3lzdGVtcyxcbiAgcmVtb3ZlTWVzc2FnZVN5c3RlbVxufSBmcm9tICcuLi8uLi9uZXR3b3JraW5nL3V0aWxzL2NoYXRTeXN0ZW0nXG5pbXBvcnQgeyBnZXRSZW1vdGVVc2VycywgZ2V0VXNlckVudGl0eUJ5TmFtZSB9IGZyb20gJy4uLy4uL25ldHdvcmtpbmcvdXRpbHMvZ2V0VXNlcidcbmltcG9ydCB7IFRyYW5zZm9ybUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL3RyYW5zZm9ybS9jb21wb25lbnRzL1RyYW5zZm9ybUNvbXBvbmVudCdcbmltcG9ydCB7IGlzTnVtYmVyIH0gZnJvbSAnQHhyZW5naW5lL2NvbW1vbi9zcmMvdXRpbHMvbWlzY1V0aWxzJ1xuaW1wb3J0IHsgQXV0b1BpbG90T3ZlcnJpZGVDb21wb25lbnQgfSBmcm9tICcuLi8uLi9uYXZpZ2F0aW9uL2NvbXBvbmVudC9BdXRvUGlsb3RPdmVycmlkZUNvbXBvbmVudCdcbmltcG9ydCB7IGlzQm90IH0gZnJvbSAnLi9pc0JvdCdcbmltcG9ydCB7IEVuZ2luZSB9IGZyb20gJy4uLy4uL2Vjcy9jbGFzc2VzL0VuZ2luZSdcbmltcG9ydCB7IGFjY2Vzc0NoYXRTdGF0ZSB9IGZyb20gJ0B4cmVuZ2luZS9jbGllbnQtY29yZS9zcmMvc29jaWFsL3JlZHVjZXJzL2NoYXQvQ2hhdFN0YXRlJ1xuaW1wb3J0IHsgRW50aXR5IH0gZnJvbSAnLi4vLi4vZWNzL2NsYXNzZXMvRW50aXR5J1xuaW1wb3J0IHsgTmV0d29yayB9IGZyb20gJy4uLy4uL25ldHdvcmtpbmcvY2xhc3Nlcy9OZXR3b3JrJ1xuaW1wb3J0IHsgVXNlcklkIH0gZnJvbSAnQHhyZW5naW5lL2NvbW1vbi9zcmMvaW50ZXJmYWNlcy9Vc2VySWQnXG5cbi8vVGhlIHZhbHVlcyB0aGUgY29tbWFuZHMgdGhhdCBtdXN0IGhhdmUgaW4gdGhlIHN0YXJ0XG5leHBvcnQgY29uc3QgY29tbWFuZFN0YXJ0ZXJzID0gWycvJywgJy8vJ11cblxuLy9DaGVja3MgaWYgYSB0ZXh0IChzdHJpbmcpIGlzIGEgY29tbWFuZFxuZXhwb3J0IGZ1bmN0aW9uIGlzQ29tbWFuZCh0ZXh0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21tYW5kU3RhcnRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICBpZiAodGV4dC5zdGFydHNXaXRoKGNvbW1hbmRTdGFydGVyc1tpXSkpIHJldHVybiB0cnVlXG4gIH1cblxuICByZXR1cm4gZmFsc2Vcbn1cbi8vR2V0IHRoZSBjb3VudCBvZiB0aGUgY29tbWFuZCBpbml0IHZhbHVlXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhcnRlckNvdW50KHRleHQ6IHN0cmluZyk6IG51bWJlciB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgY29tbWFuZFN0YXJ0ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKHRleHQuc3RhcnRzV2l0aChjb21tYW5kU3RhcnRlcnNbaV0pKSByZXR1cm4gY29tbWFuZFN0YXJ0ZXJzW2ldLmxlbmd0aFxuICB9XG5cbiAgcmV0dXJuIDBcbn1cblxuLyoqXG4gKiBIYW5kbGVzIGEgY29tbWFuZCwgdGhlIGlucHV0IGlzIHNlbnQgYm90aCBmcm9tIHNlcnZlciBhbmQgY2xpZW50LCBlYWNoIG9uZSBjYW4gaGFuZGxlIGl0IGRpZmZlcmVudGx5XG4gKiBUaGUgcmV0dXJuIHZhbHVlIGlzIGJvb2xlYW4gKHRydWUvZmFsc2UpLCBpZiBpdCByZXR1cm5zIHRydWUgdGhlIGNhbGxlciBmdW5jdGlvbiB3aWxsIHRlcm1pbmF0ZSwgb3RoZXJ3aXNlIGl0IHdpbGwgY29udGludWVcbiAqIEZpcnN0IGl0IGlzIGNhbGxlZCBpbiB0aGUgc2VydmVyIGFuZCB0aGVuIGluIHRoZSBjbGllbnRcbiAqIFRoZSBlbnRpdHkgaW4gdGhlIHNlcnZlciBpcyB0aGUgVXNlcklkLCB3aGlsZSBpbiB0aGUgY2xpZW50IGlzIHRoZSBFbnRpdHlJZFxuICogQGF1dGhvciBBbGV4IFRpdG9uaXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUNvbW1hbmQoY21kOiBzdHJpbmcsIGVudGl0eTogRW50aXR5LCB1c2VySWQ6IFVzZXJJZCk6IGJvb2xlYW4ge1xuICAvL0l0IGNoZWNrcyBmb3IgYWxsIG1lc3NhZ2VzLCB0aGUgZGVmYXVsdFxuICBpZiAoIWlzQ29tbWFuZChjbWQpKSByZXR1cm4gZmFsc2VcblxuICAvL1JlbW92ZSB0aGUgY29tbWFuZCBzdGFydGVyLCBnZXQgdGhlIGRhdGEgKHRoZSBiYXNlIHdoaWNoIGlzIHRoZSBjb21tYW5kIGFuZCB0aGUgcGFyYW1ldGVycyBpZiBleGlzdCwgcGFyYW1ldGVycyBhcmUgc2VwYXJhdGVkIGJ5ICwgKGNvbW1hcykpXG4gIGNtZCA9IGNtZC5zdWJzdHJpbmcoZ2V0U3RhcnRlckNvdW50KGNtZCkpXG4gIGxldCBkYXRhID0gY21kLnNwbGl0KCcgJylcbiAgbGV0IGJhc2UgPSBkYXRhWzBdXG4gIGxldCBwYXJhbXMgPSBkYXRhLmxlbmd0aCA9PSAyID8gZGF0YVsxXS5zcGxpdCgnLCcpIDogJydcblxuICAvL0hhbmRsZSB0aGUgY29tbWFuZCBhY2NvcmRpbmcgdG8gdGhlIGJhc2VcbiAgc3dpdGNoIChiYXNlKSB7XG4gICAgY2FzZSAnbW92ZSc6IHtcbiAgICAgIGlmIChwYXJhbXMubGVuZ3RoIDwgMykge1xuICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBtb3ZlIGNvbW1hbmQgLSBwYXJhbXMgbGVuZ3RoICgnICsgcGFyYW1zLmxlbmd0aCArICcpICcgKyBwYXJhbXMpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHggPSBwYXJzZUZsb2F0KHBhcmFtc1swXSlcbiAgICAgIGNvbnN0IHkgPSBwYXJzZUZsb2F0KHBhcmFtc1sxXSlcbiAgICAgIGNvbnN0IHogPSBwYXJzZUZsb2F0KHBhcmFtc1syXSlcblxuICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCB8fCB5ID09PSB1bmRlZmluZWQgfHwgeiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnZhbGlkIG1vdmUgY29tbWFuZCAtIHBhcmFtczogJyArIHBhcmFtcylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgaGFuZGxlTW92ZUNvbW1hbmQoeCwgeSwgeiwgZW50aXR5KVxuXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gICAgY2FzZSAnbWV0YWRhdGEnOiB7XG4gICAgICAvL1RoaXMgY29tbWFuZCBpcyBoYW5kbGVkIG9ubHkgaW4gdGhlIGNsaWVudCBhbmQgb25seSBpZiB0aGUgY2FsbGVyIGlzIGEgYm90XG4gICAgICBpZiAoIUVuZ2luZS5pc0JvdCAmJiAhaXNCb3Qod2luZG93KSkgcmV0dXJuIHRydWVcblxuICAgICAgLy9UaGUgcGFyYW1zIG11c3QgZWl0aGVyIGJlIDEgb3IgMiwgaWYgaXQgaXMgc2NlbmUsIHRoZW4gMSBvdGhlciB3aXNlIDIgLSB3b3JsZCwgbWF4IGRpc3RhbmNlXG4gICAgICBpZiAocGFyYW1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKHBhcmFtc1swXSA9PT0gJ3dvcmxkJyAmJiBwYXJhbXMubGVuZ3RoICE9IDIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBwYXJhbXMsIGF2YWlsYWJsZSBwYXJhbXMsIHNjZW5lIG9yIHdvcmxkLGRpc3RhbmNlIChmbG9hdCknKVxuICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSByZXR1cm4gdHJ1ZVxuXG4gICAgICBoYW5kbGVNZXRhZGF0YUNvbW1hbmQocGFyYW1zLCBlbnRpdHkpXG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGNhc2UgJ2dvVG8nOiB7XG4gICAgICBpZiAoIUVuZ2luZS5pc0JvdCAmJiAhaXNCb3Qod2luZG93KSkgcmV0dXJuIHRydWVcblxuICAgICAgaWYgKHBhcmFtcy5sZW5ndGggIT0gMSkge1xuICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBwYXJhbXMsIGl0IHNob3VsZCBiZSAvZ29UbyBsYW5kbWFyaycpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGhhbmRsZUdvVG9Db21tYW5kKHBhcmFtc1swXSwgZW50aXR5KVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdlbW90ZSc6IHtcbiAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnZhbGlkIHBhcmFtcywgaXQgc2hvdWxkIGJlIC9lbW90ZSBlbW90ZV9uYW1lJylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgaGFuZGxlRW1vdGVDb21tYW5kKHBhcmFtc1swXSwgZW50aXR5KVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdzdWJzY3JpYmUnOiB7XG4gICAgICBpZiAocGFyYW1zLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBwYXJhbXMsIGl0IHNob3VsZCBiZSAvc3Vic2NyaWJlIGNoYXRfc3lzdGVtIChlbW90aW9uc19zeXN0ZW0sIGFsbCknKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICBoYW5kbGVTdWJzY3JpYmVUb0NoYXRTeXN0ZW1Db21tYW5kKHBhcmFtc1swXSwgdXNlcklkKVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICd1bnN1YnNjcmliZSc6IHtcbiAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnZhbGlkIHBhcmFtcywgaXQgc2hvdWxkIGJlIC91bnN1YnNjcmliZSBjaGF0X3N5c3RlbSAoZW1vdGlvbnNfc3lzdGVtIGFsbCknKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICBoYW5kbGVVbnN1YnNjcmliZUZyb21DaGF0U3lzdGVtQ29tbWFuZChwYXJhbXNbMF0sIHVzZXJJZClcblxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgY2FzZSAnZ2V0U3Vic2NyaWJlZCc6IHtcbiAgICAgIGhhbmRsZUdldFN1YnNjcmliZWRDaGF0U3lzdGVtc0NvbW1hbmQodXNlcklkKVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdmYWNlJzoge1xuICAgICAgaWYgKHBhcmFtcy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ludmFsaWQgcGFyYW1zJylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgaGFuZGxlRmFjZUNvbW1hbmQocGFyYW1zWzBdLCBlbnRpdHkpXG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGNhc2UgJ2dldFBvc2l0aW9uJzoge1xuICAgICAgaWYgKHBhcmFtcy5sZW5ndGggIT09IDEpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ludmFsaWQgcGFyYW1zJylcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cblxuICAgICAgaGFuZGxlR2V0UG9zaXRpb25Db21tYW5kKHBhcmFtc1swXSlcblxuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gICAgY2FzZSAnZ2V0Um90YXRpb24nOiB7XG4gICAgICBpZiAocGFyYW1zLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBwYXJhbXMnKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICBoYW5kbGVHZXRSb3RhdGlvbkNvbW1hbmQocGFyYW1zWzBdKVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdnZXRTY2FsZSc6IHtcbiAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnZhbGlkIHBhcmFtcycpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGhhbmRsZUdldFNjYWxlQ29tbWFuZChwYXJhbXNbMF0pXG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGNhc2UgJ2dldFRyYW5zZm9ybSc6IHtcbiAgICAgIGlmIChwYXJhbXMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdpbnZhbGlkIHBhcmFtcycpXG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9XG5cbiAgICAgIGhhbmRsZUdldFRyYW5zZm9ybUNvbW1hbmQocGFyYW1zWzBdKVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdmb2xsb3cnOiB7XG4gICAgICBpZiAocGFyYW1zLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICBjb25zb2xlLmxvZygnaW52YWxpZCBwYXJhbXMnKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICBoYW5kbGVGb2xsb3dDb21tYW5kKHBhcmFtc1swXSwgZW50aXR5KVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdnZXRDaGF0SGlzdG9yeSc6IHtcbiAgICAgIGhhbmRsZUdldENoYXRIaXN0b3J5Q29tbWFuZCgpXG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGNhc2UgJ2xpc3RBbGx1c2Vycyc6IHtcbiAgICAgIGhhbmRsZUxpc3RBbGxVc2Vyc0NvbW1hbmQodXNlcklkKVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgICBjYXNlICdnZXRMb2NhbFVzZXJJZCc6IHtcbiAgICAgIGlmICghaXNCb3Qod2luZG93KSkgcmV0dXJuIGZhbHNlXG5cbiAgICAgIGhhbmRsZUdldExvY2FsVXNlcklkQ29tbWFuZCh1c2VySWQpXG5cbiAgICAgIHJldHVybiB0cnVlXG4gICAgfVxuICAgIGRlZmF1bHQ6IHtcbiAgICAgIGNvbnNvbGUubG9nKCd1bmtub3duIGNvbW1hbmQ6ICcgKyBiYXNlICsgJyBwYXJhbXM6ICcgKyAocGFyYW1zID09PSAnJyA/ICdub25lJyA6IHBhcmFtcykpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cbn1cblxuLy9DcmVhdGUgZmFrZSBpbnB1dCBvbiB0aGUgbWFwIChsaWtlIGxlZnQgY2xpY2spIHdpdGggdGhlIGNvb3JkaW5hdGVzIHdyaXR0ZW4gYW5kIGltcGxlbWVudCB0aGUgYXV0byBwaWxvdCBjbGljayByZXF1ZXN0IGNvbXBvbmVudCB0byB0aGUgcGxheWVyXG5mdW5jdGlvbiBoYW5kbGVNb3ZlQ29tbWFuZCh4OiBudW1iZXIsIHk6IG51bWJlciwgejogbnVtYmVyLCBlbnRpdHk6IGFueSkge1xuICBnb1RvKG5ldyBWZWN0b3IzKHgsIHksIHopLCBlbnRpdHkpXG4gIC8qbGV0IGxpbnB1dCA9IGdldENvbXBvbmVudChlbnRpdHksIExvY2FsSW5wdXRUYWdDb21wb25lbnQpXG4gIGlmIChsaW5wdXQgPT09IHVuZGVmaW5lZCkgbGlucHV0ID0gYWRkQ29tcG9uZW50KGVudGl0eSwgTG9jYWxJbnB1dFRhZ0NvbXBvbmVudCwge30pXG4gIGFkZENvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdENsaWNrUmVxdWVzdENvbXBvbmVudCwgeyBjb29yZHM6IG5ldyBWZWN0b3IyKHgsIHopIH0pKi9cbn1cblxuZnVuY3Rpb24gaGFuZGxlTWV0YWRhdGFDb21tYW5kKHBhcmFtczogYW55LCBlbnRpdHk6IGFueSkge1xuICBpZiAocGFyYW1zWzBdID09PSAnc2NlbmUnKSB7XG4gICAgY29uc29sZS5sb2coJ3NjZW5lX21ldGFkYXRhfCcgKyBFbmdpbmUuZGVmYXVsdFdvcmxkLnNjZW5lTWV0YWRhdGEpXG4gIH0gZWxzZSB7XG4gICAgY29uc3QgcG9zaXRpb24gPSBnZXRDb21wb25lbnQoZW50aXR5LCBUcmFuc2Zvcm1Db21wb25lbnQpLnBvc2l0aW9uXG4gICAgY29uc3QgbWF4RGlzdGFuY2U6IG51bWJlciA9IHBhcnNlRmxvYXQocGFyYW1zWzFdKVxuICAgIGxldCB2ZWN0b3I6IFZlY3RvcjNcbiAgICBsZXQgZGlzdGFuY2U6IG51bWJlciA9IDBcblxuICAgIGZvciAobGV0IGkgaW4gRW5naW5lLmRlZmF1bHRXb3JsZC53b3JsZE1ldGFkYXRhKSB7XG4gICAgICB2ZWN0b3IgPSBnZXRNZXRhZGF0YVBvc2l0aW9uKEVuZ2luZS5kZWZhdWx0V29ybGQud29ybGRNZXRhZGF0YVtpXSlcblxuICAgICAgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKHZlY3RvcilcbiAgICAgIGlmIChkaXN0YW5jZSA+IG1heERpc3RhbmNlKSBjb250aW51ZVxuICAgICAgZWxzZSBjb25zb2xlLmxvZygnbWV0YWRhdGF8JyArIHZlY3Rvci54ICsgJywnICsgdmVjdG9yLnkgKyAnLCcgKyB2ZWN0b3IueiArICd8JyArIGkpXG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUdvVG9Db21tYW5kKGxhbmRtYXJrOiBzdHJpbmcsIGVudGl0eTogYW55KSB7XG4gIGNvbnN0IHBvc2l0aW9uID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KS5wb3NpdGlvblxuICBsZXQgbmVhcmVzdDogVmVjdG9yMyA9IHVuZGVmaW5lZCFcbiAgbGV0IGRpc3RhbmNlOiBudW1iZXIgPSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUlxuICBsZXQgY0Rpc3RhbmNlOiBudW1iZXIgPSAwXG4gIGxldCB2ZWN0b3I6IFZlY3RvcjNcblxuICBmb3IgKGxldCBpIGluIEVuZ2luZS5kZWZhdWx0V29ybGQud29ybGRNZXRhZGF0YSkge1xuICAgIGlmIChpID09PSBsYW5kbWFyaykge1xuICAgICAgdmVjdG9yID0gZ2V0TWV0YWRhdGFQb3NpdGlvbihFbmdpbmUuZGVmYXVsdFdvcmxkLndvcmxkTWV0YWRhdGFbaV0pXG4gICAgICBjRGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKHZlY3RvcilcblxuICAgICAgaWYgKGNEaXN0YW5jZSA8IGRpc3RhbmNlKSB7XG4gICAgICAgIGRpc3RhbmNlID0gY0Rpc3RhbmNlXG4gICAgICAgIG5lYXJlc3QgPSB2ZWN0b3JcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb25zb2xlLmxvZygnZ29UbzogJyArIGxhbmRtYXJrICsgJyBuZWFyZXN0OiAnICsgSlNPTi5zdHJpbmdpZnkobmVhcmVzdCkpXG4gIGlmIChuZWFyZXN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICBnb1RvKG5lYXJlc3QsIGVudGl0eSlcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVFbW90ZUNvbW1hbmQoZW1vdGU6IHN0cmluZywgZW50aXR5OiBhbnkpIHtcbiAgc3dpdGNoIChlbW90ZSkge1xuICAgIGNhc2UgJ2RhbmNlMSc6XG4gICAgICBydW5BbmltYXRpb24oZW50aXR5LCBBdmF0YXJTdGF0ZXMuTE9PUEFCTEVfRU1PVEUsIHsgYW5pbWF0aW9uTmFtZTogQXZhdGFyQW5pbWF0aW9ucy5EQU5DSU5HXzEgfSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnZGFuY2UyJzpcbiAgICAgIHJ1bkFuaW1hdGlvbihlbnRpdHksIEF2YXRhclN0YXRlcy5MT09QQUJMRV9FTU9URSwgeyBhbmltYXRpb25OYW1lOiBBdmF0YXJBbmltYXRpb25zLkRBTkNJTkdfMiB9KVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdkYW5jZTMnOlxuICAgICAgcnVuQW5pbWF0aW9uKGVudGl0eSwgQXZhdGFyU3RhdGVzLkxPT1BBQkxFX0VNT1RFLCB7IGFuaW1hdGlvbk5hbWU6IEF2YXRhckFuaW1hdGlvbnMuREFOQ0lOR18zIH0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2RhbmNlNCc6XG4gICAgICBydW5BbmltYXRpb24oZW50aXR5LCBBdmF0YXJTdGF0ZXMuTE9PUEFCTEVfRU1PVEUsIHsgYW5pbWF0aW9uTmFtZTogQXZhdGFyQW5pbWF0aW9ucy5EQU5DSU5HXzQgfSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnY2xhcCc6XG4gICAgICBydW5BbmltYXRpb24oZW50aXR5LCBBdmF0YXJTdGF0ZXMuRU1PVEUsIHsgYW5pbWF0aW9uTmFtZTogQXZhdGFyQW5pbWF0aW9ucy5DTEFQIH0pXG4gICAgICBicmVha1xuICAgIGNhc2UgJ2NyeSc6XG4gICAgICBydW5BbmltYXRpb24oZW50aXR5LCBBdmF0YXJTdGF0ZXMuRU1PVEUsIHsgYW5pbWF0aW9uTmFtZTogQXZhdGFyQW5pbWF0aW9ucy5DUlkgfSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnbGF1Z2gnOlxuICAgICAgcnVuQW5pbWF0aW9uKGVudGl0eSwgQXZhdGFyU3RhdGVzLkVNT1RFLCB7IGFuaW1hdGlvbk5hbWU6IEF2YXRhckFuaW1hdGlvbnMuTEFVR0ggfSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnc2FkJzpcbiAgICAgIHJ1bkFuaW1hdGlvbihlbnRpdHksIEF2YXRhclN0YXRlcy5FTU9URSwgeyBhbmltYXRpb25OYW1lOiBBdmF0YXJBbmltYXRpb25zLkNSWSB9KVxuICAgICAgYnJlYWtcbiAgICBjYXNlICdraXNzJzpcbiAgICAgIHJ1bkFuaW1hdGlvbihlbnRpdHksIEF2YXRhclN0YXRlcy5FTU9URSwgeyBhbmltYXRpb25OYW1lOiBBdmF0YXJBbmltYXRpb25zLktJU1MgfSlcbiAgICAgIGJyZWFrXG4gICAgY2FzZSAnd2F2ZSc6XG4gICAgICBydW5BbmltYXRpb24oZW50aXR5LCBBdmF0YXJTdGF0ZXMuRU1PVEUsIHsgYW5pbWF0aW9uTmFtZTogQXZhdGFyQW5pbWF0aW9ucy5XQVZFIH0pXG4gICAgICBicmVha1xuICAgIGRlZmF1bHQ6XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgJ2Vtb3RlOiAnICsgZW1vdGUgKyAnIG5vdCBmb3VuZCwgYXZhaWxhYmxlOiBkYW5jZTEsIGRhbmNlMiwgZGFuY2UzLCBkYW5jZTQsIGNsYXAsIGNyeSwgbGF1Z2gsIHNhZCwga2lzcywgd2F2ZSdcbiAgICAgIClcbiAgfVxufVxuZnVuY3Rpb24gaGFuZGxlU3Vic2NyaWJlVG9DaGF0U3lzdGVtQ29tbWFuZChzeXN0ZW06IHN0cmluZywgdXNlcklkOiBhbnkpIHtcbiAgc3Vic2NyaWJlVG9DaGF0U3lzdGVtKHVzZXJJZCwgc3lzdGVtKVxufVxuZnVuY3Rpb24gaGFuZGxlVW5zdWJzY3JpYmVGcm9tQ2hhdFN5c3RlbUNvbW1hbmQoc3lzdGVtOiBzdHJpbmcsIHVzZXJJZDogYW55KSB7XG4gIHVuc3Vic2NyaWJlRnJvbUNoYXRTeXN0ZW0odXNlcklkLCBzeXN0ZW0pXG59XG5hc3luYyBmdW5jdGlvbiBoYW5kbGVHZXRTdWJzY3JpYmVkQ2hhdFN5c3RlbXNDb21tYW5kKHVzZXJJZDogYW55KSB7XG4gIGNvbnN0IHN5c3RlbXM6IHN0cmluZ1tdID0gZ2V0U3Vic2NyaWJlZENoYXRTeXN0ZW1zKHVzZXJJZClcbiAgY29uc29sZS5sb2coc3lzdGVtcylcbn1cblxuZnVuY3Rpb24gaGFuZGxlRmFjZUNvbW1hbmQoZmFjZTogc3RyaW5nLCBlbnRpdHk6IGFueSkge1xuICBpZiAoZmFjZSA9PT0gdW5kZWZpbmVkIHx8IGZhY2UgPT09ICcnKSByZXR1cm5cblxuICBjb25zdCBmYWNlcyA9IGZhY2Uuc3BsaXQoJyAnKVxuICBpZiAoZmFjZXMubGVuZ3RoID09IDApIHJldHVyblxuICBsZXQgdGltZTogbnVtYmVyID0gMFxuICBpZiAoZmFjZXMubGVuZ3RoID4gMSkge1xuICAgIGlmIChpc051bWJlcihmYWNlc1tmYWNlcy5sZW5ndGggLSAxXSkpIHtcbiAgICAgIHRpbWUgPSBwYXJzZUZsb2F0KGZhY2VzW2ZhY2VzLmxlbmd0aCAtIDFdKVxuICAgICAgZmFjZXMuc3BsaWNlKGZhY2VzLmxlbmd0aCAtIDEsIDEpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgX2ZhY2VzID0gW11cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBmYWNlcy5sZW5ndGg7IGkgKz0gMikge1xuICAgIGNvbnN0IGZhY2VEYXRhID0gZmFjZXNbaV1cbiAgICBjb25zdCBmYWNlUGVyYyA9IGZhY2VzW2kgKyAxXVxuICAgIF9mYWNlc1tmYWNlRGF0YV0gPSBmYWNlUGVyY1xuICB9XG5cbiAgLy9oYW5kbGUgZmFjZVxufVxuXG5mdW5jdGlvbiBoYW5kbGVHZXRQb3NpdGlvbkNvbW1hbmQocGxheWVyOiBzdHJpbmcpIHtcbiAgaWYgKHBsYXllciA9PT0gdW5kZWZpbmVkIHx8IHBsYXllciA9PT0gJycpIHJldHVyblxuXG4gIGNvbnN0IGVudGl0eSA9IGdldFVzZXJFbnRpdHlCeU5hbWUocGxheWVyKVxuICBpZiAoZW50aXR5ID09PSB1bmRlZmluZWQpIHtcbiAgICBjb25zb2xlLmxvZygndW5kZWZpZW5kIGVudGl0eScpXG4gICAgcmV0dXJuXG4gIH1cblxuICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRDb21wb25lbnQoZW50aXR5LCBUcmFuc2Zvcm1Db21wb25lbnQpXG4gIGlmICh0cmFuc2Zvcm0gPT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnNvbGUubG9nKCd1bmRlZmluZWQnKVxuICAgIHJldHVyblxuICB9XG5cbiAgY29uc29sZS5sb2cocGxheWVyICsgJyBwb3NpdGlvbjogJyArIEpTT04uc3RyaW5naWZ5KHRyYW5zZm9ybS5wb3NpdGlvbikpXG59XG5cbmZ1bmN0aW9uIGhhbmRsZUdldFJvdGF0aW9uQ29tbWFuZChwbGF5ZXI6IHN0cmluZykge1xuICBpZiAocGxheWVyID09PSB1bmRlZmluZWQgfHwgcGxheWVyID09PSAnJykgcmV0dXJuXG5cbiAgY29uc3QgZW50aXR5ID0gZ2V0VXNlckVudGl0eUJ5TmFtZShwbGF5ZXIpXG4gIGlmIChlbnRpdHkgPT09IHVuZGVmaW5lZCkgcmV0dXJuXG5cbiAgY29uc3QgdHJhbnNmb3JtID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICBpZiAodHJhbnNmb3JtID09PSB1bmRlZmluZWQpIHJldHVyblxuXG4gIGNvbnNvbGUubG9nKHBsYXllciArICcgcm90YXRpb246ICcgKyBKU09OLnN0cmluZ2lmeSh0cmFuc2Zvcm0ucm90YXRpb24pKVxufVxuXG5mdW5jdGlvbiBoYW5kbGVHZXRTY2FsZUNvbW1hbmQocGxheWVyOiBzdHJpbmcpIHtcbiAgaWYgKHBsYXllciA9PT0gdW5kZWZpbmVkIHx8IHBsYXllciA9PT0gJycpIHJldHVyblxuXG4gIGNvbnN0IGVudGl0eSA9IGdldFVzZXJFbnRpdHlCeU5hbWUocGxheWVyKVxuICBpZiAoZW50aXR5ID09PSB1bmRlZmluZWQpIHJldHVyblxuXG4gIGNvbnN0IHRyYW5zZm9ybSA9IGdldENvbXBvbmVudChlbnRpdHksIFRyYW5zZm9ybUNvbXBvbmVudClcbiAgaWYgKHRyYW5zZm9ybSA9PT0gdW5kZWZpbmVkKSByZXR1cm5cblxuICBjb25zb2xlLmxvZyhwbGF5ZXIgKyAnIHNjYWxlOiAnICsgSlNPTi5zdHJpbmdpZnkodHJhbnNmb3JtLnNjYWxlKSlcbn1cblxuZnVuY3Rpb24gaGFuZGxlR2V0VHJhbnNmb3JtQ29tbWFuZChwbGF5ZXI6IHN0cmluZykge1xuICBpZiAocGxheWVyID09PSB1bmRlZmluZWQgfHwgcGxheWVyID09PSAnJykgcmV0dXJuXG5cbiAgY29uc3QgZW50aXR5ID0gZ2V0VXNlckVudGl0eUJ5TmFtZShwbGF5ZXIpXG4gIGlmIChlbnRpdHkgPT09IHVuZGVmaW5lZCkgcmV0dXJuXG5cbiAgY29uc3QgdHJhbnNmb3JtID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICBpZiAodHJhbnNmb3JtID09PSB1bmRlZmluZWQpIHJldHVyblxuXG4gIGNvbnNvbGUubG9nKHBsYXllciArICcgdHJhbnNmb3JtOiAnICsgSlNPTi5zdHJpbmdpZnkodHJhbnNmb3JtKSlcbn1cbmZ1bmN0aW9uIGhhbmRsZUZvbGxvd0NvbW1hbmQocGFyYW06IHN0cmluZywgZW50aXR5OiBFbnRpdHkpIHtcbiAgaWYgKHBhcmFtID09PSAnc3RvcCcpIHtcbiAgICByZW1vdmVGb2xsb3dDb21wb25lbnQoZW50aXR5KVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IHRhcmdldEVudGl0eSA9IGdldFVzZXJFbnRpdHlCeU5hbWUocGFyYW0pXG4gICAgY29uc29sZS5sb2coJ2ZvbGxvdyB0YXJnZXQgZW50aXR5OiAnICsgdGFyZ2V0RW50aXR5KVxuICAgIGlmICh0YXJnZXRFbnRpdHkgPT09IHVuZGVmaW5lZCB8fCBlbnRpdHkgPT09IHRhcmdldEVudGl0eSkgcmV0dXJuXG4gICAgY3JlYXRlRm9sbG93Q29tcG9uZW50KGVudGl0eSwgdGFyZ2V0RW50aXR5KVxuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUdldENoYXRIaXN0b3J5Q29tbWFuZCgpIHtcbiAgY29uc3QgY2hhdFN0YXRlID0gYWNjZXNzQ2hhdFN0YXRlKClcbiAgY29uc3QgY2hhbm5lbFN0YXRlID0gY2hhdFN0YXRlLmNoYW5uZWxzXG4gIGNvbnN0IGNoYW5uZWxzID0gY2hhbm5lbFN0YXRlLmNoYW5uZWxzXG4gIGNvbnN0IGFjdGl2ZUNoYW5uZWxNYXRjaCA9IE9iamVjdC5lbnRyaWVzKGNoYW5uZWxzKS5maW5kKChbLCBjaGFubmVsXSkgPT4gY2hhbm5lbC5jaGFubmVsVHlwZSA9PT0gJ2luc3RhbmNlJylcbiAgaWYgKGFjdGl2ZUNoYW5uZWxNYXRjaCAmJiBhY3RpdmVDaGFubmVsTWF0Y2gubGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IGFjdGl2ZUNoYW5uZWwgPSBhY3RpdmVDaGFubmVsTWF0Y2hbMV1cbiAgICBpZiAoYWN0aXZlQ2hhbm5lbCA9PT0gdW5kZWZpbmVkKSByZXR1cm5cbiAgICBjb25zdCBtZXNzYWdlcyA9IGFjdGl2ZUNoYW5uZWwubWVzc2FnZXNcbiAgICBpZiAobWVzc2FnZXMgPT09IHVuZGVmaW5lZCkgcmV0dXJuXG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1lc3NhZ2VzLmxlbmd0aDsgaSsrKSBtZXNzYWdlc1tpXS50ZXh0ID0gcmVtb3ZlTWVzc2FnZVN5c3RlbShtZXNzYWdlc1tpXS50ZXh0KVxuXG4gICAgY29uc29sZS5sb2coJ21lc3NhZ2VzfCcgKyBKU09OLnN0cmluZ2lmeShtZXNzYWdlcykpXG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKFwiQ291bGRuJ3QgZ2V0IGNoYXQgc3RhdGVcIilcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVMaXN0QWxsVXNlcnNDb21tYW5kKHVzZXJJZCkge1xuICBjb25zb2xlLmxvZygnbGlzdGFsbHVzZXJzLCBsb2NhbCBpZDogJyArIHVzZXJJZClcbiAgaWYgKHVzZXJJZCA9PT0gdW5kZWZpbmVkKSByZXR1cm5cblxuICBjb25zdCBwbGF5ZXJzID0gZ2V0UmVtb3RlVXNlcnModXNlcklkLCB0cnVlKVxuICBpZiAocGxheWVycyA9PT0gdW5kZWZpbmVkKSByZXR1cm5cblxuICBjb25zdCBwbGF5ZXJOYW1lcyA9IHBsYXllcnMubWFwKCh1c2VySWQpID0+IEVuZ2luZS5kZWZhdWx0V29ybGQuY2xpZW50cy5nZXQodXNlcklkKT8ubmFtZSlcbiAgY29uc29sZS5sb2coJ3BsYXllcnN8JyArIHBsYXllck5hbWVzKVxufVxuZnVuY3Rpb24gaGFuZGxlR2V0TG9jYWxVc2VySWRDb21tYW5kKHVzZXJJZCkge1xuICBpZiAodXNlcklkID09PSB1bmRlZmluZWQgfHwgdXNlcklkID09PSAnJykgcmV0dXJuXG5cbiAgY29uc29sZS5sb2coJ2xvY2FsSWR8JyArIHVzZXJJZClcbn1cblxuZnVuY3Rpb24gcnVuQW5pbWF0aW9uKGVudGl0eTogYW55LCBlbW90ZTogc3RyaW5nLCBlbW90ZVBhcmFtczogYW55KSB7XG4gIGNvbnN0IGFhYyA9IGdldENvbXBvbmVudChlbnRpdHksIEF2YXRhckFuaW1hdGlvbkNvbXBvbmVudClcblxuICBpZiAoIWFhYy5hbmltYXRpb25HcmFwaC52YWxpZGF0ZVRyYW5zaXRpb24oYWFjLmN1cnJlbnRTdGF0ZSwgYWFjLmFuaW1hdGlvbkdyYXBoLnN0YXRlc1tlbW90ZV0pKSB7XG4gICAgY29uc29sZS53YXJuKCdpbW1lZGlhdGUgdHJhbnNpdGlvbiB0byBbJXNdIGlzIG5vdCBhdmFpbGFibGUgZnJvbSBjdXJyZW50IHN0YXRlIFslc10nLCBlbW90ZSwgYWFjLmN1cnJlbnRTdGF0ZS5uYW1lKVxuICB9XG5cbiAgaWYgKCFoYXNDb21wb25lbnQoZW50aXR5LCBBdXRvUGlsb3RDb21wb25lbnQpKSBBbmltYXRpb25HcmFwaC5mb3JjZVVwZGF0ZUFuaW1hdGlvblN0YXRlKGVudGl0eSwgZW1vdGUsIGVtb3RlUGFyYW1zKVxuICBlbHNlIHtcbiAgICBzdG9wQXV0b3BpbG90KGVudGl0eSlcbiAgICBsZXQgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICBpZiAoYWFjLmFuaW1hdGlvbkdyYXBoLnZhbGlkYXRlVHJhbnNpdGlvbihhYWMuY3VycmVudFN0YXRlLCBhYWMuYW5pbWF0aW9uR3JhcGguc3RhdGVzW2Vtb3RlXSkpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbClcbiAgICAgICAgQW5pbWF0aW9uR3JhcGguZm9yY2VVcGRhdGVBbmltYXRpb25TdGF0ZShlbnRpdHksIGVtb3RlLCBlbW90ZVBhcmFtcylcbiAgICAgIH1cbiAgICB9LCA1MClcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRNZXRhZGF0YVBvc2l0aW9uKF9wb3M6IHN0cmluZyk6IFZlY3RvcjMge1xuICBpZiAoX3BvcyA9PT0gdW5kZWZpbmVkIHx8IF9wb3MgPT09ICcnKSByZXR1cm4gbmV3IFZlY3RvcjMoMCwgMCwgMClcblxuICBjb25zdCBfZGF0YSA9IF9wb3Muc3BsaXQoJywnKVxuICBpZiAoX2RhdGEubGVuZ3RoICE9IDMpIHJldHVybiBuZXcgVmVjdG9yMygwLCAwLCAwKVxuXG4gIGNvbnN0IHggPSBwYXJzZUZsb2F0KF9kYXRhWzBdKVxuICBjb25zdCB5ID0gcGFyc2VGbG9hdChfZGF0YVsxXSlcbiAgY29uc3QgeiA9IHBhcnNlRmxvYXQoX2RhdGFbMl0pXG5cbiAgcmV0dXJuIG5ldyBWZWN0b3IzKHgsIHksIHopXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnb1RvKHBvczogVmVjdG9yMywgZW50aXR5OiBFbnRpdHkpIHtcbiAgLy9jb25zb2xlLmxvZygnZ290bzogJyArIEpTT04uc3RyaW5naWZ5KHBvcykpXG4gIGxldCBsaW5wdXQgPSBnZXRDb21wb25lbnQoZW50aXR5LCBMb2NhbElucHV0VGFnQ29tcG9uZW50KVxuICBpZiAobGlucHV0ID09PSB1bmRlZmluZWQpIGxpbnB1dCA9IGFkZENvbXBvbmVudChlbnRpdHksIExvY2FsSW5wdXRUYWdDb21wb25lbnQsIHt9KVxuICBhZGRDb21wb25lbnQoZW50aXR5LCBBdXRvUGlsb3RPdmVycmlkZUNvbXBvbmVudCwge1xuICAgIG92ZXJyaWRlQ29vcmRzOiB0cnVlLFxuICAgIG92ZXJyaWRlUG9zaXRpb246IHBvc1xuICB9KVxuICBhZGRDb21wb25lbnQoZW50aXR5LCBBdXRvUGlsb3RDbGlja1JlcXVlc3RDb21wb25lbnQsIHtcbiAgICBjb29yZHM6IG5ldyBWZWN0b3IyKDAsIDApXG4gIH0pXG59XG4iLCJpbXBvcnQgeyBWZWN0b3IzIH0gZnJvbSAndGhyZWUnXG5pbXBvcnQgeyBwb3NpdGlvbkJlaGluZCB9IGZyb20gJ0B4cmVuZ2luZS9jb21tb24vc3JjL3V0aWxzL21hdGhVdGlscydcbmltcG9ydCB7IGRlZmluZVF1ZXJ5LCBnZXRDb21wb25lbnQgfSBmcm9tICcuLi8uLi9lY3MvZnVuY3Rpb25zL0NvbXBvbmVudEZ1bmN0aW9ucydcbmltcG9ydCB7IFRyYW5zZm9ybUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL3RyYW5zZm9ybS9jb21wb25lbnRzL1RyYW5zZm9ybUNvbXBvbmVudCdcbmltcG9ydCB7IEZvbGxvd0NvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudC9Gb2xsb3dDb21wb25lbnQnXG5pbXBvcnQgeyBnb1RvIH0gZnJvbSAnLi4vLi4vY29tbW9uL2Z1bmN0aW9ucy9jb21tYW5kSGFuZGxlcidcbmltcG9ydCB7IFdvcmxkIH0gZnJvbSAnLi4vLi4vZWNzL2NsYXNzZXMvV29ybGQnXG5pbXBvcnQgeyBTeXN0ZW0gfSBmcm9tICcuLi8uLi9lY3MvY2xhc3Nlcy9TeXN0ZW0nXG5cbmNvbnN0IGRpc3RhbmNlVG9QbGF5ZXI6IG51bWJlciA9IDFcbmNvbnN0IHN0ZXA6IG51bWJlciA9IDEwXG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIEZvbGxvd1N5c3RlbSh3b3JsZDogV29ybGQpOiBQcm9taXNlPFN5c3RlbT4ge1xuICBjb25zdCBmb2xsb3dRdWVyeSA9IGRlZmluZVF1ZXJ5KFtGb2xsb3dDb21wb25lbnRdKVxuXG4gIHJldHVybiAoKSA9PiB7XG4gICAgZm9yIChjb25zdCBlaWQgb2YgZm9sbG93UXVlcnkod29ybGQpKSB7XG4gICAgICBsZXQgeyB0YXJnZXRFaWQsIGNTdGVwLCBwcmV2VGFyZ2V0IH0gPSBnZXRDb21wb25lbnQoZWlkLCBGb2xsb3dDb21wb25lbnQpXG4gICAgICBjU3RlcCsrXG4gICAgICBnZXRDb21wb25lbnQoZWlkLCBGb2xsb3dDb21wb25lbnQpLmNTdGVwID0gY1N0ZXBcbiAgICAgIGlmIChjU3RlcCA8IHN0ZXApIGNvbnRpbnVlXG4gICAgICBnZXRDb21wb25lbnQoZWlkLCBGb2xsb3dDb21wb25lbnQpLmNTdGVwID0gMFxuXG4gICAgICBjb25zdCB0VHJhbnNmb3JtID0gZ2V0Q29tcG9uZW50KHRhcmdldEVpZCwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICAgICAgaWYgKHRUcmFuc2Zvcm0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb25zdCBwb3M6IFZlY3RvcjMgPSBwb3NpdGlvbkJlaGluZCh0VHJhbnNmb3JtLnBvc2l0aW9uLCB0VHJhbnNmb3JtLnJvdGF0aW9uLCBkaXN0YW5jZVRvUGxheWVyKVxuICAgICAgICBpZiAocG9zICE9PSBwcmV2VGFyZ2V0KSB7XG4gICAgICAgICAgZ29Ubyhwb3MsIGVpZClcbiAgICAgICAgICBnZXRDb21wb25lbnQoZWlkLCBGb2xsb3dDb21wb25lbnQpLnByZXZUYXJnZXQgPSBwb3NcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJ3akJBa0NhLEdBQWtCLEVBQTJDLDhCQ3FjckQsRUFBYyxFQUFnQixJQUU3QyxHQUFTLEVBQWEsRUFBUSxHQUM5QixJQUFXLFdBQW9CLEVBQWEsRUFBUSxFQUF3QixPQUNuRSxFQUFRLEVBQTRCLENBQy9DLGVBQWdCLEdBQ2hCLGlCQUFrQixNQUVQLEVBQVEsRUFBZ0MsQ0FDbkQsT0FBUSxHQUFJLEdBQVEsRUFBRyxLQ3ZlM0IsS0FBTSxHQUEyQixFQUMzQixFQUFlLG9CQUVzQixFQUErQixNQUNsRSxHQUFjLEVBQVksQ0FBQyxVQUUxQixJQUFNLFVBQ0EsS0FBTyxHQUFZLEdBQVEsSUFDaEMsQ0FBRSxZQUFXLFFBQU8sY0FBZSxFQUFhLEVBQUssWUFFNUMsRUFBSyxHQUFpQixNQUFRLEVBQ3ZDLEVBQVEsYUFDQyxFQUFLLEdBQWlCLE1BQVEsT0FFckMsR0FBYSxFQUFhLEVBQVcsTUFDdkMsSUFBZSxPQUFXLE1BQ3RCLEdBQWUsRUFBZSxFQUFXLFNBQVUsRUFBVyxTQUFVLEdBQzFFLElBQVEsTUFDTCxFQUFLLEtBQ0csRUFBSyxHQUFpQixXQUFhIn0=
