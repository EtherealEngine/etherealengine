const g=o=>({type:`Uint${o}`,bytes:o===8?1:o===16?2:4}),u=g(8),p=g(16),_=g(32),w=o=>({type:`Big${o?"Int":"Uint"}64`,bytes:8}),B=w(!1),x=o=>({type:`Float${o}`,bytes:o===32?4:8}),c=x(32),P={type:"String",bytes:1};DataView.prototype.setBigUint64??=function(o,t,e){const i=Number(t>>32n&0xffffffffn),n=Number(t&0xffffffffn),[s,r]=e?[4,0]:[0,4];this.setUint32(o+s,i,e),this.setUint32(o+r,n,e)};DataView.prototype.getBigUint64??=function(o,t){const[e,i]=t?[4,0]:[0,4],n=BigInt(this.getUint32(o+e,t)),s=BigInt(this.getUint32(o+i,t));return(n<<32n)+s};class U{maxByteSize;_buffer;_dataView;_offset;_textEncoder;_textDecoder;_uint8Array;get offset(){return this._offset}constructor(t){this.maxByteSize=t??1e6,this._offset=0,this._buffer=new ArrayBuffer(this.maxByteSize),this._dataView=new DataView(this._buffer),this._uint8Array=new Uint8Array(this._buffer),this._textEncoder=new TextEncoder,this._textDecoder=new TextDecoder}refresh(t){this._offset=0,t&&this._uint8Array.set(new Uint8Array(t))}finalize(){return this._buffer.slice(0,this._offset)}append(t,e){if(t.type==="String"){this._dataView.setUint8(this._offset,34),this._offset+=u.bytes;const i=this._textEncoder.encode(e.toString());this._uint8Array.set(i,this._offset),this._offset+=i.byteLength,this._dataView.setUint8(this._offset,34),this._offset+=u.bytes;return}if(t.type==="Boolean")this._dataView.setUint8(this._offset,e===!0?1:0);else{switch(t.type){case"BigInt64":case"BigUint64":{e=typeof e=="bigint"?e:BigInt(e);break}case"Float32":case"Float64":{e=Number(Number(e).toPrecision(t.type==="Float32"?7:16));break}}this._dataView[`set${t.type}`](this._offset,e)}this._offset+=t.bytes}read(t){let e,i=this._offset+t.bytes;if(t.type==="String"){const n=this._uint8Array[this._offset],s=this._uint8Array.indexOf(34,this._offset+1);if(n!==34||s<this._offset)throw new Error("Buffer contains invalid string.");e=this._textDecoder.decode(this._uint8Array.subarray(this._offset+1,s)),i=s+1}else t.type==="Boolean"?e=Boolean(this._dataView.getUint8(this._offset)):(e=this._dataView[`get${t.type}`](this._offset),(t.type==="Float32"||t.type==="Float64")&&(e=Number(Number(e).toPrecision(t.type==="Float32"?7:16))));return this._offset=i,e}}function b(o){return typeof o=="object"&&Object.getPrototypeOf(o)===Object.prototype}function l(o){return o&&typeof o.type=="string"&&typeof o.bytes=="number"}class f{static instances=new Map;id;struct;constructor(t,e=f.instances.size){if(this.struct=f.definition(t),this.id=e,f.instances.get(e))throw new Error(`A Schema with the name "${e}" already exists.`);if(f.instances.set(e,this),f.instances.size>255)throw new Error("The maximum number of Schema instances (255) has been reached.")}static definition(t){return this.sortStruct(t)}static sortStruct(t){const e=Object.keys(t);e.length<=1&&this.getSortPriority(t[e[0]]);const i=e.sort((s,r)=>{const a=this.getSortPriority(t[s]),h=this.getSortPriority(t[r]);return a===h?s<r?-1:1:a<h?-1:1}),n={};for(const s of i){const r=t[s];b(r)&&!l(r)?n[s]=this.sortStruct(r):n[s]=r}return n}static getSortPriority(t){if(l(t))return t.type==="String"?2:0;if(t instanceof f)return 5;if(Array.isArray(t)){if(l(t[0]))return t[0].type==="String"?3:1;if(t[0]instanceof f)return 6}if(b(t))return 4;throw new Error(`Unsupported data type in schema definition: ${t}`)}}class y{static BUFFER_ARRAY=0;static BUFFER_OBJECT=1;schema;_buffer;constructor(t,e){this._buffer=new U(e),this.schema=t}static fromSchemaDefinition(t,e){return new y(new f(t,e))}static getIdFromBuffer(t){return new Uint8Array(t)[1]}toBuffer(t){if(this._buffer.refresh(),Array.isArray(t)){this._buffer.append(u,y.BUFFER_ARRAY),this._buffer.append(u,this.schema.id),this._buffer.append(p,t.length);for(let e=0;e<t.length;e++)this.serialize(t[e],this.schema.struct)}else this._buffer.append(u,y.BUFFER_OBJECT),this._buffer.append(u,this.schema.id),this.serialize(t,this.schema.struct);return this._buffer.finalize()}fromBuffer(t,e){if(t.byteLength>this._buffer.maxByteSize)throw new Error("Buffer exceeds max allocation size.");this._buffer.refresh(t);const i=this._buffer.read(u);if(e&&e!==i)throw new Error(`Expected buffer type to be ${e} but got ${i}.`);if(this._buffer.read(u)!==this.schema.id)throw new Error(`Expected schema id to be ${this.schema.id}`);if(i===y.BUFFER_OBJECT)return this.deserialize(this.schema.struct);const n=this._buffer.read(p),s=[];for(let r=0;r<n;r++)s.push(this.deserialize(this.schema.struct));return s}serialize(t,e){const i=Object.keys(e);for(let n=0;n<i.length;n++){const s=t[i[n]],r=e[i[n]];if(l(r))this._buffer.append(r,s);else if(r instanceof f)this.serialize(s,r.struct);else if(Array.isArray(r)){this._buffer.append(p,s.length);const a=r[0];if(a instanceof f)for(let h=0;h<s.length;h++)this.serialize(s[h],a.struct);else if(l(a))for(let h=0;h<s.length;h++)this._buffer.append(a,s[h])}else b(r)&&this.serialize(s,r)}}deserialize(t){const e={},i=Object.keys(t);for(let n=0;n<i.length;n++){const s=t[i[n]];if(l(s))e[i[n]]=this._buffer.read(s);else if(Array.isArray(s)){const r=this._buffer.read(p),a=s[0],h=[];if(a instanceof f)for(let d=0;d<r;d++)h.push(this.deserialize(a.struct));else if(l(a))for(let d=0;d<r;d++)h.push(this._buffer.read(a));e[i[n]]=h}else e[i[n]]=this.deserialize(s instanceof f?s.struct:s)}return e}}const A=new f({networkId:_,position:[c],rotation:[c],linearVelocity:[c],angularVelocity:[c]}),z=new f({key:P,position:[c],rotation:[c]}),E=new f({joints:[z]}),S=new f({networkId:_,hands:[E]}),F=new f({networkId:_,headPosePosition:[c],headPoseRotation:[c],leftPosePosition:[c],leftPoseRotation:[c],rightPosePosition:[c],rightPoseRotation:[c]}),k=new f({tick:_,time:B,pose:[A],ikPose:[F],handsPose:[S]});class m{static model=new y(k);static toBuffer(t){return t.time=Date.now(),m.model.toBuffer(t)}static fromBuffer(t){const e=m.model.fromBuffer(t);return{...e,time:Number(e.time)}}}export{m as W};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV0d29ya1NjaGVtYS5iYzFiZTAyNi5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vZW5naW5lL3NyYy9hc3NldHMvc3VwZXJidWZmZXIvdmlld3MudHMiLCIuLi8uLi8uLi9lbmdpbmUvc3JjL2Fzc2V0cy9zdXBlcmJ1ZmZlci9idWZmZXIudHMiLCIuLi8uLi8uLi9lbmdpbmUvc3JjL2Fzc2V0cy9zdXBlcmJ1ZmZlci91dGlscy50cyIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvYXNzZXRzL3N1cGVyYnVmZmVyL3NjaGVtYS50cyIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvYXNzZXRzL3N1cGVyYnVmZmVyL21vZGVsLnRzIiwiLi4vLi4vLi4vZW5naW5lL3NyYy9uZXR3b3JraW5nL3NjaGVtYS9uZXR3b3JrU2NoZW1hLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgQnVmZmVyVmlldyB9IGZyb20gJy4vdHlwZXMnXG5cbi8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9UeXBlZF9hcnJheXNcblxuLyoqXG4gKiBDcmVhdGVzIGEgc2NoZW1hIHJlcHJlc2VudGF0aW9uIGZvciBhIHNpZ25lZCBpbnRlZ2VyIHZhbHVlLlxuICogQHBhcmFtIHR5cGUgQml0IGxlbmd0aCBvZiB0aGUgaW50ZWdlci5cbiAqL1xuY29uc3QgaW50ID0gKHR5cGU6IDggfCAxNiB8IDMyKTogQnVmZmVyVmlldzxudW1iZXI+ID0+ICh7XG4gIHR5cGU6IGBJbnQke3R5cGV9YCBhcyBjb25zdCxcbiAgYnl0ZXM6IHR5cGUgPT09IDggPyAxIDogdHlwZSA9PT0gMTYgPyAyIDogNFxufSlcblxuLyoqXG4gKiBgaW50OGA6IFstMTI4LCAxMjddICgxIGJ5dGUpXG4gKi9cbmV4cG9ydCBjb25zdCBpbnQ4ID0gaW50KDgpXG5cbi8qKlxuICogYGludDE2YDogWy0zMjc2OCwgMzI3NjddICgyIGJ5dGVzKVxuICovXG5leHBvcnQgY29uc3QgaW50MTYgPSBpbnQoMTYpXG5cbi8qKlxuICogYGludDMyYDogWy0yMTQ3NDgzNjQ4LCAyMTQ3NDgzNjQ3XSAoNCBieXRlcylcbiAqL1xuZXhwb3J0IGNvbnN0IGludDMyID0gaW50KDMyKVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzY2hlbWEgcmVwcmVzZW50YXRpb24gZm9yIGFuIHVuc2lnbmVkIGludGVnZXIgdmFsdWUuXG4gKiBAcGFyYW0gdHlwZSBCaXQgbGVuZ3RoIG9mIHRoZSBpbnRlZ2VyLlxuICovXG5jb25zdCB1aW50ID0gKHR5cGU6IDggfCAxNiB8IDMyKTogQnVmZmVyVmlldzxudW1iZXI+ID0+ICh7XG4gIHR5cGU6IGBVaW50JHt0eXBlfWAgYXMgY29uc3QsXG4gIGJ5dGVzOiB0eXBlID09PSA4ID8gMSA6IHR5cGUgPT09IDE2ID8gMiA6IDRcbn0pXG5cbi8qKlxuICogYHVpbnQ4YDogWzAsIDI1NV0gKDEgYnl0ZSlcbiAqL1xuZXhwb3J0IGNvbnN0IHVpbnQ4ID0gdWludCg4KVxuXG4vKipcbiAqIGB1aW50MTZgOiBbMCwgNjU1MzVdICgyIGJ5dGVzKVxuICovXG5leHBvcnQgY29uc3QgdWludDE2ID0gdWludCgxNilcblxuLyoqXG4gKiBgdWludDMyYDogWzAsIDQyOTQ5NjcyOTVdICg0IGJ5dGVzKVxuICovXG5leHBvcnQgY29uc3QgdWludDMyID0gdWludCgzMilcblxuLyoqXG4gKiBDcmVhdGVzIGEgc2NoZW1hIHJlcHJlc2VudGF0aW9uIGZvciBhIEJpZ0ludGVnZXIgdmFsdWUuXG4gKiBAcGFyYW0gc2lnbmVkIENvbnRyb2wgd2hldGhlciB0aGUgYmlnaW50IGlzIHNpZ25lZCBvciB1bnNpZ25lZC5cbiAqL1xuY29uc3QgYmlnaW50ID0gKHNpZ25lZDogYm9vbGVhbik6IEJ1ZmZlclZpZXc8YmlnaW50PiA9PiAoe1xuICB0eXBlOiBgQmlnJHtzaWduZWQgPyAnSW50JyA6ICdVaW50J302NGAgYXMgY29uc3QsXG4gIGJ5dGVzOiA4XG59KVxuXG4vKipcbiAqIGBpbnQ2NGA6IFstMl42MywgMl42My0xXSAoOCBieXRlcylcbiAqL1xuZXhwb3J0IGNvbnN0IGludDY0ID0gYmlnaW50KHRydWUpXG5cbi8qKlxuICogYHVpbnQ2NGA6IFswLCAyXjY0LTFdICg4IGJ5dGVzKVxuICovXG5leHBvcnQgY29uc3QgdWludDY0ID0gYmlnaW50KGZhbHNlKVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzY2hlbWEgcmVwcmVzZW50YXRpb24gZm9yIGEgZmxvYXRpbmctcG9pbnQgdmFsdWUuXG4gKiBAcGFyYW0gdHlwZSBCaXQgbGVuZ3RoIG9mIHRoZSBmbG9hdC5cbiAqL1xuY29uc3QgZmxvYXQgPSAodHlwZTogMzIgfCA2NCk6IEJ1ZmZlclZpZXc8bnVtYmVyPiA9PiAoe1xuICB0eXBlOiBgRmxvYXQke3R5cGV9YCBhcyBjb25zdCxcbiAgYnl0ZXM6IHR5cGUgPT09IDMyID8gNCA6IDhcbn0pXG5cbi8qKlxuICogYGZsb2F0MzJgOiBbMS4yw5cxMC0zOCwgMy40w5cxMDM4XSAoNyBzaWduaWZpY2FudCBkaWdpdHMpICg0IGJ5dGVzKVxuICovXG5leHBvcnQgY29uc3QgZmxvYXQzMiA9IGZsb2F0KDMyKVxuXG4vKipcbiAqIGBmbG9hdDY0YDogWzUuMMOXMTAtMzI0LCAxLjjDlzEwMzA4XSAoMTYgc2lnbmlmaWNhbnQgZGlnaXRzKSAoOCBieXRlcylcbiAqL1xuZXhwb3J0IGNvbnN0IGZsb2F0NjQgPSBmbG9hdCg2NClcblxuLyoqXG4gKiBgc3RyaW5nYDogVVRGLTggZW5jb2RpbmcgKHZhcmlhYmxlIGJ5dGUgbGVuZ3RoIG9mIFVpbnQ4QXJyYXkpXG4gKi9cbmV4cG9ydCBjb25zdCBzdHJpbmc6IEJ1ZmZlclZpZXc8c3RyaW5nPiA9IHtcbiAgdHlwZTogJ1N0cmluZycgYXMgY29uc3QsXG4gIGJ5dGVzOiAxXG59XG5cbi8qKlxuICogYGJvb2xlYW5gOiBUcnVlICgxKSBhbmQgZmFsc2UgKDApICgxIGJ5dGUpXG4gKi9cbmV4cG9ydCBjb25zdCBib29sZWFuOiBCdWZmZXJWaWV3PGJvb2xlYW4+ID0ge1xuICB0eXBlOiAnQm9vbGVhbicgYXMgY29uc3QsXG4gIGJ5dGVzOiAxXG59XG4iLCJpbXBvcnQgeyB1aW50OCB9IGZyb20gJy4vdmlld3MnXG5pbXBvcnQgdHlwZSB7IEJ1ZmZlclZpZXcsIFNlcmlhbGl6YWJsZSB9IGZyb20gJy4vdHlwZXMnXG5cbi8vIHNldEJpZ1VpbnQ2NC9nZXRCaWdVaW50NjQgcG9sZnlpbGwgbmVlZGVkIGZvciBzb21lIGJyb3dzZXJzXG5cbkRhdGFWaWV3LnByb3RvdHlwZS5zZXRCaWdVaW50NjQgPz89IGZ1bmN0aW9uIChieXRlT2Zmc2V0LCB2YWx1ZSwgbGl0dGxlRW5kaWFuKSB7XG4gIGNvbnN0IHdoID0gTnVtYmVyKCh2YWx1ZSA+PiAzMm4pICYgMHhmZmZmZmZmZm4pXG4gIGNvbnN0IHdsID0gTnVtYmVyKHZhbHVlICYgMHhmZmZmZmZmZm4pXG4gIGNvbnN0IFtoLCBsXSA9IGxpdHRsZUVuZGlhbiA/IFs0LCAwXSA6IFswLCA0XVxuICB0aGlzLnNldFVpbnQzMihieXRlT2Zmc2V0ICsgaCwgd2gsIGxpdHRsZUVuZGlhbilcbiAgdGhpcy5zZXRVaW50MzIoYnl0ZU9mZnNldCArIGwsIHdsLCBsaXR0bGVFbmRpYW4pXG59XG5cbkRhdGFWaWV3LnByb3RvdHlwZS5nZXRCaWdVaW50NjQgPz89IGZ1bmN0aW9uIChieXRlT2Zmc2V0LCBsaXR0bGVFbmRpYW4pIHtcbiAgY29uc3QgW2gsIGxdID0gbGl0dGxlRW5kaWFuID8gWzQsIDBdIDogWzAsIDRdXG4gIGNvbnN0IHdoID0gQmlnSW50KHRoaXMuZ2V0VWludDMyKGJ5dGVPZmZzZXQgKyBoLCBsaXR0bGVFbmRpYW4pKVxuICBjb25zdCB3bCA9IEJpZ0ludCh0aGlzLmdldFVpbnQzMihieXRlT2Zmc2V0ICsgbCwgbGl0dGxlRW5kaWFuKSlcbiAgcmV0dXJuICh3aCA8PCAzMm4pICsgd2xcbn1cblxuLyoqXG4gKiBUaGUgQnVmZmVyTWFuYWdlciBjbGFzcyBwcm92aWRlcyBhbiBBUEkgZm9yIHJlYWRpbmcgYW5kIHdyaXRpbmcgdG8gYW4gQXJyYXlCdWZmZXIgdmlhXG4gKiBEYXRhVmlld3Mgd2hpbGUgdHJhY2tpbmcgdGhlIGN1cnJlbnQgYnl0ZSBvZmZzZXQgYW5kIGF1dG9tYXRpY2FsbHkgaGFuZGxpbmcgc3RyaW5nIGVuY29kaW5nLlxuICovXG5leHBvcnQgY2xhc3MgQnVmZmVyTWFuYWdlciB7XG4gIC8qKlxuICAgKiBNYXggYnVmZmVyIHNpemUgZm9yIGEgc2VyaWFsaXplZCBvYmplY3QuIERlZmF1bHQ6IDEgbWVnYWJ5dGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgbWF4Qnl0ZVNpemU6IG51bWJlclxuICAvKipcbiAgICogSW50ZXJuYWwgQXJyYXlCdWZmZXIgcmVmZXJlbmNlLlxuICAgKi9cbiAgcHJvdGVjdGVkIF9idWZmZXI6IEFycmF5QnVmZmVyXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBEYXRhVmlldyByZWZlcmVuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgX2RhdGFWaWV3OiBEYXRhVmlld1xuICAvKipcbiAgICogQ3VycmVudCBieXRlIHBvc2l0aW9uIGluIHRoZSBEYXRhVmlldy5cbiAgICovXG4gIHByb3RlY3RlZCBfb2Zmc2V0OiBudW1iZXJcbiAgLyoqXG4gICAqIEludGVybmFsIFRleHRFbmNvZGVyIHJlZmVyZW5jZS5cbiAgICovXG4gIHByb3RlY3RlZCBfdGV4dEVuY29kZXI6IFRleHRFbmNvZGVyXG4gIC8qKlxuICAgKiBJbnRlcm5hbCBUZXh0RGVjb2RlciByZWZlcmVuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgX3RleHREZWNvZGVyOiBUZXh0RGVjb2RlclxuICAvKipcbiAgICogSW50ZXJuYWwgVWludDhBcnJheSByZXByZXNlbnRhdGlvbiBvZiB0aGUgRGF0YVZpZXcuXG4gICAqL1xuICBwcm90ZWN0ZWQgX3VpbnQ4QXJyYXk6IFVpbnQ4QXJyYXlcbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBieXRlIG9mZnNldCBvZiB0aGUgYnVmZmVyLlxuICAgKi9cbiAgcHVibGljIGdldCBvZmZzZXQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fb2Zmc2V0XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IEJ1ZmZlck1hbmFnZXIgaW5zdGFuY2UuXG4gICAqIEBwYXJhbSBidWZmZXJTaXplIFRoZSBtYXhpbXVtIHNpemUgb2YgdGhlIGludGVybmFsIEFycmF5QnVmZmVyLlxuICAgKi9cbiAgcHVibGljIGNvbnN0cnVjdG9yKGJ1ZmZlclNpemU/OiBudW1iZXIpIHtcbiAgICB0aGlzLm1heEJ5dGVTaXplID0gYnVmZmVyU2l6ZSA/PyAxZTZcbiAgICB0aGlzLl9vZmZzZXQgPSAwXG4gICAgdGhpcy5fYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHRoaXMubWF4Qnl0ZVNpemUpXG4gICAgdGhpcy5fZGF0YVZpZXcgPSBuZXcgRGF0YVZpZXcodGhpcy5fYnVmZmVyKVxuICAgIHRoaXMuX3VpbnQ4QXJyYXkgPSBuZXcgVWludDhBcnJheSh0aGlzLl9idWZmZXIpXG4gICAgdGhpcy5fdGV4dEVuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKVxuICAgIHRoaXMuX3RleHREZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWZyZXNoIHRoaXMgTW9kZWwncyBpbnRlcm5hbCBidWZmZXIgYW5kIERhdGFWaWV3IGJlZm9yZSB0b0J1ZmZlciBpcyBjYWxsZWQuXG4gICAqIEBwYXJhbSBuZXdCdWZmZXIgU3BlY2lmaWMgQXJyYXlCdWZmZXIgaW5zdGFuY2UsIG90aGVyd2lzZSBhIGRlZmF1bHQgd2lsbCBiZSB1c2VkLlxuICAgKi9cbiAgcHVibGljIHJlZnJlc2gobmV3QnVmZmVyPzogQXJyYXlCdWZmZXIpOiB2b2lkIHtcbiAgICB0aGlzLl9vZmZzZXQgPSAwXG4gICAgaWYgKG5ld0J1ZmZlcikge1xuICAgICAgdGhpcy5fdWludDhBcnJheS5zZXQobmV3IFVpbnQ4QXJyYXkobmV3QnVmZmVyKSlcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29weSB0aGUgY29udGVudHMgb2YgdGhlIGludGVybmFsIEFycmF5QnVmZmVyICh3aGljaCBtYXkgY29udGFpbiB0cmFpbGluZyBlbXB0eSBzZWN0aW9ucylcbiAgICogaW50byBhIG5ldyBBcnJheUJ1ZmZlciB3aXRoIG5vIGVtcHR5IGJ5dGVzLlxuICAgKi9cbiAgcHVibGljIGZpbmFsaXplKCk6IEFycmF5QnVmZmVyIHtcbiAgICByZXR1cm4gdGhpcy5fYnVmZmVyLnNsaWNlKDAsIHRoaXMuX29mZnNldClcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBlbmQgZGF0YSB0byB0aGUgaW50ZXJuYWwgRGF0YVZpZXcgYnVmZmVyLlxuICAgKiBAcGFyYW0gYnVmZmVyVmlldyBCdWZmZXJWaWV3IHRvIGRlZmluZSB0aGUgdHlwZSBhcHBlbmRlZC5cbiAgICogQHBhcmFtIGRhdGEgRGF0YSB0byBiZSBhcHBlbmRlZCB0byB0aGUgRGF0YVZpZXcuXG4gICAqL1xuICBwdWJsaWMgYXBwZW5kKGJ1ZmZlclZpZXc6IEJ1ZmZlclZpZXcsIGRhdGE6IFNlcmlhbGl6YWJsZSk6IHZvaWQge1xuICAgIGlmIChidWZmZXJWaWV3LnR5cGUgPT09ICdTdHJpbmcnKSB7XG4gICAgICB0aGlzLl9kYXRhVmlldy5zZXRVaW50OCh0aGlzLl9vZmZzZXQsIDM0KSAvLyBXcmFwIGluIGRvdWJsZSBxdW90ZXNcbiAgICAgIHRoaXMuX29mZnNldCArPSB1aW50OC5ieXRlc1xuICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMuX3RleHRFbmNvZGVyLmVuY29kZShkYXRhLnRvU3RyaW5nKCkpXG4gICAgICB0aGlzLl91aW50OEFycmF5LnNldChlbmNvZGVkLCB0aGlzLl9vZmZzZXQpXG4gICAgICB0aGlzLl9vZmZzZXQgKz0gZW5jb2RlZC5ieXRlTGVuZ3RoXG4gICAgICB0aGlzLl9kYXRhVmlldy5zZXRVaW50OCh0aGlzLl9vZmZzZXQsIDM0KSAvLyBXcmFwIGluIGRvdWJsZSBxdW90ZXNcbiAgICAgIHRoaXMuX29mZnNldCArPSB1aW50OC5ieXRlc1xuICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGlmIChidWZmZXJWaWV3LnR5cGUgPT09ICdCb29sZWFuJykge1xuICAgICAgdGhpcy5fZGF0YVZpZXcuc2V0VWludDgodGhpcy5fb2Zmc2V0LCBkYXRhID09PSB0cnVlID8gMSA6IDApXG4gICAgfSBlbHNlIHtcbiAgICAgIHN3aXRjaCAoYnVmZmVyVmlldy50eXBlKSB7XG4gICAgICAgIGNhc2UgJ0JpZ0ludDY0JzpcbiAgICAgICAgY2FzZSAnQmlnVWludDY0Jzoge1xuICAgICAgICAgIGRhdGEgPSB0eXBlb2YgZGF0YSA9PT0gJ2JpZ2ludCcgPyBkYXRhIDogQmlnSW50KGRhdGEpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgICBjYXNlICdGbG9hdDMyJzpcbiAgICAgICAgY2FzZSAnRmxvYXQ2NCc6IHtcbiAgICAgICAgICBkYXRhID0gTnVtYmVyKE51bWJlcihkYXRhKS50b1ByZWNpc2lvbihidWZmZXJWaWV3LnR5cGUgPT09ICdGbG9hdDMyJyA/IDcgOiAxNikpXG4gICAgICAgICAgYnJlYWtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fZGF0YVZpZXdbYHNldCR7YnVmZmVyVmlldy50eXBlfWAgYXMgY29uc3RdKHRoaXMuX29mZnNldCwgZGF0YSBhcyBuZXZlcilcbiAgICB9XG4gICAgdGhpcy5fb2Zmc2V0ICs9IGJ1ZmZlclZpZXcuYnl0ZXNcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkIHRoZSBEYXRhVmlldyBhdCB0aGUgY3VycmVudCBieXRlIG9mZnNldCBhY2NvcmRpbmcgdG8gdGhlIEJ1ZmZlclZpZXcgdHlwZSwgYW5kXG4gICAqIGluY3JlbWVudCB0aGUgb2Zmc2V0IGlmIHRoZSByZWFkIHdhcyBzdWNjZXNzZnVsLlxuICAgKiBAcGFyYW0gYnVmZmVyVmlldyBCdWZmZXJWaWV3IHRvIGRlZmluZSB0aGUgdHlwZSByZWFkLlxuICAgKi9cbiAgcHVibGljIHJlYWQoYnVmZmVyVmlldzogQnVmZmVyVmlldyk6IFNlcmlhbGl6YWJsZVxuICBwdWJsaWMgcmVhZChidWZmZXJWaWV3OiBCdWZmZXJWaWV3PHN0cmluZz4pOiBzdHJpbmdcbiAgcHVibGljIHJlYWQoYnVmZmVyVmlldzogQnVmZmVyVmlldzxudW1iZXI+KTogbnVtYmVyXG4gIHB1YmxpYyByZWFkKGJ1ZmZlclZpZXc6IEJ1ZmZlclZpZXc8YmlnaW50Pik6IGJpZ2ludFxuICBwdWJsaWMgcmVhZChidWZmZXJWaWV3OiBCdWZmZXJWaWV3KTogU2VyaWFsaXphYmxlIHtcbiAgICBsZXQgcmVzdWx0OiBTZXJpYWxpemFibGVcbiAgICBsZXQgbmV3T2Zmc2V0ID0gdGhpcy5fb2Zmc2V0ICsgYnVmZmVyVmlldy5ieXRlc1xuICAgIC8vIFN0cmluZ1xuICAgIGlmIChidWZmZXJWaWV3LnR5cGUgPT09ICdTdHJpbmcnKSB7XG4gICAgICBjb25zdCBzdGFydGluZ0RvdWJsZVF1b3RlID0gdGhpcy5fdWludDhBcnJheVt0aGlzLl9vZmZzZXRdIC8vIENoYXIgY29kZSBvZiBcIiBpcyAzNFxuICAgICAgY29uc3QgZW5kUXVvdGVJbmRleCA9IHRoaXMuX3VpbnQ4QXJyYXkuaW5kZXhPZigzNCwgdGhpcy5fb2Zmc2V0ICsgMSlcbiAgICAgIGlmIChzdGFydGluZ0RvdWJsZVF1b3RlICE9PSAzNCB8fCBlbmRRdW90ZUluZGV4IDwgdGhpcy5fb2Zmc2V0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQnVmZmVyIGNvbnRhaW5zIGludmFsaWQgc3RyaW5nLicpXG4gICAgICB9XG4gICAgICByZXN1bHQgPSB0aGlzLl90ZXh0RGVjb2Rlci5kZWNvZGUodGhpcy5fdWludDhBcnJheS5zdWJhcnJheSh0aGlzLl9vZmZzZXQgKyAxLCBlbmRRdW90ZUluZGV4KSlcbiAgICAgIG5ld09mZnNldCA9IGVuZFF1b3RlSW5kZXggKyAxXG4gICAgfVxuICAgIC8vIEJvb2xlYW5cbiAgICBlbHNlIGlmIChidWZmZXJWaWV3LnR5cGUgPT09ICdCb29sZWFuJykge1xuICAgICAgcmVzdWx0ID0gQm9vbGVhbih0aGlzLl9kYXRhVmlldy5nZXRVaW50OCh0aGlzLl9vZmZzZXQpKVxuICAgIH1cbiAgICAvLyBOdW1iZXJcbiAgICBlbHNlIHtcbiAgICAgIHJlc3VsdCA9IHRoaXMuX2RhdGFWaWV3W2BnZXQke2J1ZmZlclZpZXcudHlwZX1gIGFzIGNvbnN0XSh0aGlzLl9vZmZzZXQpXG4gICAgICBpZiAoYnVmZmVyVmlldy50eXBlID09PSAnRmxvYXQzMicgfHwgYnVmZmVyVmlldy50eXBlID09PSAnRmxvYXQ2NCcpIHtcbiAgICAgICAgcmVzdWx0ID0gTnVtYmVyKE51bWJlcihyZXN1bHQpLnRvUHJlY2lzaW9uKGJ1ZmZlclZpZXcudHlwZSA9PT0gJ0Zsb2F0MzInID8gNyA6IDE2KSlcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5fb2Zmc2V0ID0gbmV3T2Zmc2V0XG4gICAgcmV0dXJuIHJlc3VsdFxuICB9XG59XG4iLCJpbXBvcnQgdHlwZSB7IEJ1ZmZlclZpZXcgfSBmcm9tICcuL3R5cGVzJ1xuXG4vKipcbiAqIFRlc3QgaWYgYW4gZW50aXR5IGlzIGFuIHBsYWluIG9iamVjdC5cbiAqIEBwYXJhbSB2YWx1ZSBWYWx1ZSB0byBiZSB0ZXN0ZWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc09iamVjdDxUIGV4dGVuZHMgUmVjb3JkPGFueSwgYW55Pj4odmFsdWU6IGFueSk6IHZhbHVlIGlzIFQge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YodmFsdWUpID09PSBPYmplY3QucHJvdG90eXBlXG59XG5cbi8qKlxuICogVGVzdCBpZiBhbiBlbnRpdHkgaXMgYW4gb2JqZWN0IHRoYXQgaW1wbGVtZW50cyB0aGUgQnVmZmVyVmlldyBpbnRlcmZhY2UuXG4gKiBAcGFyYW0gdmFsdWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQnVmZmVyVmlldyh2YWx1ZTogYW55KTogdmFsdWUgaXMgQnVmZmVyVmlldyB7XG4gIHJldHVybiB2YWx1ZSAmJiB0eXBlb2YgdmFsdWUudHlwZSA9PT0gJ3N0cmluZycgJiYgdHlwZW9mIHZhbHVlLmJ5dGVzID09PSAnbnVtYmVyJ1xufVxuIiwiaW1wb3J0IHsgQnVmZmVyVmlld09yU2NoZW1hLCBTY2hlbWFEZWZpbml0aW9uIH0gZnJvbSAnLi90eXBlcydcbmltcG9ydCB7IGlzT2JqZWN0LCBpc0J1ZmZlclZpZXcgfSBmcm9tICcuL3V0aWxzJ1xuXG4vKipcbiAqIFRoZSBTY2hlbWEgY2xhc3MgcHJvdmlkZXMgYW4gQVBJIGZvciBjcmVhdGluZyBkZWZpbml0aW9ucy5cbiAqL1xuZXhwb3J0IGNsYXNzIFNjaGVtYTxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAvKipcbiAgICogTWFwIHRoYXQgY29udGFpbnMgcmVmZXJlbmNlcyB0byBhbGwgU2NoZW1hIGluc3RhbmNlcy5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgaW5zdGFuY2VzID0gbmV3IE1hcDxudW1iZXIsIFNjaGVtYT4oKVxuICAvKipcbiAgICogSWQgb2YgdGhlIHNjaGVtYS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpZDogbnVtYmVyXG4gIC8qKlxuICAgKiBTY2hlbWEgZGVmaW5pdGlvbiByZWZlcmVuY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc3RydWN0OiBTY2hlbWFEZWZpbml0aW9uPFJlYWRvbmx5PFQ+PlxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgU2NoZW1hIGluc3RhbmNlLlxuICAgKiBAcGFyYW0gbmFtZSBVbmlxdWUgbmFtZSBvZiB0aGUgU2NoZW1hLlxuICAgKiBAcGFyYW0gc3RydWN0IFNjaGVtYURlZmluaXRpb24gc3RydWN0dXJlIG9mIHRoZSBTY2hlbWEuXG4gICAqL1xuICBwdWJsaWMgY29uc3RydWN0b3Ioc3RydWN0OiBTY2hlbWFEZWZpbml0aW9uPFQ+LCBpZDogbnVtYmVyID0gU2NoZW1hLmluc3RhbmNlcy5zaXplKSB7XG4gICAgdGhpcy5zdHJ1Y3QgPSBTY2hlbWEuZGVmaW5pdGlvbihzdHJ1Y3QpXG4gICAgdGhpcy5pZCA9IGlkXG5cbiAgICAvLyBFbnN1cmUgc2NoZW1hIHdpdGggc2FtZSBuYW1lIGRvZXMgbm90IGV4aXN0XG4gICAgaWYgKFNjaGVtYS5pbnN0YW5jZXMuZ2V0KGlkKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBIFNjaGVtYSB3aXRoIHRoZSBuYW1lIFwiJHtpZH1cIiBhbHJlYWR5IGV4aXN0cy5gKVxuICAgIH0gZWxzZSB7XG4gICAgICBTY2hlbWEuaW5zdGFuY2VzLnNldChpZCwgdGhpcylcbiAgICAgIGlmIChTY2hlbWEuaW5zdGFuY2VzLnNpemUgPiAyNTUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgbWF4aW11bSBudW1iZXIgb2YgU2NoZW1hIGluc3RhbmNlcyAoMjU1KSBoYXMgYmVlbiByZWFjaGVkLicpXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIFNjaGVtYURlZmluaXRpb24gd2l0aG91dCBjcmVhdGluZyBhIFNjaGVtYSBpbnN0YW5jZS5cbiAgICogQHBhcmFtIG9iaiBPYmplY3QgZGVmaW5pbmcgdGhlIHNjaGVtYS5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZGVmaW5pdGlvbjxUPihvYmo6IFNjaGVtYURlZmluaXRpb248VD4pOiBTY2hlbWFEZWZpbml0aW9uPFJlYWRvbmx5PFQ+PiB7XG4gICAgcmV0dXJuIHRoaXMuc29ydFN0cnVjdChvYmopXG4gIH1cblxuICAvKipcbiAgICogU29ydCBhbmQgdmFsaWRhdGUgdGhlIHN0cnVjdHVyZSBvZiB0aGUgU2NoZW1hRGVmaW5pdGlvbi5cbiAgICogQHBhcmFtIHN0cnVjdCBUaGUgU2NoZW1hRGVmaW5pdGlvbiBzdHJ1Y3R1cmUgdG8gYmUgc29ydGVkLlxuICAgKi9cbiAgcHJvdGVjdGVkIHN0YXRpYyBzb3J0U3RydWN0PFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihzdHJ1Y3Q6IFQpOiBUIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc3RydWN0KVxuICAgIGlmIChrZXlzLmxlbmd0aCA8PSAxKSB7XG4gICAgICAvLyBzb3J0KCkgZG9lcyBub3QgcnVuIGlmIHRoZXJlIGlzIG9ubHkgMSBhcnJheSBlbGVtZW50LCBlbnN1cmUgdGhhdCBlbGVtZW50IGlzIHZhbGlkYXRlZFxuICAgICAgdGhpcy5nZXRTb3J0UHJpb3JpdHkoc3RydWN0W2tleXNbMF1dKVxuICAgIH1cbiAgICAvLyBGaW5kIHRoZSB0eXBlIG9mIGVhY2ggcHJvcGVydHkgb2YgdGhlIHN0cnVjdFxuICAgIGNvbnN0IHNvcnRlZEtleXMgPSBrZXlzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IGluZGV4QSA9IHRoaXMuZ2V0U29ydFByaW9yaXR5KHN0cnVjdFthXSlcbiAgICAgIGNvbnN0IGluZGV4QiA9IHRoaXMuZ2V0U29ydFByaW9yaXR5KHN0cnVjdFtiXSlcblxuICAgICAgLy8gU2FtZSB0eXBlLCBzb3J0IGFscGhhYmV0aWNhbGx5IGJ5IGtleVxuICAgICAgaWYgKGluZGV4QSA9PT0gaW5kZXhCKSB7XG4gICAgICAgIHJldHVybiBhIDwgYiA/IC0xIDogMVxuICAgICAgfVxuICAgICAgLy8gRGlmZmVyZW50IHR5cGUsIHNvcnQgYnkgcmV0dXJuZWQgaW5kZXhcbiAgICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gaW5kZXhBIDwgaW5kZXhCID8gLTEgOiAxXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IHNvcnRlZFN0cnVjdDogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XG4gICAgZm9yIChjb25zdCBrZXkgb2Ygc29ydGVkS2V5cykge1xuICAgICAgY29uc3QgdmFsdWUgPSBzdHJ1Y3Rba2V5XVxuICAgICAgLy8gT2JqZWN0XG4gICAgICBpZiAoaXNPYmplY3QodmFsdWUpICYmICFpc0J1ZmZlclZpZXcodmFsdWUpKSB7XG4gICAgICAgIHNvcnRlZFN0cnVjdFtrZXldID0gdGhpcy5zb3J0U3RydWN0KHZhbHVlKVxuICAgICAgfVxuICAgICAgLy8gU2NoZW1hLCBCdWZmZXJWaWV3LCBBcnJheVxuICAgICAgZWxzZSB7XG4gICAgICAgIHNvcnRlZFN0cnVjdFtrZXldID0gdmFsdWVcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHNvcnRlZFN0cnVjdCBhcyBUXG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcHJpb3JpdHkgaW5kZXggb2YgdGhlIGVudGl0eSBiYXNlZCBvbiBpdHMgdHlwZSwgaW4gb3JkZXI6XG4gICAqIGBCdWZmZXJWaWV3PG51bWJlcj5gLCBgQnVmZmVyVmlldzxudW1iZXI+W11gLCBgQnVmZmVyVmlldzxzdHJpbmc+YCwgYEJ1ZmZlclZpZXc8c3RyaW5nPltdYCxcbiAgICogYE9iamVjdGAsIGBTY2hlbWFgLCBgU2NoZW1hW11gXG4gICAqIEBwYXJhbSBpdGVtIEVudGl0eSB0byBkZXRlcm1pbmUgc29ydCBwcmlvcml0eS5cbiAgICovXG4gIHByb3RlY3RlZCBzdGF0aWMgZ2V0U29ydFByaW9yaXR5KGl0ZW06IEJ1ZmZlclZpZXdPclNjaGVtYSk6IG51bWJlciB7XG4gICAgaWYgKGlzQnVmZmVyVmlldyhpdGVtKSkge1xuICAgICAgaWYgKGl0ZW0udHlwZSA9PT0gJ1N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIDJcbiAgICAgIH1cbiAgICAgIHJldHVybiAwXG4gICAgfVxuICAgIGlmIChpdGVtIGluc3RhbmNlb2YgU2NoZW1hKSB7XG4gICAgICByZXR1cm4gNVxuICAgIH1cbiAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtKSkge1xuICAgICAgaWYgKGlzQnVmZmVyVmlldyhpdGVtWzBdKSkge1xuICAgICAgICBpZiAoaXRlbVswXS50eXBlID09PSAnU3RyaW5nJykge1xuICAgICAgICAgIHJldHVybiAzXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDFcbiAgICAgIH1cbiAgICAgIGlmIChpdGVtWzBdIGluc3RhbmNlb2YgU2NoZW1hKSB7XG4gICAgICAgIHJldHVybiA2XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChpc09iamVjdChpdGVtKSkge1xuICAgICAgcmV0dXJuIDRcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBkYXRhIHR5cGUgaW4gc2NoZW1hIGRlZmluaXRpb246ICR7aXRlbX1gKVxuICB9XG59XG4iLCIvLyBAdHMtbm9jaGVja1xuaW1wb3J0IHsgQnVmZmVyTWFuYWdlciB9IGZyb20gJy4vYnVmZmVyJ1xuaW1wb3J0IHsgU2NoZW1hIH0gZnJvbSAnLi9zY2hlbWEnXG5pbXBvcnQgeyB1aW50MTYsIHVpbnQ4IH0gZnJvbSAnLi92aWV3cydcbmltcG9ydCB7IGlzT2JqZWN0LCBpc0J1ZmZlclZpZXcgfSBmcm9tICcuL3V0aWxzJ1xuaW1wb3J0IHR5cGUgeyBTY2hlbWFPYmplY3QsIFNjaGVtYURlZmluaXRpb24gfSBmcm9tICcuL3R5cGVzJ1xuXG4vKipcbiAqIFRoZSBNb2RlbCBjbGFzcyBwcm92aWRlcyBhbiBBUEkgZm9yIHNlcmlhbGl6aW5nIGFuZCBkZXNlcmlhbGl6aW5nIEFycmF5QnVmZmVycyBpbnRvIG9iamVjdHNcbiAqIHNwZWNpZmllZCBieSB0aGVpciBTY2hlbWEgZGVmaW5pdGlvbnMuXG4gKi9cbmV4cG9ydCBjbGFzcyBNb2RlbDxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAvKipcbiAgICogVW5pcXVlIGlkZW50aWZpZXIgZGVub3RpbmcgdGhlIGJ1ZmZlcidzIHN0cnVjdHVyZSBpcyBhbiBhcnJheSBvZiBmbGF0dGVuZWQgaGFzaG1hcHMuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHJlYWRvbmx5IEJVRkZFUl9BUlJBWSA9IDBcbiAgLyoqXG4gICAqIFVuaXF1ZSBpZGVudGlmaWVyIGRlbm90aW5nIHRoZSBidWZmZXIncyBzdHJ1Y3R1cmUgaXMgYSBmbGF0dGVuZWQgaGFzaG1hcC5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgcmVhZG9ubHkgQlVGRkVSX09CSkVDVCA9IDFcbiAgLyoqXG4gICAqIFNjaGVtYSBkZWZpbml0aW9uIHJlZmVyZW5jZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzY2hlbWE6IFNjaGVtYTxUPlxuICAvKipcbiAgICogSW50ZXJuYWwgQnVmZmVyTWFuYWdlciByZWZlcmVuY2UuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgX2J1ZmZlcjogQnVmZmVyTWFuYWdlclxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBuZXcgTW9kZWwgaW5zdGFuY2UuXG4gICAqIEBwYXJhbSBzY2hlbWEgU2NoZW1hIGluc3RhbmNlIHRoYXQgdGhpcyBtb2RlbCBpcyBkZWZpbmVkIGJ5LlxuICAgKiBAcGFyYW0gYnVmZmVyU2l6ZSBUaGUgbWF4aW11bSBzaXplIG9mIHNlcmlhbGl6YWJsZSBkYXRhLiBEZWZhdWx0OiAxIG1lZ2FieXRlLlxuICAgKi9cbiAgcHVibGljIGNvbnN0cnVjdG9yKHNjaGVtYTogU2NoZW1hPFQ+LCBidWZmZXJTaXplPzogbnVtYmVyKSB7XG4gICAgdGhpcy5fYnVmZmVyID0gbmV3IEJ1ZmZlck1hbmFnZXIoYnVmZmVyU2l6ZSlcbiAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIE1vZGVsIGRpcmVjdGx5IGZyb20gdGhlIHByb3ZpZGVkIHNjaGVtYSBuYW1lIGFuZCBkZWZpbml0aW9uLlxuICAgKiBAcGFyYW0gbmFtZSBVbmlxdWUgbmFtZSBvZiB0aGUgc2NoZW1hLlxuICAgKiBAcGFyYW0gc3RydWN0IFN0cnVjdHVyZSBvZiB0aGUgc2NoZW1hLlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tU2NoZW1hRGVmaW5pdGlvbjxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+KFxuICAgIHN0cnVjdDogU2NoZW1hRGVmaW5pdGlvbjxUPixcbiAgICBpZD86IG51bWJlclxuICApOiBNb2RlbDxUPiB7XG4gICAgcmV0dXJuIG5ldyBNb2RlbChuZXcgU2NoZW1hPFQ+KHN0cnVjdCwgaWQpKVxuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgdGhlIHJvb3QgTW9kZWwgaWQgZnJvbSB0aGUgQXJyYXlCdWZmZXIuXG4gICAqIEBwYXJhbSBidWZmZXIgVGhlIEFycmF5QnVmZmVyIGZyb20gd2hpY2ggdG8gZXh0cmFjdCB0aGUgaWQuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGdldElkRnJvbUJ1ZmZlcihidWZmZXI6IEFycmF5QnVmZmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKVsxXVxuICB9XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6ZSBhbiBvYmplY3Qgb3IgYW4gYXJyYXkgb2Ygb2JqZWN0cyBkZWZpbmVkIGJ5IHRoaXMgTW9kZWwncyBzY2hlbWEgaW50byBhbiBBcnJheUJ1ZmZlci5cbiAgICogQHBhcmFtIG9iamVjdE9yQXJyYXkgVGhlIG9iamVjdCBvciBhcnJheSBvZiBvYmplY3RzIHRvIGJlIHNlcmlhbGl6ZWQuXG4gICAqL1xuICBwdWJsaWMgdG9CdWZmZXIob2JqZWN0T3JBcnJheTogU2NoZW1hT2JqZWN0PFQ+IHwgU2NoZW1hT2JqZWN0PFQ+W10pOiBBcnJheUJ1ZmZlciB7XG4gICAgdGhpcy5fYnVmZmVyLnJlZnJlc2goKVxuICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdE9yQXJyYXkpKSB7XG4gICAgICB0aGlzLl9idWZmZXIuYXBwZW5kKHVpbnQ4LCBNb2RlbC5CVUZGRVJfQVJSQVkpXG4gICAgICB0aGlzLl9idWZmZXIuYXBwZW5kKHVpbnQ4LCB0aGlzLnNjaGVtYS5pZClcbiAgICAgIHRoaXMuX2J1ZmZlci5hcHBlbmQodWludDE2LCBvYmplY3RPckFycmF5Lmxlbmd0aClcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqZWN0T3JBcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZShvYmplY3RPckFycmF5W2ldLCB0aGlzLnNjaGVtYS5zdHJ1Y3QpXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1ZmZlci5hcHBlbmQodWludDgsIE1vZGVsLkJVRkZFUl9PQkpFQ1QpXG4gICAgICB0aGlzLl9idWZmZXIuYXBwZW5kKHVpbnQ4LCB0aGlzLnNjaGVtYS5pZClcbiAgICAgIHRoaXMuc2VyaWFsaXplKG9iamVjdE9yQXJyYXksIHRoaXMuc2NoZW1hLnN0cnVjdClcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2J1ZmZlci5maW5hbGl6ZSgpXG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemUgYW4gQXJyYXlCdWZmZXIgdG8gcmVjb25zdHJ1Y3QgdGhlIG9yaWdpbmFsIG9iamVjdCBvciBhcnJheSBvZiBvYmplY3RzIGRlZmluZWQgYnlcbiAgICogdGhlIHNjaGVtYSBvZiB0aGlzIE1vZGVsLlxuICAgKiBAcGFyYW0gYnVmZmVyIFRoZSBBcnJheUJ1ZmZlciB0byBiZSBkZXNlcmlhbGl6ZWQuXG4gICAqIEBwYXJhbSBleHBlY3QgVGhlIGV4cGVjdGVkIGJ1ZmZlciB0eXBlIChpLmUuIGBNb2RlbC5CVUZGRVJfT0JKRUNUKSBmb3IgZGVzZXJpYWxpemF0aW9uLlxuICAgKi9cbiAgcHVibGljIGZyb21CdWZmZXIoYnVmZmVyOiBBcnJheUJ1ZmZlcik6IFNjaGVtYU9iamVjdDxUPiB8IFNjaGVtYU9iamVjdDxUPltdXG4gIHB1YmxpYyBmcm9tQnVmZmVyKGJ1ZmZlcjogQXJyYXlCdWZmZXIsIGV4cGVjdDogdHlwZW9mIE1vZGVsLkJVRkZFUl9PQkpFQ1QpOiBTY2hlbWFPYmplY3Q8VD5cbiAgcHVibGljIGZyb21CdWZmZXIoYnVmZmVyOiBBcnJheUJ1ZmZlciwgZXhwZWN0OiB0eXBlb2YgTW9kZWwuQlVGRkVSX0FSUkFZKTogU2NoZW1hT2JqZWN0PFQ+W11cbiAgcHVibGljIGZyb21CdWZmZXIoYnVmZmVyOiBBcnJheUJ1ZmZlciwgZXhwZWN0PzogbnVtYmVyKTogU2NoZW1hT2JqZWN0PFQ+IHwgU2NoZW1hT2JqZWN0PFQ+W10ge1xuICAgIGlmIChidWZmZXIuYnl0ZUxlbmd0aCA+IHRoaXMuX2J1ZmZlci5tYXhCeXRlU2l6ZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdCdWZmZXIgZXhjZWVkcyBtYXggYWxsb2NhdGlvbiBzaXplLicpXG4gICAgfVxuICAgIHRoaXMuX2J1ZmZlci5yZWZyZXNoKGJ1ZmZlcilcblxuICAgIC8vIERldGVybWluZSBpZiBzdHJ1Y3R1cmUgaXMgb2JqZWN0IG9yIGFycmF5XG4gICAgY29uc3QgYnVmZmVyVHlwZSA9IHRoaXMuX2J1ZmZlci5yZWFkKHVpbnQ4KVxuICAgIGlmIChleHBlY3QgJiYgZXhwZWN0ICE9PSBidWZmZXJUeXBlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIGJ1ZmZlciB0eXBlIHRvIGJlICR7ZXhwZWN0fSBidXQgZ290ICR7YnVmZmVyVHlwZX0uYClcbiAgICB9XG4gICAgaWYgKHRoaXMuX2J1ZmZlci5yZWFkKHVpbnQ4KSAhPT0gdGhpcy5zY2hlbWEuaWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRXhwZWN0ZWQgc2NoZW1hIGlkIHRvIGJlICR7dGhpcy5zY2hlbWEuaWR9YClcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgb2JqZWN0XG4gICAgaWYgKGJ1ZmZlclR5cGUgPT09IE1vZGVsLkJVRkZFUl9PQkpFQ1QpIHtcbiAgICAgIHJldHVybiB0aGlzLmRlc2VyaWFsaXplKHRoaXMuc2NoZW1hLnN0cnVjdCkgYXMgU2NoZW1hT2JqZWN0PFQ+XG4gICAgfVxuICAgIC8vIEhhbmRsZSBhcnJheVxuICAgIGNvbnN0IG51bUVsZW1lbnRzID0gdGhpcy5fYnVmZmVyLnJlYWQodWludDE2KVxuICAgIGNvbnN0IHJlc3VsdHM6IFNjaGVtYU9iamVjdDxUPltdID0gW11cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUVsZW1lbnRzOyBpKyspIHtcbiAgICAgIHJlc3VsdHMucHVzaCh0aGlzLmRlc2VyaWFsaXplKHRoaXMuc2NoZW1hLnN0cnVjdCkgYXMgU2NoZW1hT2JqZWN0PFQ+KVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0c1xuICB9XG5cbiAgLyoqXG4gICAqIFNlcmlhbGl6ZSBkYXRhIHRoYXQgYWRoZXJlcyB0byB0aGUgcHJvdmlkZWQgb2JqZWN0IHN0cnVjdHVyZS5cbiAgICogQHBhcmFtIGRhdGEgRGF0YSB0byBiZSBzZXJpYWxpemVkLlxuICAgKiBAcGFyYW0gc3RydWN0IE9iamVjdCBzdHJ1Y3R1cmUgaW4gdGhlIHNjaGVtYSBkZWZpbml0aW9uLlxuICAgKi9cbiAgcHJvdGVjdGVkIHNlcmlhbGl6ZShkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+LCBzdHJ1Y3Q6IFJlY29yZDxzdHJpbmcsIGFueT4pOiB2b2lkIHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoc3RydWN0KVxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZGF0YVByb3AgPSBkYXRhW2tleXNbaV1dIC8vIEFjdHVhbCBkYXRhIHZhbHVlc1xuICAgICAgY29uc3Qgc2NoZW1hUHJvcCA9IHN0cnVjdFtrZXlzW2ldXSAvLyBDb3JyZXNwb25kcyB3aXRoIHZhbHVlcyBmcm9tIHNjaGVtYVxuICAgICAgLy8gQnVmZmVyVmlld1xuICAgICAgaWYgKGlzQnVmZmVyVmlldyhzY2hlbWFQcm9wKSkge1xuICAgICAgICB0aGlzLl9idWZmZXIuYXBwZW5kKHNjaGVtYVByb3AsIGRhdGFQcm9wKVxuICAgICAgfVxuICAgICAgLy8gU2NoZW1hXG4gICAgICBlbHNlIGlmIChzY2hlbWFQcm9wIGluc3RhbmNlb2YgU2NoZW1hKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplKGRhdGFQcm9wLCBzY2hlbWFQcm9wLnN0cnVjdClcbiAgICAgIH1cbiAgICAgIC8vIEFycmF5XG4gICAgICBlbHNlIGlmIChBcnJheS5pc0FycmF5KHNjaGVtYVByb3ApKSB7XG4gICAgICAgIHRoaXMuX2J1ZmZlci5hcHBlbmQodWludDE2LCBkYXRhUHJvcC5sZW5ndGgpXG4gICAgICAgIGNvbnN0IGVsZW1lbnQgPSBzY2hlbWFQcm9wWzBdXG4gICAgICAgIC8vIFNjaGVtYVxuICAgICAgICBpZiAoZWxlbWVudCBpbnN0YW5jZW9mIFNjaGVtYSkge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YVByb3AubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuc2VyaWFsaXplKGRhdGFQcm9wW2ldLCBlbGVtZW50LnN0cnVjdClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQnVmZmVyVmlld1xuICAgICAgICBlbHNlIGlmIChpc0J1ZmZlclZpZXcoZWxlbWVudCkpIHtcbiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFQcm9wLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9idWZmZXIuYXBwZW5kKGVsZW1lbnQsIGRhdGFQcm9wW2ldKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gT2JqZWN0XG4gICAgICBlbHNlIGlmIChpc09iamVjdChzY2hlbWFQcm9wKSkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZShkYXRhUHJvcCwgc2NoZW1hUHJvcClcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVzZXJpYWxpemUgZGF0YSBmcm9tIHRoZSBBcnJheUJ1ZmZlciB0aGF0IGFkaGVyZXMgdG8gdGhlIHByb3ZpZGVkIG9iamVjdCBzdHJ1Y3R1cmUuXG4gICAqIEBwYXJhbSBzdHJ1Y3QgT2JqZWN0IHN0cnVjdHVyZSBpbiB0aGUgc2NoZW1hIGRlZmluaXRpb24uXG4gICAqL1xuICBwcm90ZWN0ZWQgZGVzZXJpYWxpemUoc3RydWN0OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogUmVjb3JkPHN0cmluZywgYW55PiB7XG4gICAgY29uc3QgZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHN0cnVjdClcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0cnVjdFZhbHVlID0gc3RydWN0W2tleXNbaV1dXG4gICAgICAvLyBCdWZmZXJWaWV3IGRlZmluaXRpb25cbiAgICAgIGlmIChpc0J1ZmZlclZpZXcoc3RydWN0VmFsdWUpKSB7XG4gICAgICAgIGRhdGFba2V5c1tpXV0gPSB0aGlzLl9idWZmZXIucmVhZChzdHJ1Y3RWYWx1ZSlcbiAgICAgIH1cbiAgICAgIC8vIEFycmF5IGRlZmluaXRpb25cbiAgICAgIGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoc3RydWN0VmFsdWUpKSB7XG4gICAgICAgIGNvbnN0IG51bUVsZW1lbnRzID0gdGhpcy5fYnVmZmVyLnJlYWQodWludDE2KVxuICAgICAgICBjb25zdCBlbGVtZW50ID0gc3RydWN0VmFsdWVbMF1cbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IFtdXG4gICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgU2NoZW1hKSB7XG4gICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1FbGVtZW50czsgaSsrKSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcy5kZXNlcmlhbGl6ZShlbGVtZW50LnN0cnVjdCkpXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGlzQnVmZmVyVmlldyhlbGVtZW50KSkge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtRWxlbWVudHM7IGkrKykge1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMuX2J1ZmZlci5yZWFkKGVsZW1lbnQpKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkYXRhW2tleXNbaV1dID0gcmVzdWx0c1xuICAgICAgfVxuICAgICAgLy8gU2NoZW1hIG9yIG9iamVjdCBkZWZpbml0aW9uXG4gICAgICBlbHNlIHtcbiAgICAgICAgZGF0YVtrZXlzW2ldXSA9IHRoaXMuZGVzZXJpYWxpemUoc3RydWN0VmFsdWUgaW5zdGFuY2VvZiBTY2hlbWEgPyBzdHJ1Y3RWYWx1ZS5zdHJ1Y3QgOiBzdHJ1Y3RWYWx1ZSlcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGFcbiAgfVxufVxuIiwiaW1wb3J0IHsgTmV0d29ya0lkIH0gZnJvbSAnQHhyZW5naW5lL2NvbW1vbi9zcmMvaW50ZXJmYWNlcy9OZXR3b3JrSWQnXG5pbXBvcnQgeyBzdHJpbmcsIGZsb2F0MzIsIFNjaGVtYSwgdWludDMyLCB1aW50OCwgdWludDY0LCBpbnQ4LCBib29sZWFuIH0gZnJvbSAnLi4vLi4vYXNzZXRzL3N1cGVyYnVmZmVyJ1xuaW1wb3J0IHsgTW9kZWwgfSBmcm9tICcuLi8uLi9hc3NldHMvc3VwZXJidWZmZXIvbW9kZWwnXG5cbi8qKlxuICogQGF1dGhvciBIeWRyYUZpcmUgPGdpdGh1Yi5jb20vSHlkcmFGaXJlPlxuICogQGF1dGhvciBKb3NoIEZpZWxkIDxnaXRodWIuY29tL0hleGFGaWVsZD5cbiAqL1xuXG5jb25zdCBwb3NlU2NoZW1hID0gbmV3IFNjaGVtYSh7XG4gIG5ldHdvcmtJZDogdWludDMyLFxuICBwb3NpdGlvbjogW2Zsb2F0MzJdLFxuICByb3RhdGlvbjogW2Zsb2F0MzJdLFxuICBsaW5lYXJWZWxvY2l0eTogW2Zsb2F0MzJdLFxuICBhbmd1bGFyVmVsb2NpdHk6IFtmbG9hdDMyXVxufSlcblxuY29uc3Qgam9pbnRUcmFuc2Zvcm1TY2hlbWEgPSBuZXcgU2NoZW1hKHtcbiAga2V5OiBzdHJpbmcsXG4gIHBvc2l0aW9uOiBbZmxvYXQzMl0sXG4gIHJvdGF0aW9uOiBbZmxvYXQzMl1cbn0pXG5cbmNvbnN0IGhhbmRQb3NlU2NoZW1hID0gbmV3IFNjaGVtYSh7XG4gIGpvaW50czogW2pvaW50VHJhbnNmb3JtU2NoZW1hXVxufSlcblxuY29uc3QgaGFuZHNQb3NlU2NoZW1hID0gbmV3IFNjaGVtYSh7XG4gIG5ldHdvcmtJZDogdWludDMyLFxuICBoYW5kczogW2hhbmRQb3NlU2NoZW1hXVxufSlcblxuY29uc3QgaWtQb3NlU2NoZW1hID0gbmV3IFNjaGVtYSh7XG4gIG5ldHdvcmtJZDogdWludDMyLFxuICBoZWFkUG9zZVBvc2l0aW9uOiBbZmxvYXQzMl0sXG4gIGhlYWRQb3NlUm90YXRpb246IFtmbG9hdDMyXSxcbiAgbGVmdFBvc2VQb3NpdGlvbjogW2Zsb2F0MzJdLFxuICBsZWZ0UG9zZVJvdGF0aW9uOiBbZmxvYXQzMl0sXG4gIHJpZ2h0UG9zZVBvc2l0aW9uOiBbZmxvYXQzMl0sXG4gIHJpZ2h0UG9zZVJvdGF0aW9uOiBbZmxvYXQzMl1cbn0pXG5cbmNvbnN0IG5ldHdvcmtTY2hlbWEgPSBuZXcgU2NoZW1hKHtcbiAgdGljazogdWludDMyLFxuICB0aW1lOiB1aW50NjQsXG4gIHBvc2U6IFtwb3NlU2NoZW1hXSxcbiAgaWtQb3NlOiBbaWtQb3NlU2NoZW1hXSxcbiAgaGFuZHNQb3NlOiBbaGFuZHNQb3NlU2NoZW1hXVxufSlcblxuLyoqIEludGVyZmFjZSBmb3Igd29ybGQgc3RhdGUuICovXG5leHBvcnQgaW50ZXJmYWNlIFdvcmxkU3RhdGVJbnRlcmZhY2Uge1xuICAvKiogQ3VycmVudCB3b3JsZCB0aWNrLiAqL1xuICB0aWNrOiBudW1iZXJcbiAgLyoqIEZvciBpbnRlcnBvbGF0aW9uLiAqL1xuICB0aW1lOiBudW1iZXJcbiAgLyoqIHRyYW5zZm9ybSBvZiB3b3JsZC4gKi9cbiAgcG9zZToge1xuICAgIG5ldHdvcmtJZDogTmV0d29ya0lkXG4gICAgcG9zaXRpb246IG51bWJlcltdXG4gICAgcm90YXRpb246IG51bWJlcltdXG4gICAgbGluZWFyVmVsb2NpdHk6IG51bWJlcltdXG4gICAgYW5ndWxhclZlbG9jaXR5OiBudW1iZXJbXVxuICB9W11cbiAgLyoqIHRyYW5zZm9ybSBvZiBpayBhdmF0YXJzLiAqL1xuICBpa1Bvc2U6IHtcbiAgICBuZXR3b3JrSWQ6IE5ldHdvcmtJZFxuICAgIGhlYWRQb3NlUG9zaXRpb246IG51bWJlcltdXG4gICAgaGVhZFBvc2VSb3RhdGlvbjogbnVtYmVyW11cbiAgICBsZWZ0UG9zZVBvc2l0aW9uOiBudW1iZXJbXVxuICAgIGxlZnRQb3NlUm90YXRpb246IG51bWJlcltdXG4gICAgcmlnaHRQb3NlUG9zaXRpb246IG51bWJlcltdXG4gICAgcmlnaHRQb3NlUm90YXRpb246IG51bWJlcltdXG4gIH1bXVxuICBoYW5kc1Bvc2U6IHtcbiAgICBuZXR3b3JrSWQ6IE5ldHdvcmtJZFxuICAgIGhhbmRzOiB7XG4gICAgICBqb2ludHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGtleTogc3RyaW5nXG4gICAgICAgICAgcG9zaXRpb246IG51bWJlcltdXG4gICAgICAgICAgcm90YXRpb246IG51bWJlcltdXG4gICAgICAgIH1cbiAgICAgIF1cbiAgICB9W11cbiAgfVtdXG59XG5cbmV4cG9ydCBjbGFzcyBXb3JsZFN0YXRlTW9kZWwge1xuICBzdGF0aWMgbW9kZWw6IE1vZGVsID0gbmV3IE1vZGVsKG5ldHdvcmtTY2hlbWEpXG5cbiAgc3RhdGljIHRvQnVmZmVyKHdvcmxkU3RhdGU6IFdvcmxkU3RhdGVJbnRlcmZhY2UpOiBBcnJheUJ1ZmZlciB7XG4gICAgd29ybGRTdGF0ZS50aW1lID0gRGF0ZS5ub3coKVxuICAgIHJldHVybiBXb3JsZFN0YXRlTW9kZWwubW9kZWwudG9CdWZmZXIod29ybGRTdGF0ZSBhcyBhbnkpXG4gIH1cblxuICBzdGF0aWMgZnJvbUJ1ZmZlcihidWZmZXI6IGFueSk6IFdvcmxkU3RhdGVJbnRlcmZhY2Uge1xuICAgIGNvbnN0IHN0YXRlID0gV29ybGRTdGF0ZU1vZGVsLm1vZGVsLmZyb21CdWZmZXIoYnVmZmVyKSBhcyBhbnlcbiAgICByZXR1cm4ge1xuICAgICAgLi4uc3RhdGUsXG4gICAgICB0aW1lOiBOdW1iZXIoc3RhdGUudGltZSkgLy8gY2FzdCBmcm9tIGJpZ2ludCB0byBudW1iZXJcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6W10s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
