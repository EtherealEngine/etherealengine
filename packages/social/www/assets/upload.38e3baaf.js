import{i as p}from"./vendor.c8b8cc93.js";import{C as b}from"./index.0040ebb6.js";function A(r){if(!r)return"";if(r.message)return r.message;const t=r.target;return t?r.target.error&&r.target.error.message?t.error.message:r.target.src?`Failed to load "${t.src}"`:t instanceof XMLHttpRequest?`Network Error: ${t.status||"Unknown Status."} ${t.statusText||"Unknown Error. Possibly a CORS error."}`:`Unknown error on ${t}.`:`Unknown error: "${JSON.stringify(r)}"`}class h extends Error{constructor(t){super(t);this.name=this.constructor.name,this.message=t,typeof Error.captureStackTrace=="function"?Error.captureStackTrace(this,this.constructor):this.stack=new Error(t).stack}}class F extends h{originalError;constructor(t,e){super(`${t}:
  Cause:
    ${A(e).replace(/\n/g,`
    `)}`);this.originalError=e,this.stack+=`
`+e.stack}}class U extends h{constructor(t,e){let a=`${t}:

${e.length} Error${e.length>1?"s":""}:`;for(const o of e){const i=o.message?o.message.replace(/\n/g,`
  `):"Unknown Error";a+=`
  `+i}super(a)}}const w=[".mp3",".mpeg","audio/mpeg"],_=[".mp4","video/mp4"],$=[".png",".jpeg",".jpg",".gif","image/png","image/jpeg","image/gif"],x=[".glb","model/gltf-binary"],E=[".tsx",".ts",".js"],L=[...w,..._,...$,...x,...E],j=L.join(","),k=()=>{const r=localStorage.getItem(b.publicRuntimeConfig.feathersStoreKey);if(r==null||r.length===0)throw new Error(p.t("editor:errors.notAuthenticated"));return r},f=b.publicRuntimeConfig.apiServer;let y=0;const T=async(r,t,e,a,o)=>{const i=k();return await new Promise((l,c)=>{const s=new XMLHttpRequest,d=()=>{s.abort();const n=new Error(p.t("editor:errors.uploadAborted"));n.name="AbortError",n.aborted=!0,c(n)};e&&e.addEventListener("abort",d),console.log("Posting to: ",`${f}/media`),s.open("post",`${f}/media`,!0),s.upload.addEventListener("progress",n=>{t&&t(n.loaded/n.total)}),s.addEventListener("error",n=>{e&&e.removeEventListener("abort",d),c(new F(p.t("editor:errors.uploadFailed"),n))}),s.addEventListener("load",()=>{if(e&&e.removeEventListener("abort",d),s.status<300){const n=JSON.parse(s.responseText);l(n)}else c(new Error(p.t("editor:errors.uploadFailed",{reason:s.statusText})))});const u=new FormData;o&&u.set("projectId",o),a&&u.set("fileIdentifier",a),u.set("media",r),s.setRequestHeader("Authorization",`Bearer ${i}`),s.send(u)})},q=async(r,t,e,a)=>await v(`${f}/static-resource`,r,t,e,a),v=async(r,t,e,a,o)=>{const i=[];for(const l of Array.from(e)){if(o.aborted)break;const c=new AbortController,s=()=>c.abort();o.addEventListener("abort",s);const d=await S(r,t,l,u=>a(i.length+1,e.length,u),c.signal);if(i.push(d),o.removeEventListener("abort",s),o.aborted)break}return i};function C(r,t){for(const e of t)if(e.startsWith(".")){if(r.name.toLowerCase().endsWith(e))return!0}else if(r.type.startsWith(e))return!0;return!1}const S=async(r,t,e,a,o)=>{let i=null,l=null;if(!C(e,[...w,...E])){const m=await t.generateFileThumbnail(e),g=await T(m,void 0,o);i=g.file_id,l=g.meta.access_token}const{file_id:c,meta:{access_token:s,expected_content_type:d},origin:u}=await T(e,a,o),n=Date.now()-y;return n<1100&&await new Promise(m=>setTimeout(m,1100-n)),k(),JSON.stringify({asset:{name:e.name,file_id:c,access_token:s,thumbnail_file_id:i,thumbnail_access_token:l}}),y=Date.now(),{id:c,name:e.name,url:u,type:"application/octet-stream",images:{preview:{url:e.thumbnail_url}}}};export{j as A,$ as I,x as M,F as R,_ as V,q as a,L as b,w as c,U as d,k as g,T as u};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLjM4ZTNiYWFmLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9lbmdpbmUvc3JjL3NjZW5lL2Z1bmN0aW9ucy9lcnJvcnMudHMiLCIuLi8uLi8uLi9lbmdpbmUvc3JjL2Fzc2V0cy9jb25zdGFudHMvZmlsZVR5cGVzLnRzeCIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvc2NlbmUvZnVuY3Rpb25zL2dldFRva2VuLnRzeCIsIi4uLy4uLy4uL2VuZ2luZS9zcmMvc2NlbmUvZnVuY3Rpb25zL3VwbG9hZC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZXZlbnRUb01lc3NhZ2UoZXZlbnQpIHtcbiAgaWYgKCFldmVudCkgcmV0dXJuICcnXG4gIGlmIChldmVudC5tZXNzYWdlKSByZXR1cm4gZXZlbnQubWVzc2FnZVxuICBjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXRcbiAgaWYgKHRhcmdldCkge1xuICAgIGlmIChldmVudC50YXJnZXQuZXJyb3IgJiYgZXZlbnQudGFyZ2V0LmVycm9yLm1lc3NhZ2UpIHJldHVybiB0YXJnZXQuZXJyb3IubWVzc2FnZVxuICAgIGlmIChldmVudC50YXJnZXQuc3JjKSByZXR1cm4gYEZhaWxlZCB0byBsb2FkIFwiJHt0YXJnZXQuc3JjfVwiYFxuICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBYTUxIdHRwUmVxdWVzdCkge1xuICAgICAgcmV0dXJuIGBOZXR3b3JrIEVycm9yOiAke3RhcmdldC5zdGF0dXMgfHwgJ1Vua25vd24gU3RhdHVzLid9ICR7XG4gICAgICAgIHRhcmdldC5zdGF0dXNUZXh0IHx8ICdVbmtub3duIEVycm9yLiBQb3NzaWJseSBhIENPUlMgZXJyb3IuJ1xuICAgICAgfWBcbiAgICB9XG4gICAgcmV0dXJuIGBVbmtub3duIGVycm9yIG9uICR7dGFyZ2V0fS5gXG4gIH1cbiAgcmV0dXJuIGBVbmtub3duIGVycm9yOiBcIiR7SlNPTi5zdHJpbmdpZnkoZXZlbnQpfVwiYFxufVxuLy8gQmFzZSBlcnJvciBjbGFzcyB0byBiZSB1c2VkIGZvciBhbGwgY3VzdG9tIGVycm9ycy5cbmV4cG9ydCBjbGFzcyBCYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIGNvbnN0cnVjdG9yKG1lc3NhZ2UpIHtcbiAgICBzdXBlcihtZXNzYWdlKVxuICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZVxuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2VcbiAgICBpZiAodHlwZW9mIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCB0aGlzLmNvbnN0cnVjdG9yKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0YWNrID0gbmV3IEVycm9yKG1lc3NhZ2UpLnN0YWNrXG4gICAgfVxuICB9XG59XG4vLyBPdmVycmlkZSB0aGUgbWVzc2FnZSBvZiBhbiBlcnJvciBidXQgYXBwZW5kIHRoZSBleGlzdGluZyBzdGFjayB0cmFjZS5cbmV4cG9ydCBjbGFzcyBSZXRocm93bkVycm9yIGV4dGVuZHMgQmFzZUVycm9yIHtcbiAgb3JpZ2luYWxFcnJvclxuICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBlcnJvcikge1xuICAgIHN1cGVyKGAke21lc3NhZ2V9OlxcbiAgQ2F1c2U6XFxuICAgICR7ZXZlbnRUb01lc3NhZ2UoZXJyb3IpLnJlcGxhY2UoL1xcbi9nLCAnXFxuICAgICcpfWApXG4gICAgdGhpcy5vcmlnaW5hbEVycm9yID0gZXJyb3JcbiAgICB0aGlzLnN0YWNrICs9ICdcXG4nICsgZXJyb3Iuc3RhY2tcbiAgfVxufVxuLy8gT3V0cHV0IG1lc3NhZ2VzIGZvciBtdWx0aXBsZSBlcnJvcnMuXG4vL1xuLy8gRXhhbXBsZTogbmV3IE11bHRpRXJyb3IoXCJFcnJvciBsb2FkaW5nIHByb2plY3RcIiwgZXJyb3JzKTtcbi8vIE91dHB1dDpcbi8vICBFcnJvciBsb2FkaW5nIHByb2plY3Q6XG4vL1xuLy8gIDIgRXJyb3JzOlxuLy8gICAgTW9kZWwgXCJFeGFtcGxlIE1vZGVsXCIgY291bGQgbm90IGJlIGxvYWRlZDpcbi8vICAgICAgQ2F1c2U6XG4vLyAgICAgICAgTmV0d29yayBFcnJvcjogVW5rbm93biBlcnJvci4gUG9zc2libHkgY2F1c2VkIGJ5IGltcHJvcGVyIENPUlMgaGVhZGVycy5cbi8vICAgIEltYWdlIFwiRXhhbXBsZSBJbWFnZVwiIGNvdWxkIG5vdCBiZSBsb2FkZWQuXG4vLyAgICAgIE5ldHdvcmsgRXJyb3I6IDQwNCBQYWdlIG5vdCBmb3VuZC5cbmV4cG9ydCBjbGFzcyBNdWx0aUVycm9yIGV4dGVuZHMgQmFzZUVycm9yIHtcbiAgY29uc3RydWN0b3IobWVzc2FnZSwgZXJyb3JzKSB7XG4gICAgbGV0IGZpbmFsTWVzc2FnZSA9IGAke21lc3NhZ2V9OlxcblxcbiR7ZXJyb3JzLmxlbmd0aH0gRXJyb3Ike2Vycm9ycy5sZW5ndGggPiAxID8gJ3MnIDogJyd9OmBcbiAgICBmb3IgKGNvbnN0IGVycm9yIG9mIGVycm9ycykge1xuICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZSA/IGVycm9yLm1lc3NhZ2UucmVwbGFjZSgvXFxuL2csICdcXG4gICcpIDogJ1Vua25vd24gRXJyb3InXG4gICAgICBmaW5hbE1lc3NhZ2UgKz0gJ1xcbiAgJyArIGVycm9yTWVzc2FnZVxuICAgIH1cbiAgICBzdXBlcihmaW5hbE1lc3NhZ2UpXG4gIH1cbn1cbiIsIi8vIGFycmF5IGNvbnRhaW5pbmcgYXVkaW8gZmlsZSB0eXBlXG5leHBvcnQgY29uc3QgQXVkaW9GaWxlVHlwZXMgPSBbJy5tcDMnLCAnLm1wZWcnLCAnYXVkaW8vbXBlZyddXG4vL2FycmF5IGNvbnRhaW5pbmcgdmlkZW8gZmlsZSB0eXBlXG5leHBvcnQgY29uc3QgVmlkZW9GaWxlVHlwZXMgPSBbJy5tcDQnLCAndmlkZW8vbXA0J11cbi8vYXJyYXkgY29udGFpbmluZyBpbWFnZSBmaWxlcyB0eXBlc1xuZXhwb3J0IGNvbnN0IEltYWdlRmlsZVR5cGVzID0gWycucG5nJywgJy5qcGVnJywgJy5qcGcnLCAnLmdpZicsICdpbWFnZS9wbmcnLCAnaW1hZ2UvanBlZycsICdpbWFnZS9naWYnXVxuLy9hcnJheSBjb250YWluaW5nIG1vZGVsIGZpbGUgdHlwZS5cbmV4cG9ydCBjb25zdCBNb2RlbEZpbGVUeXBlcyA9IFsnLmdsYicsICdtb2RlbC9nbHRmLWJpbmFyeSddXG4vL2FycmF5IGNvbnRhaW5pbmcgY3VzdG9tIHNjcmlwdCB0eXBlLlxuZXhwb3J0IGNvbnN0IEN1c3RvbVNjcmlwdEZpbGVUeXBlcyA9IFsnLnRzeCcsICcudHMnLCAnLmpzJ11cbi8vYXJyYXkgY29udGFpbnMgYXJyYXlzIG9mIGFsbCBmaWxlcyB0eXBlcy5cbmV4cG9ydCBjb25zdCBBbGxGaWxlVHlwZXMgPSBbXG4gIC4uLkF1ZGlvRmlsZVR5cGVzLFxuICAuLi5WaWRlb0ZpbGVUeXBlcyxcbiAgLi4uSW1hZ2VGaWxlVHlwZXMsXG4gIC4uLk1vZGVsRmlsZVR5cGVzLFxuICAuLi5DdXN0b21TY3JpcHRGaWxlVHlwZXNcbl1cblxuLy9jcmVhdGlnIGNvbW1hIHNhcGVyYXRlZCBzdHJpbmcgY29udGFpbnMgYWxsIGZpbGUgdHlwZXNcbmV4cG9ydCBjb25zdCBBY2NlcHRzQWxsRmlsZVR5cGVzID0gQWxsRmlsZVR5cGVzLmpvaW4oJywnKVxuIiwiaW1wb3J0IGkxOG4gZnJvbSAnaTE4bmV4dCdcbmltcG9ydCB7IENvbmZpZyB9IGZyb20gJ0B4cmVuZ2luZS9jb21tb24vc3JjL2NvbmZpZydcblxuLyoqXG4gKiBnZXRUb2tlbiB1c2VkIHRvIGdldCB0aGUgdG9rZW4gb2YgbG9naW5lZCB1c2VyLlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEByZXR1cm4ge3N0cmluZ30gICAgICAgIFtyZXR1cm5zIHRva2VuIHN0cmluZ11cbiAqL1xuXG5leHBvcnQgY29uc3QgZ2V0VG9rZW4gPSAoKTogc3RyaW5nID0+IHtcbiAgY29uc3QgdG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShDb25maWcucHVibGljUnVudGltZUNvbmZpZy5mZWF0aGVyc1N0b3JlS2V5KVxuXG4gIGlmICh0b2tlbiA9PSBudWxsIHx8IHRva2VuLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihpMThuLnQoJ2VkaXRvcjplcnJvcnMubm90QXV0aGVudGljYXRlZCcpKVxuICB9XG5cbiAgcmV0dXJuIHRva2VuXG59XG4iLCJpbXBvcnQgeyBSZXRocm93bkVycm9yIH0gZnJvbSAnLi4vLi4vc2NlbmUvZnVuY3Rpb25zL2Vycm9ycydcbmltcG9ydCBpMThuIGZyb20gJ2kxOG5leHQnXG5pbXBvcnQgeyBBdWRpb0ZpbGVUeXBlcywgQ3VzdG9tU2NyaXB0RmlsZVR5cGVzIH0gZnJvbSAnLi4vLi4vYXNzZXRzL2NvbnN0YW50cy9maWxlVHlwZXMnXG5pbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJy4vZ2V0VG9rZW4nXG5pbXBvcnQgeyBDb25maWcgfSBmcm9tICdAeHJlbmdpbmUvY29tbW9uL3NyYy9jb25maWcnXG5cbmNvbnN0IHNlcnZlclVSTCA9IENvbmZpZy5wdWJsaWNSdW50aW1lQ29uZmlnLmFwaVNlcnZlclxuXG5sZXQgbGFzdFVwbG9hZEFzc2V0UmVxdWVzdCA9IDBcblxuLyoqXG4gKiB1cGxvYWQgdXNlZCB0byB1cGxvYWQgaW1hZ2UgYXMgYmxvYiBkYXRhLlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSAge2FueX0gIGJsb2JcbiAqIEBwYXJhbSAge2FueX0gIG9uVXBsb2FkUHJvZ3Jlc3NcbiAqIEBwYXJhbSAge2FueX0gIHNpZ25hbFxuICogQHBhcmFtICB7YW55fSAgcHJvamVjdElkXG4gKiBAcGFyYW0gIHtzdHJpbmd9ICBmaWxlSWRlbnRpZmllclxuICogQHJldHVybiB7UHJvbWlzZX1cbiAqL1xuXG5leHBvcnQgY29uc3QgdXBsb2FkID0gYXN5bmMgKGJsb2IsIG9uVXBsb2FkUHJvZ3Jlc3MsIHNpZ25hbD8sIGZpbGVJZGVudGlmaWVyPywgcHJvamVjdElkPyk6IFByb21pc2U8dm9pZD4gPT4ge1xuICBjb25zdCB0b2tlbiA9IGdldFRva2VuKClcblxuICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKVxuICAgIGNvbnN0IG9uQWJvcnQgPSAoKSA9PiB7XG4gICAgICByZXF1ZXN0LmFib3J0KClcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGkxOG4udCgnZWRpdG9yOmVycm9ycy51cGxvYWRBYm9ydGVkJykpXG4gICAgICBlcnJvci5uYW1lID0gJ0Fib3J0RXJyb3InXG4gICAgICBlcnJvclsnYWJvcnRlZCddID0gdHJ1ZVxuICAgICAgcmVqZWN0KGVycm9yKVxuICAgIH1cblxuICAgIGlmIChzaWduYWwpIHtcbiAgICAgIHNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsIG9uQWJvcnQpXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKCdQb3N0aW5nIHRvOiAnLCBgJHtzZXJ2ZXJVUkx9L21lZGlhYClcblxuICAgIHJlcXVlc3Qub3BlbigncG9zdCcsIGAke3NlcnZlclVSTH0vbWVkaWFgLCB0cnVlKVxuXG4gICAgcmVxdWVzdC51cGxvYWQuYWRkRXZlbnRMaXN0ZW5lcigncHJvZ3Jlc3MnLCAoZSkgPT4ge1xuICAgICAgaWYgKG9uVXBsb2FkUHJvZ3Jlc3MpIHtcbiAgICAgICAgb25VcGxvYWRQcm9ncmVzcyhlLmxvYWRlZCAvIGUudG90YWwpXG4gICAgICB9XG4gICAgfSlcblxuICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgIGlmIChzaWduYWwpIHtcbiAgICAgICAgc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25BYm9ydClcbiAgICAgIH1cbiAgICAgIHJlamVjdChuZXcgUmV0aHJvd25FcnJvcihpMThuLnQoJ2VkaXRvcjplcnJvcnMudXBsb2FkRmFpbGVkJyksIGVycm9yKSlcbiAgICB9KVxuXG4gICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgKCkgPT4ge1xuICAgICAgaWYgKHNpZ25hbCkge1xuICAgICAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuICAgICAgfVxuXG4gICAgICBpZiAocmVxdWVzdC5zdGF0dXMgPCAzMDApIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcXVlc3QucmVzcG9uc2VUZXh0KVxuICAgICAgICByZXNvbHZlKHJlc3BvbnNlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihpMThuLnQoJ2VkaXRvcjplcnJvcnMudXBsb2FkRmFpbGVkJywgeyByZWFzb246IHJlcXVlc3Quc3RhdHVzVGV4dCB9KSkpXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKClcbiAgICBpZiAocHJvamVjdElkKSB7XG4gICAgICBmb3JtRGF0YS5zZXQoJ3Byb2plY3RJZCcsIHByb2plY3RJZClcbiAgICB9XG4gICAgaWYgKGZpbGVJZGVudGlmaWVyKSB7XG4gICAgICBmb3JtRGF0YS5zZXQoJ2ZpbGVJZGVudGlmaWVyJywgZmlsZUlkZW50aWZpZXIpXG4gICAgfVxuXG4gICAgZm9ybURhdGEuc2V0KCdtZWRpYScsIGJsb2IpXG4gICAgcmVxdWVzdC5zZXRSZXF1ZXN0SGVhZGVyKCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke3Rva2VufWApXG5cbiAgICByZXF1ZXN0LnNlbmQoZm9ybURhdGEpXG4gIH0pXG59XG4vKipcbiAqIHVwbG9hZEFzc2V0cyB1c2VkIHRvIHVwbG9hZCBhc3NldCBmaWxlcy5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0gIHthbnl9IGVkaXRvciAgICAgW2NvbnRhaW5zIGVkaXRvciBkYXRhXVxuICogQHBhcmFtICB7YW55fSBmaWxlcyAgICAgIFtmaWxlcyBmb3IgdXBsb2FkXVxuICogQHBhcmFtICB7YW55fSBvblByb2dyZXNzXG4gKiBAcGFyYW0gIHthbnl9IHNpZ25hbFxuICogQHJldHVybiB7YW55fSAgICAgICAgICAgIFt1cGxvYWRlZCBmaWxlIGFzc2V0c11cbiAqL1xuZXhwb3J0IGNvbnN0IHVwbG9hZEFzc2V0cyA9IGFzeW5jIChlZGl0b3IsIGZpbGVzLCBvblByb2dyZXNzLCBzaWduYWwpOiBQcm9taXNlPGFueT4gPT4ge1xuICByZXR1cm4gYXdhaXQgX3VwbG9hZEFzc2V0cyhgJHtzZXJ2ZXJVUkx9L3N0YXRpYy1yZXNvdXJjZWAsIGVkaXRvciwgZmlsZXMsIG9uUHJvZ3Jlc3MsIHNpZ25hbClcbn1cbi8qKlxuICogX3VwbG9hZEFzc2V0cyB1c2VkIGFzIGFwaSBoYW5kbGVyIGZvciB1cGxvYWRBc3NldC5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0gIHthbnl9ICBlbmRwb2ludFxuICogQHBhcmFtICB7YW55fSAgZWRpdG9yXG4gKiBAcGFyYW0gIHthbnl9ICBmaWxlc1xuICogQHBhcmFtICB7YW55fSAgb25Qcm9ncmVzc1xuICogQHBhcmFtICB7YW55fSAgc2lnbmFsXG4gKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgICAgIFthc3NldHMgZmlsZSBkYXRhXVxuICovXG5cbmV4cG9ydCBjb25zdCBfdXBsb2FkQXNzZXRzID0gYXN5bmMgKGVuZHBvaW50LCBlZGl0b3IsIGZpbGVzLCBvblByb2dyZXNzLCBzaWduYWwpOiBQcm9taXNlPGFueT4gPT4ge1xuICBjb25zdCBhc3NldHM6IGFueVtdID0gW11cblxuICBmb3IgKGNvbnN0IGZpbGUgb2YgQXJyYXkuZnJvbShmaWxlcykpIHtcbiAgICBpZiAoc2lnbmFsLmFib3J0ZWQpIHtcbiAgICAgIGJyZWFrXG4gICAgfVxuXG4gICAgY29uc3QgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpXG4gICAgY29uc3Qgb25BYm9ydCA9ICgpID0+IGFib3J0Q29udHJvbGxlci5hYm9ydCgpXG4gICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25BYm9ydClcblxuICAgIGNvbnN0IGFzc2V0ID0gYXdhaXQgX3VwbG9hZEFzc2V0KFxuICAgICAgZW5kcG9pbnQsXG4gICAgICBlZGl0b3IsXG4gICAgICBmaWxlLFxuICAgICAgKHByb2dyZXNzKSA9PiBvblByb2dyZXNzKGFzc2V0cy5sZW5ndGggKyAxLCBmaWxlcy5sZW5ndGgsIHByb2dyZXNzKSxcbiAgICAgIGFib3J0Q29udHJvbGxlci5zaWduYWxcbiAgICApXG5cbiAgICBhc3NldHMucHVzaChhc3NldClcbiAgICBzaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbkFib3J0KVxuXG4gICAgaWYgKHNpZ25hbC5hYm9ydGVkKSB7XG4gICAgICBicmVha1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhc3NldHNcbn1cbi8qKlxuICogdXBsb2FkQXNzZXQgdXNlZCB0byB1cGxvYWQgc2luZ2xlIGZpbGUgYXMgYXNzZXQuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtIHthbnl9IGVkaXRvclxuICogQHBhcmFtIHthbnl9IGZpbGVcbiAqIEBwYXJhbSB7YW55fSBvblByb2dyZXNzXG4gKiBAcGFyYW0ge2FueX0gc2lnbmFsXG4gKi9cblxuZXhwb3J0IGNvbnN0IHVwbG9hZEFzc2V0ID0gKGVkaXRvciwgZmlsZSwgb25Qcm9ncmVzcywgc2lnbmFsKTogYW55ID0+IHtcbiAgcmV0dXJuIF91cGxvYWRBc3NldChgJHtzZXJ2ZXJVUkx9L3N0YXRpYy1yZXNvdXJjZWAsIGVkaXRvciwgZmlsZSwgb25Qcm9ncmVzcywgc2lnbmFsKVxufVxuXG4vKipcbiAqIG1hdGNoZXNGaWxlVHlwZXMgZnVuY3Rpb24gdXNlZCB0byBtYXRjaCBmaWxlIHR5cGUgd2l0aCBleGlzdGluZyBmaWxlIHR5cGVzLlxuICpcbiAqIEBhdXRob3IgUm9iZXJ0IExvbmdcbiAqIEBwYXJhbSAge09iamVjdH0gZmlsZSAgICAgIFtvYmplY3QgY29udGFpbnMgZmlsZSBkYXRhXVxuICogQHBhcmFtICB7YXJyYXl9IGZpbGVUeXBlcyBbQXJyYXkgY29udGFpbnMgZXhpc3RpbmcgZmlsZSB0eXBlc11cbiAqIEByZXR1cm4ge2Jvb2xlYW59ICAgICAgICAgICBbdHJ1ZSBpZiBmaWxlIHR5cGUgZm91bmQgaW4gZXhpc3RpbmcgZmlsZVR5cGVzXVxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaGVzRmlsZVR5cGVzKGZpbGUsIGZpbGVUeXBlcykge1xuICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgZmlsZVR5cGVzKSB7XG4gICAgaWYgKHBhdHRlcm4uc3RhcnRzV2l0aCgnLicpKSB7XG4gICAgICBpZiAoZmlsZS5uYW1lLnRvTG93ZXJDYXNlKCkuZW5kc1dpdGgocGF0dGVybikpIHtcbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGZpbGUudHlwZS5zdGFydHNXaXRoKHBhdHRlcm4pKSB7XG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxuLyoqXG4gKiB1cGxvYWRQcm9qZWN0QXNzZXQgdXNlZCB0byBjYWxsIF91cGxvYWRBc3NldCBkaXJlY3RseS5cbiAqXG4gKiBAYXV0aG9yIFJvYmVydCBMb25nXG4gKiBAcGFyYW0ge2FueX0gZWRpdG9yXG4gKiBAcGFyYW0ge2FueX0gcHJvamVjdElkXG4gKiBAcGFyYW0ge2FueX0gZmlsZVxuICogQHBhcmFtIHthbnl9IG9uUHJvZ3Jlc3NcbiAqIEBwYXJhbSB7YW55fSBzaWduYWxcbiAqL1xuXG5leHBvcnQgY29uc3QgdXBsb2FkUHJvamVjdEFzc2V0ID0gKGVkaXRvciwgcHJvamVjdElkLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpOiBhbnkgPT4ge1xuICByZXR1cm4gX3VwbG9hZEFzc2V0KGAke3NlcnZlclVSTH0vcHJvamVjdC8ke3Byb2plY3RJZH0vYXNzZXRzYCwgZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpXG59XG4vKipcbiAqIF91cGxvYWRBc3NldCB1c2VkIGFzIGFwaSBoYW5kbGVyIGZvciB0aGUgdXBsb2FkQXNzZXQuXG4gKlxuICogQGF1dGhvciBSb2JlcnQgTG9uZ1xuICogQHBhcmFtICB7YW55fSAgZW5kcG9pbnRcbiAqIEBwYXJhbSAge2FueX0gIGVkaXRvclxuICogQHBhcmFtICB7YW55fSAgZmlsZVxuICogQHBhcmFtICB7YW55fSAgb25Qcm9ncmVzc1xuICogQHBhcmFtICB7YW55fSAgc2lnbmFsXG4gKiBAcmV0dXJuIHtQcm9taXNlfSAgICAgICAgICAgIFt1cGxvYWRlZCBhc3NldCBmaWxlIGRhdGFdXG4gKi9cblxuZXhwb3J0IGNvbnN0IF91cGxvYWRBc3NldCA9IGFzeW5jIChlbmRwb2ludCwgZWRpdG9yLCBmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpOiBQcm9taXNlPGFueT4gPT4ge1xuICBsZXQgdGh1bWJuYWlsRmlsZUlkID0gbnVsbFxuICBsZXQgdGh1bWJuYWlsQWNjZXNzVG9rZW4gPSBudWxsXG5cbiAgaWYgKCFtYXRjaGVzRmlsZVR5cGVzKGZpbGUsIFsuLi5BdWRpb0ZpbGVUeXBlcywgLi4uQ3VzdG9tU2NyaXB0RmlsZVR5cGVzXSkpIHtcbiAgICBjb25zdCB0aHVtYm5haWxCbG9iID0gYXdhaXQgZWRpdG9yLmdlbmVyYXRlRmlsZVRodW1ibmFpbChmaWxlKVxuXG4gICAgY29uc3QgcmVzcG9uc2UgPSAoYXdhaXQgdXBsb2FkKHRodW1ibmFpbEJsb2IsIHVuZGVmaW5lZCwgc2lnbmFsKSkgYXMgYW55XG5cbiAgICB0aHVtYm5haWxGaWxlSWQgPSByZXNwb25zZS5maWxlX2lkXG4gICAgdGh1bWJuYWlsQWNjZXNzVG9rZW4gPSByZXNwb25zZS5tZXRhLmFjY2Vzc190b2tlblxuICB9XG5cbiAgY29uc3Qge1xuICAgIGZpbGVfaWQ6IGFzc2V0RmlsZUlkLFxuICAgIG1ldGE6IHsgYWNjZXNzX3Rva2VuOiBhc3NldEFjY2Vzc1Rva2VuLCBleHBlY3RlZF9jb250ZW50X3R5cGU6IGV4cGVjdGVkQ29udGVudFR5cGUgfSxcbiAgICBvcmlnaW46IG9yaWdpblxuICB9ID0gKGF3YWl0IHVwbG9hZChmaWxlLCBvblByb2dyZXNzLCBzaWduYWwpKSBhcyBhbnlcblxuICBjb25zdCBkZWx0YSA9IERhdGUubm93KCkgLSBsYXN0VXBsb2FkQXNzZXRSZXF1ZXN0XG5cbiAgaWYgKGRlbHRhIDwgMTEwMCkge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDExMDAgLSBkZWx0YSkpXG4gIH1cblxuICBjb25zdCB0b2tlbiA9IGdldFRva2VuKClcblxuICBjb25zdCBoZWFkZXJzID0ge1xuICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgYXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWBcbiAgfVxuXG4gIGNvbnN0IGJvZHkgPSBKU09OLnN0cmluZ2lmeSh7XG4gICAgYXNzZXQ6IHtcbiAgICAgIG5hbWU6IGZpbGUubmFtZSxcbiAgICAgIGZpbGVfaWQ6IGFzc2V0RmlsZUlkLFxuICAgICAgYWNjZXNzX3Rva2VuOiBhc3NldEFjY2Vzc1Rva2VuLFxuICAgICAgdGh1bWJuYWlsX2ZpbGVfaWQ6IHRodW1ibmFpbEZpbGVJZCxcbiAgICAgIHRodW1ibmFpbF9hY2Nlc3NfdG9rZW46IHRodW1ibmFpbEFjY2Vzc1Rva2VuXG4gICAgfVxuICB9KVxuXG4gIGxhc3RVcGxvYWRBc3NldFJlcXVlc3QgPSBEYXRlLm5vdygpXG5cbiAgcmV0dXJuIHtcbiAgICBpZDogYXNzZXRGaWxlSWQsXG4gICAgbmFtZTogZmlsZS5uYW1lLFxuICAgIHVybDogb3JpZ2luLFxuICAgIHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nLFxuICAgIGltYWdlczoge1xuICAgICAgcHJldmlldzogeyB1cmw6IGZp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
