import{aK as q,V as N,Q as F}from"./three.module.0404e109.js";import{T as S,a1 as x,a2 as L}from"./SystemUpdateType.4e88f289.js";import{G as W,h as D,L as _,a as A,b as j}from"./[projectId].d5e44847.js";import{d as P,g as a,E as p,a as R,r as f,h as G}from"./avatarFunctions.c7a0e273.js";import{A as b,a as y,b as O,c as w}from"./AutoPilotOverrideComponent.0b4b0ae9.js";import"./upload.38e3baaf.js";import"./vendor.c8b8cc93.js";import"./index.0040ebb6.js";import"./_app.009e96ac.js";import"./index.9af95596.js";import"./AuthService.6db25508.js";import"./AlertService.bfed2141.js";import"./feathers.081246a7.js";const Y=(h,n,l,m)=>{const d=new x(m.x,m.y,m.z),v=new x(n.x,n.y,n.z).sub(d),I=new x(l.x,l.y,l.z).sub(d),g=h.findPath(v,I),t=new L;for(const o of g){const i=o.clone().add(d);t.add(i)}return t},B=new F,J=new N(0,0,1);async function ct(h){const n=W.Left,l=new q,m=P([D]),d=P([b]),v=P([y]),I=P([_,O]);return()=>{for(const t of I.enter()){const{coords:o}=a(t,O),{overrideCoords:i,overridePosition:s}=a(t,w);l.setFromCamera(o,p.camera);const e=[],c=m().reduce((r,u)=>{const C=a(u,D).navTarget;return e.length=0,l.intersectObject(C,!0,e),e.length&&e[0].distance<r.distance?{distance:e[0].distance,point:e[0].point,entity:u}:r},{distance:1/0,point:null,entity:null});c.point&&(i&&(c.point=s),R(t,b,{point:c.point,navEntity:c.entity})),f(t,O),G(t,w)&&f(t,w)}for(const t of d.enter()){const o=a(t,b),i=a(o.navEntity,D);i||console.error("AutopilotSystem unable to process request - navigation entity does not have NavMeshComponent");const{position:s}=a(t,S),{position:e}=a(o.navEntity,S);R(t,y,{path:Y(i.yukaNavMesh,s,o.point,e),navEntity:o.navEntity}),f(t,b)}const g=v(h);if(g.length){const t=1,o=.1,i=.2;for(const s of g){const e=a(s,y);if(!e.path.current()){console.error("autopilot.path is invalid or empty"),f(s,y);continue}const{position:c}=a(s,S),r=new N(e.path.current().x,0,e.path.current().z),u=r.distanceTo(c.clone().setY(0));if(u<o){if(e.path.finished()){p.inputState.set(n,{type:A.TWODIM,value:[0,0,0],lifecycleState:j.Changed}),f(s,y);continue}e.path.advance();continue}const C=a(s,S),k=Math.min(1,Math.max(i,u<t?u/t:1)),T=r.clone().sub(c.clone().setY(0)).applyQuaternion(C.rotation).normalize(),z=Math.atan2(T.x,T.z),E=T.clone().multiplyScalar(k),M=[E.z,E.x,z];if(!p.inputState.has(n))p.inputState.set(n,{type:A.TWODIM,value:M,lifecycleState:j.Started});else{const V=p.inputState.get(n);JSON.stringify(V)!==JSON.stringify(M)&&p.inputState.set(n,{type:A.TWODIM,value:M,lifecycleState:j.Changed})}const Q=r.clone().sub(c).setY(0).normalize();C.rotation.copy(B.setFromUnitVectors(J,Q))}}v.exit(h).length&&p.inputState.set(n,{type:A.TWODIM,value:[0,0],lifecycleState:j.Changed})}}export{ct as default,Y as findPath};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0b3BpbG90U3lzdGVtLjFkM2I2N2UyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi9lbmdpbmUvc3JjL25hdmlnYXRpb24vc3lzdGVtcy9BdXRvcGlsb3RTeXN0ZW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW50ZXJzZWN0aW9uLCBRdWF0ZXJuaW9uLCBSYXljYXN0ZXIsIFZlY3RvcjMgfSBmcm9tICd0aHJlZSdcbmltcG9ydCB7IE5hdk1lc2gsIFBhdGgsIFZlY3RvcjMgYXMgWXVrYVZlY3RvcjMgfSBmcm9tICd5dWthJ1xuaW1wb3J0IHsgQXZhdGFyQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vYXZhdGFyL2NvbXBvbmVudHMvQXZhdGFyQ29tcG9uZW50J1xuaW1wb3J0IHsgTGlmZWN5Y2xlVmFsdWUgfSBmcm9tICcuLi8uLi9jb21tb24vZW51bXMvTGlmZWN5Y2xlVmFsdWUnXG5pbXBvcnQgeyBOdW1lcmljYWxUeXBlIH0gZnJvbSAnLi4vLi4vY29tbW9uL3R5cGVzL051bWVyaWNhbFR5cGVzJ1xuaW1wb3J0IHsgRW5naW5lIH0gZnJvbSAnLi4vLi4vZWNzL2NsYXNzZXMvRW5naW5lJ1xuaW1wb3J0IHtcbiAgYWRkQ29tcG9uZW50LFxuICBkZWZpbmVRdWVyeSxcbiAgZ2V0Q29tcG9uZW50LFxuICBoYXNDb21wb25lbnQsXG4gIHJlbW92ZUNvbXBvbmVudFxufSBmcm9tICcuLi8uLi9lY3MvZnVuY3Rpb25zL0NvbXBvbmVudEZ1bmN0aW9ucydcbmltcG9ydCB7IEdhbWVwYWRBeGlzIH0gZnJvbSAnLi4vLi4vaW5wdXQvZW51bXMvSW5wdXRFbnVtcydcbmltcG9ydCB7IElucHV0VHlwZSB9IGZyb20gJy4uLy4uL2lucHV0L2VudW1zL0lucHV0VHlwZSdcbmltcG9ydCB7IFRyYW5zZm9ybUNvbXBvbmVudCB9IGZyb20gJy4uLy4uL3RyYW5zZm9ybS9jb21wb25lbnRzL1RyYW5zZm9ybUNvbXBvbmVudCdcbmltcG9ydCB7IEF1dG9QaWxvdENsaWNrUmVxdWVzdENvbXBvbmVudCB9IGZyb20gJy4uL2NvbXBvbmVudC9BdXRvUGlsb3RDbGlja1JlcXVlc3RDb21wb25lbnQnXG5pbXBvcnQgeyBMb2NhbElucHV0VGFnQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vaW5wdXQvY29tcG9uZW50cy9Mb2NhbElucHV0VGFnQ29tcG9uZW50J1xuaW1wb3J0IHsgQXV0b1BpbG90Q29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50L0F1dG9QaWxvdENvbXBvbmVudCdcbmltcG9ydCB7IEF1dG9QaWxvdFJlcXVlc3RDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQvQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudCdcbmltcG9ydCB7IE5hdk1lc2hDb21wb25lbnQgfSBmcm9tICcuLi9jb21wb25lbnQvTmF2TWVzaENvbXBvbmVudCdcbmltcG9ydCB7IEF1dG9QaWxvdE92ZXJyaWRlQ29tcG9uZW50IH0gZnJvbSAnLi4vY29tcG9uZW50L0F1dG9QaWxvdE92ZXJyaWRlQ29tcG9uZW50J1xuaW1wb3J0IHsgU3lzdGVtIH0gZnJvbSAnLi4vLi4vZWNzL2NsYXNzZXMvU3lzdGVtJ1xuaW1wb3J0IHsgV29ybGQgfSBmcm9tICcuLi8uLi9lY3MvY2xhc3Nlcy9Xb3JsZCdcblxuZXhwb3J0IGNvbnN0IGZpbmRQYXRoID0gKG5hdk1lc2g6IE5hdk1lc2gsIGZyb206IFZlY3RvcjMsIHRvOiBWZWN0b3IzLCBiYXNlOiBWZWN0b3IzKTogUGF0aCA9PiB7XG4gIC8vIGdyYXBoIGlzIGluIGxvY2FsIGNvb3JkaW5hdGVzLCB3ZSBuZWVkIHRvIGNvbnZlcnQgXCJmcm9tXCIgYW5kIFwidG9cIiB0byBsb2NhbCB1c2luZyBcImJhc2VcIiBhbmQgY2VudGVyXG4gIC8vIFRPRE86IGhhbmRsZSBzY2FsZSBhbmQgcm90YXRpb24gb2YgZ3JhcGggb2JqZWN0LCBwYXNzIHdvcmxkIG1hdHJpeD9cbiAgY29uc3QgZ3JhcGhCYXNlQ29vcmRpbmF0ZSA9IG5ldyBZdWthVmVjdG9yMyhiYXNlLngsIGJhc2UueSwgYmFzZS56KVxuICBjb25zdCBsb2NhbEZyb20gPSBuZXcgWXVrYVZlY3RvcjMoZnJvbS54LCBmcm9tLnksIGZyb20ueikuc3ViKGdyYXBoQmFzZUNvb3JkaW5hdGUpXG4gIGNvbnN0IGxvY2FsVG8gPSBuZXcgWXVrYVZlY3RvcjModG8ueCwgdG8ueSwgdG8ueikuc3ViKGdyYXBoQmFzZUNvb3JkaW5hdGUpXG4gIGNvbnN0IHBvaW50cyA9IG5hdk1lc2guZmluZFBhdGgobG9jYWxGcm9tLCBsb2NhbFRvKVxuXG4gIGNvbnN0IHBhdGggPSBuZXcgUGF0aCgpXG4gIGZvciAoY29uc3QgcG9pbnQgb2YgcG9pbnRzKSB7XG4gICAgY29uc3Qgd29ybGRQb2ludCA9IHBvaW50LmNsb25lKCkuYWRkKGdyYXBoQmFzZUNvb3JkaW5hdGUpIC8vIGNvbnZlcnQgcG9pbnQgYmFjayB0byB3b3JsZCBjb29yZGluYXRlc1xuICAgIHBhdGguYWRkKHdvcmxkUG9pbnQpXG4gIH1cbiAgcmV0dXJuIHBhdGhcbn1cblxuY29uc3QgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKClcbmNvbnN0IGZvcndhcmQgPSBuZXcgVmVjdG9yMygwLCAwLCAxKVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBBdXRvcGlsb3RTeXN0ZW0od29ybGQ6IFdvcmxkKTogUHJvbWlzZTxTeXN0ZW0+IHtcbiAgY29uc3Qgc3RpY2sgPSBHYW1lcGFkQXhpcy5MZWZ0XG4gIGNvbnN0IHJheWNhc3RlciA9IG5ldyBSYXljYXN0ZXIoKVxuXG4gIGNvbnN0IG5hdm1lc2hlc1F1ZXJ5ID0gZGVmaW5lUXVlcnkoW05hdk1lc2hDb21wb25lbnRdKVxuICBjb25zdCByZXF1ZXN0c1F1ZXJ5ID0gZGVmaW5lUXVlcnkoW0F1dG9QaWxvdFJlcXVlc3RDb21wb25lbnRdKVxuICBjb25zdCBvbmdvaW5nUXVlcnkgPSBkZWZpbmVRdWVyeShbQXV0b1BpbG90Q29tcG9uZW50XSlcbiAgY29uc3QgbmF2Q2xpY2tRdWVyeSA9IGRlZmluZVF1ZXJ5KFtMb2NhbElucHV0VGFnQ29tcG9uZW50LCBBdXRvUGlsb3RDbGlja1JlcXVlc3RDb21wb25lbnRdKVxuXG4gIHJldHVybiAoKSA9PiB7XG4gICAgZm9yIChjb25zdCBlbnRpdHkgb2YgbmF2Q2xpY2tRdWVyeS5lbnRlcigpKSB7XG4gICAgICBjb25zdCB7IGNvb3JkcyB9ID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90Q2xpY2tSZXF1ZXN0Q29tcG9uZW50KVxuICAgICAgY29uc3QgeyBvdmVycmlkZUNvb3Jkcywgb3ZlcnJpZGVQb3NpdGlvbiB9ID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90T3ZlcnJpZGVDb21wb25lbnQpXG4gICAgICByYXljYXN0ZXIuc2V0RnJvbUNhbWVyYShjb29yZHMsIEVuZ2luZS5jYW1lcmEpXG5cbiAgICAgIGNvbnN0IHJheWNhc3RlclJlc3VsdHM6IEludGVyc2VjdGlvbltdID0gW11cblxuICAgICAgY29uc3QgY2xpY2tSZXN1bHQgPSBuYXZtZXNoZXNRdWVyeSgpLnJlZHVjZShcbiAgICAgICAgKHByZXZpb3VzRW50cnksIGN1cnJlbnRFbnRpdHkpID0+IHtcbiAgICAgICAgICBjb25zdCBtZXNoID0gZ2V0Q29tcG9uZW50KGN1cnJlbnRFbnRpdHksIE5hdk1lc2hDb21wb25lbnQpLm5hdlRhcmdldFxuICAgICAgICAgIHJheWNhc3RlclJlc3VsdHMubGVuZ3RoID0gMFxuICAgICAgICAgIHJheWNhc3Rlci5pbnRlcnNlY3RPYmplY3QobWVzaCwgdHJ1ZSwgcmF5Y2FzdGVyUmVzdWx0cylcbiAgICAgICAgICBpZiAoIXJheWNhc3RlclJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gcHJldmlvdXNFbnRyeVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChyYXljYXN0ZXJSZXN1bHRzWzBdLmRpc3RhbmNlIDwgcHJldmlvdXNFbnRyeS5kaXN0YW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgZGlzdGFuY2U6IHJheWNhc3RlclJlc3VsdHNbMF0uZGlzdGFuY2UsXG4gICAgICAgICAgICAgIHBvaW50OiByYXljYXN0ZXJSZXN1bHRzWzBdLnBvaW50LFxuICAgICAgICAgICAgICBlbnRpdHk6IGN1cnJlbnRFbnRpdHlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gcHJldmlvdXNFbnRyeVxuICAgICAgICB9LFxuICAgICAgICB7IGRpc3RhbmNlOiBJbmZpbml0eSwgcG9pbnQ6IG51bGwsIGVudGl0eTogbnVsbCB9XG4gICAgICApXG5cbiAgICAgIGlmIChjbGlja1Jlc3VsdC5wb2ludCkge1xuICAgICAgICBpZiAob3ZlcnJpZGVDb29yZHMpIGNsaWNrUmVzdWx0LnBvaW50ID0gb3ZlcnJpZGVQb3NpdGlvblxuICAgICAgICBjb25zdCBjID0gYWRkQ29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudCwge1xuICAgICAgICAgIHBvaW50OiBjbGlja1Jlc3VsdC5wb2ludCxcbiAgICAgICAgICBuYXZFbnRpdHk6IGNsaWNrUmVzdWx0LmVudGl0eVxuICAgICAgICB9KVxuICAgICAgICAvL2NvbnNvbGUubG9nKCdjbGlja1Jlc3VsdDogJyArIEpTT04uc3RyaW5naWZ5KGNsaWNrUmVzdWx0KSArICcgLSAnICsgSlNPTi5zdHJpbmdpZnkoYykpXG4gICAgICB9XG5cbiAgICAgIHJlbW92ZUNvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdENsaWNrUmVxdWVzdENvbXBvbmVudClcbiAgICAgIGlmIChoYXNDb21wb25lbnQoZW50aXR5LCBBdXRvUGlsb3RPdmVycmlkZUNvbXBvbmVudCkpIHJlbW92ZUNvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdE92ZXJyaWRlQ29tcG9uZW50KVxuICAgIH1cblxuICAgIC8vIHJlcXVlc3RzXG4gICAgLy8gZ2VuZXJhdGUgcGF0aCBmcm9tIHRhcmdldC5ncmFwaCBhbmQgY3JlYXRlIG5ldyBBdXRvUGlsb3RDb21wb25lbnQgKG9yIHJldXNlIGV4aXN0aW5nKVxuICAgIGZvciAoY29uc3QgZW50aXR5IG9mIHJlcXVlc3RzUXVlcnkuZW50ZXIoKSkge1xuICAgICAgY29uc3QgcmVxdWVzdCA9IGdldENvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdFJlcXVlc3RDb21wb25lbnQpXG4gICAgICBjb25zdCBuYXZNZXNoQ29tcG9uZW50ID0gZ2V0Q29tcG9uZW50KHJlcXVlc3QubmF2RW50aXR5LCBOYXZNZXNoQ29tcG9uZW50KVxuICAgICAgaWYgKCFuYXZNZXNoQ29tcG9uZW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0F1dG9waWxvdFN5c3RlbSB1bmFibGUgdG8gcHJvY2VzcyByZXF1ZXN0IC0gbmF2aWdhdGlvbiBlbnRpdHkgZG9lcyBub3QgaGF2ZSBOYXZNZXNoQ29tcG9uZW50JylcbiAgICAgIH1cbiAgICAgIGNvbnN0IHsgcG9zaXRpb24gfSA9IGdldENvbXBvbmVudChlbnRpdHksIFRyYW5zZm9ybUNvbXBvbmVudClcblxuICAgICAgbGV0IGF1dG9waWxvdENvbXBvbmVudFxuICAgICAgLy9pZiAoaGFzQ29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90Q29tcG9uZW50KSkge1xuICAgICAgLy8gcmV1c2UgY29tcG9uZW50XG4gICAgICAvLyAgIGF1dG9waWxvdENvbXBvbmVudCA9IGdldENvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdENvbXBvbmVudClcbiAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAvLyB9XG5cbiAgICAgIGNvbnN0IHsgcG9zaXRpb246IG5hdkJhc2VDb29yZGluYXRlIH0gPSBnZXRDb21wb25lbnQocmVxdWVzdC5uYXZFbnRpdHksIFRyYW5zZm9ybUNvbXBvbmVudClcblxuICAgICAgYXV0b3BpbG90Q29tcG9uZW50ID0gYWRkQ29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90Q29tcG9uZW50LCB7XG4gICAgICAgIHBhdGg6IGZpbmRQYXRoKG5hdk1lc2hDb21wb25lbnQueXVrYU5hdk1lc2gsIHBvc2l0aW9uLCByZXF1ZXN0LnBvaW50LCBuYXZCYXNlQ29vcmRpbmF0ZSksXG4gICAgICAgIG5hdkVudGl0eTogcmVxdWVzdC5uYXZFbnRpdHlcbiAgICAgIH0pXG5cbiAgICAgIC8vIFRPRE86IFwibW91bnRcIiBwbGF5ZXI/IGRpc2FibGUgbW92ZW1lbnQsIGV0Yy5cblxuICAgICAgcmVtb3ZlQ29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90UmVxdWVzdENvbXBvbmVudClcbiAgICB9XG5cbiAgICBjb25zdCBhbGxPbmdvaW5nID0gb25nb2luZ1F1ZXJ5KHdvcmxkKVxuXG4gICAgLy8gb25nb2luZ1xuICAgIGlmIChhbGxPbmdvaW5nLmxlbmd0aCkge1xuICAgICAgLy8gdXBkYXRlIG91ciBlbnRpdHkgdHJhbnNmb3JtIGZyb20gdmVoaWNsZVxuICAgICAgY29uc3QgUk9UQVRJT05fU1BFRUQgPSAwLjEgLy8gYW5nbGUgcGVyIHN0ZXAgaW4gcmFkaWFuc1xuICAgICAgY29uc3QgQVJSSVZJTkdfRElTVEFOQ0UgPSAxXG4gICAgICBjb25zdCBBUlJJVkVEX0RJU1RBTkNFID0gMC4xXG4gICAgICBjb25zdCBNSU5fU1BFRUQgPSAwLjJcbiAgICAgIGZvciAoY29uc3QgZW50aXR5IG9mIGFsbE9uZ29pbmcpIHtcbiAgICAgICAgY29uc3QgYXV0b3BpbG90ID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90Q29tcG9uZW50KVxuICAgICAgICBpZiAoIWF1dG9waWxvdC5wYXRoLmN1cnJlbnQoKSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ2F1dG9waWxvdC5wYXRoIGlzIGludmFsaWQgb3IgZW1wdHknKVxuICAgICAgICAgIHJlbW92ZUNvbXBvbmVudChlbnRpdHksIEF1dG9QaWxvdENvbXBvbmVudClcbiAgICAgICAgICBjb250aW51ZVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBwb3NpdGlvbjogYWN0b3JQb3NpdGlvbiB9ID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICAgICAgICBjb25zdCB0YXJnZXRGbGF0UG9zaXRpb24gPSBuZXcgVmVjdG9yMyhhdXRvcGlsb3QucGF0aC5jdXJyZW50KCkueCwgMCwgYXV0b3BpbG90LnBhdGguY3VycmVudCgpLnopXG4gICAgICAgIGNvbnN0IHRhcmdldEZsYXREaXN0YW5jZSA9IHRhcmdldEZsYXRQb3NpdGlvbi5kaXN0YW5jZVRvKGFjdG9yUG9zaXRpb24uY2xvbmUoKS5zZXRZKDApKVxuICAgICAgICBpZiAodGFyZ2V0RmxhdERpc3RhbmNlIDwgQVJSSVZFRF9ESVNUQU5DRSkge1xuICAgICAgICAgIGlmIChhdXRvcGlsb3QucGF0aC5maW5pc2hlZCgpKSB7XG4gICAgICAgICAgICAvLyBQYXRoIGlzIGZpbmlzaGVkIVxuICAgICAgICAgICAgRW5naW5lLmlucHV0U3RhdGUuc2V0KHN0aWNrLCB7XG4gICAgICAgICAgICAgIHR5cGU6IElucHV0VHlwZS5UV09ESU0sXG4gICAgICAgICAgICAgIHZhbHVlOiBbMCwgMCwgMF0sXG4gICAgICAgICAgICAgIGxpZmVjeWNsZVN0YXRlOiBMaWZlY3ljbGVWYWx1ZS5DaGFuZ2VkXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICAvLyBQYXRoIGlzIGZpbmlzaGVkIC0gcmVtb3ZlIGNvbXBvbmVudFxuICAgICAgICAgICAgcmVtb3ZlQ29tcG9uZW50KGVudGl0eSwgQXV0b1BpbG90Q29tcG9uZW50KVxuICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBhdXRvcGlsb3QucGF0aC5hZHZhbmNlKClcbiAgICAgICAgICBjb250aW51ZVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgdHJhbnNmb3JtID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICAgICAgICBjb25zdCBzcGVlZE1vZGlmaWVyID0gTWF0aC5taW4oXG4gICAgICAgICAgMSxcbiAgICAgICAgICBNYXRoLm1heChNSU5fU1BFRUQsIHRhcmdldEZsYXREaXN0YW5jZSA8IEFSUklWSU5HX0RJU1RBTkNFID8gdGFyZ2V0RmxhdERpc3RhbmNlIC8gQVJSSVZJTkdfRElTVEFOQ0UgOiAxKVxuICAgICAgICApXG4gICAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRhcmdldEZsYXRQb3NpdGlvblxuICAgICAgICAgIC5jbG9uZSgpXG4gICAgICAgICAgLnN1YihhY3RvclBvc2l0aW9uLmNsb25lKCkuc2V0WSgwKSlcbiAgICAgICAgICAuYXBwbHlRdWF0ZXJuaW9uKHRyYW5zZm9ybS5yb3RhdGlvbilcbiAgICAgICAgICAubm9ybWFsaXplKClcbiAgICAgICAgY29uc3QgdGFyZ2V0QW5nbGUgPSBNYXRoLmF0YW4yKGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueilcbiAgICAgICAgY29uc3Qgc3RpY2tWYWx1ZSA9IGRpcmVjdGlvbi5jbG9uZSgpLm11bHRpcGx5U2NhbGFyKHNwZWVkTW9kaWZpZXIpIC8vIHNwZWVkXG5cbiAgICAgICAgY29uc3Qgc3RpY2tQb3NpdGlvbjogTnVtZXJpY2FsVHlwZSA9IFtzdGlja1ZhbHVlLnosIHN0aWNrVmFsdWUueCwgdGFyZ2V0QW5nbGVdXG4gICAgICAgIC8vIElmIHBvc2l0aW9uIG5vdCBzZXQsIHNldCBpdCB3aXRoIGxpZmVjeWNsZSBzdGFydGVkXG4gICAgICAgIGlmICghRW5naW5lLmlucHV0U3RhdGUuaGFzKHN0aWNrKSkge1xuICAgICAgICAgIEVuZ2luZS5pbnB1dFN0YXRlLnNldChzdGljaywge1xuICAgICAgICAgICAgdHlwZTogSW5wdXRUeXBlLlRXT0RJTSxcbiAgICAgICAgICAgIHZhbHVlOiBzdGlja1Bvc2l0aW9uLFxuICAgICAgICAgICAgbGlmZWN5Y2xlU3RhdGU6IExpZmVjeWNsZVZhbHVlLlN0YXJ0ZWRcbiAgICAgICAgICB9KVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIHBvc2l0aW9uIHNldCwgY2hlY2sgaXQncyB2YWx1ZVxuICAgICAgICAgIGNvbnN0IG9sZFN0aWNrUG9zaXRpb24gPSBFbmdpbmUuaW5wdXRTdGF0ZS5nZXQoc3RpY2spXG4gICAgICAgICAgLy8gSWYgaXQncyBub3QgdGhlIHNhbWUsIHNldCBpdCBhbmQgdXBkYXRlIHRoZSBsaWZlY3ljbGUgdmFsdWUgdG8gY2hhbmdlZFxuICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShvbGRTdGlja1Bvc2l0aW9uKSAhPT0gSlNPTi5zdHJpbmdpZnkoc3RpY2tQb3NpdGlvbikpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCctLS1jaGFuZ2VkJyk7XG4gICAgICAgICAgICAvLyBTZXQgdHlwZSB0byBUV09ESU0gKHR3by1kaW1lbnNpb25hbCBheGlzKSBhbmQgdmFsdWUgdG8gYSBub3JtYWxpemVkIC0xLCAxIG9uIFggYW5kIFlcbiAgICAgICAgICAgIEVuZ2luZS5pbnB1dFN0YXRlLnNldChzdGljaywge1xuICAgICAgICAgICAgICB0eXBlOiBJbnB1dFR5cGUuVFdPRElNLFxuICAgICAgICAgICAgICB2YWx1ZTogc3RpY2tQb3NpdGlvbixcbiAgICAgICAgICAgICAgbGlmZWN5Y2xlU3RhdGU6IExpZmVjeWNsZVZhbHVlLkNoYW5nZWRcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gcm90YXRpb25cbiAgICAgICAgY29uc3QgdGFyZ2V0RGlyZWN0aW9uID0gdGFyZ2V0RmxhdFBvc2l0aW9uLmNsb25lKCkuc3ViKGFjdG9yUG9zaXRpb24pLnNldFkoMCkubm9ybWFsaXplKClcbiAgICAgICAgLy8ge1xuICAgICAgICAvLyAgIC8vIHdheSAxXG4gICAgICAgIC8vICAgY29uc3QgdHJhbnNmb3JtID0gZ2V0Q29tcG9uZW50KGVudGl0eSwgVHJhbnNmb3JtQ29tcG9uZW50KVxuICAgICAgICAvLyAgIGNvbnN0IGZvcndhcmRWZWN0b3IgPSBuZXcgVmVjdG9yMygwLCAwLCAxKVxuICAgICAgICAvLyAgIGFwcGx5VmVjdG9yTWF0cml4WFoodGFyZ2V0RGlyZWN0aW9uLCBmb3J3YXJkVmVjdG9yKVxuICAgICAgICAvLyAgIGNvbnN0IHRhcmdldFF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpLnNldEZyb21Vbml0VmVjdG9ycyhmb3J3YXJkVmVjdG9yLCB0YXJnZXREaXJlY3Rpb24pXG4gICAgICAgIC8vICAgdHJhbnNmb3JtLnJvdGF0aW9uLnJvdGF0ZVRvd2FyZHModGFyZ2V0UXVhdGVybmlvbiwgUk9UQVRJT05fU1BFRUQpXG4gICAgICAgIC8vICAgLy8gYWN0b3Iudmlld1ZlY3Rvci5jb3B5KHRhcmdldERpcmVjdGlvbilcbiAgICAgICAgLy8gICBhY3Rvci52aWV3VmVjdG9yLmNvcHkoZm9yd2FyZFZlY3RvcikuYXBwbHlRdWF0ZXJuaW9uKHRyYW5zZm9ybS5yb3RhdGlvbilcbiAgICAgICAgLy8gfVxuICAgICAgICB7XG4gICAgICAgICAgLy8gd2F5IDJcbiAgICAgICAgICB0cmFuc2Zvcm0ucm90YXRpb24uY29weShxdWF0LnNldEZyb21Vbml0VmVjdG9ycyhmb3J3YXJkLCB0YXJnZXREaXJlY3Rpb24pKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9uZ29pbmdRdWVyeS5leGl0KHdvcmxkKS5sZW5ndGgpIHtcbiAgICAgIC8vIHNlbmQgb25lIHJlbGF4ZWQgZ2FtZXBhZCBzdGF0ZSB0byBzdG9wIG1vdmVtZW50XG4gICAgICBFbmdpbmUuaW5wdXRTdGF0ZS5zZXQoc3RpY2ssIHtcbiAgICAgICAgdHlwZTogSW5wdXRUeXBlLlRXT0RJTSxcbiAgICAgICAgdmFsdWU6IFswLCAwXSxcbiAgICAgICAgbGlmZWN5Y2xlU3RhdGU6IExpZmVjeWNsZVZhbHVlLkNoYW5nZWRcbiAgICAgIH0pXG4gICAgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiWXVrYVZlY3RvcjMiXSwibWFwcGluZ3MiOiJ3bUJBeUJhLEdBQVcsQ0FBQyxFQUFrQixFQUFlLEVBQWEsSUFBd0IsTUFHdkYs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
