import{S as v,P as b,aA as R,W as E,aq as g,a3 as S,aB as A,aC as P,M as T}from"./three.module.0404e109.js";import{r as M,R as C}from"./vendor.c8b8cc93.js";import L from"./Player.78b7e742.js";import W from"./workerFunction.efd6a346.js";class F{static createButton(r,n={}){const e=document.createElement("button");function m(){if(n.domOverlay===void 0){var t=document.createElement("div");t.style.display="none",document.body.appendChild(t);var i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("width","38"),i.setAttribute("height","38"),i.style.position="absolute",i.style.right="20px",i.style.top="20px",i.addEventListener("click",()=>{s.end()}),t.appendChild(i);var u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),u.setAttribute("stroke","#fff"),u.setAttribute("strokeWidth","2"),i.appendChild(u),n.optionalFeatures===void 0&&(n.optionalFeatures=[]),n.optionalFeatures.push("dom-overlay"),n.domOverlay={root:t}}let s=null;async function y(l){l.addEventListener("end",a),r.xr.setReferenceSpaceType("local"),await r.xr.setSession(l),e.textContent="STOP AR",n.domOverlay.root.style.display="",s=l}function a(){s.removeEventListener("end",a),e.textContent="START AR",n.domOverlay.root.style.display="none",s=null}e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",e.textContent="START AR",e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){s===null?navigator.xr.requestSession("immersive-ar",n).then(y):s.end()}}function o(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}function d(){o(),e.textContent="AR NOT SUPPORTED"}function c(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return e.id="ARButton",e.style.display="none",c(e),navigator.xr.isSessionSupported("immersive-ar").then(t=>{t?m():d()}).catch(d),e;{const t=document.createElement("a");return window.isSecureContext===!1?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",c(t),t}}}const O=()=>{let f,r,n,e,m,o,d=null,c=!1;return M.exports.useEffect(()=>{i(),s();const t=new L({scene:n,renderer:e,worker:new W,meshFilePath:"/test.uvol",videoFilePath:"/test.mp4",manifestFilePath:"/test.manifest",scale:1,onMeshBuffering:a=>{console.warn("BUFFERING!!",a)},onFrameShow:()=>{console.warn("SHOWING!!")}});t.mesh.position.set(0,0,0),t.mesh.matrixAutoUpdate=!0,t.mesh.matrixWorldNeedsUpdate=!0,t.mesh.visible=!0;function i(){f=document.createElement("div"),document.body.appendChild(f),n=new v,r=new b(70,window.innerWidth/window.innerHeight,.01,100),r.position.set(0,1,5),n.add(r);const a=new R(16777215,12303359,1);a.position.set(.5,1,.25),n.add(a),e=new E({antialias:!0,alpha:!0}),e.setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.xr.enabled=!0,f.appendChild(e.domElement);const l=new g({color:16777215*Math.random()}),h=new S(new A(.1,.1,.1),l);h.scale.y=Math.random()*2+.1,n.add(h),document.body.appendChild(F.createButton(e,{requiredFeatures:["hit-test"]}));function p(){o.visible&&(t.play(),t.mesh.position.setFromMatrixPosition(o.matrix),h.position.setFromMatrixPosition(o.matrix))}m=e.xr.getController(0),m.addEventListener("select",p),n.add(m),o=new S(new P(.15,.2,32).rotateX(-Math.PI/2),new T),o.matrixAutoUpdate=!1,o.visible=!1,n.add(o),window.addEventListener("click",p),window.addEventListener("resize",u)}function u(){r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)}function s(){e.setAnimationLoop(y)}function y(a,l){if(l&&e.xr){const h=e.xr.getReferenceSpace(),p=e.xr.getSession();if(c===!1&&(p.requestReferenceSpace("viewer").then(w=>{p.requestHitTestSource({space:w}).then(x=>{d=x})}),p.addEventListener("end",()=>{c=!1,d=null}),c=!0),d){const w=l.getHitTestResults(d);if(w.length){const x=w[0];o.visible=!0,o.matrix.fromArray(x.getPose(h).transform.matrix)}else o.visible=!1}}t&&t.handleRender(()=>{e.render(n,r)})}},[]),C.createElement("button",{type:"button",onClick:()=>{}},"Hi")};export{F as ARButton,O as VideoRecording,O as default};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2VieHIuM2IxZGU1NzkuanMiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wYWdlcy93ZWJ4ci50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR0xURkxvYWRlciB9IGZyb20gJ0B4cmVuZ2luZS9lbmdpbmUvc3JjL2Fzc2V0cy9sb2FkZXJzL2dsdGYvR0xURkxvYWRlcidcbmltcG9ydCB7XG4gIFJpbmdHZW9tZXRyeSxcbiAgSGVtaXNwaGVyZUxpZ2h0LFxuICBDeWxpbmRlckdlb21ldHJ5LFxuICBNZXNoUGhvbmdNYXRlcmlhbCxcbiAgV2ViR0xSZW5kZXJlcixcbiAgUGVyc3BlY3RpdmVDYW1lcmEsXG4gIFBDRlNvZnRTaGFkb3dNYXAsXG4gIE1lc2hCYXNpY01hdGVyaWFsLFxuICBCb3hCdWZmZXJHZW9tZXRyeSxcbiAgT2JqZWN0M0QsXG4gIFNjZW5lLFxuICBBbWJpZW50TGlnaHQsXG4gIE1lc2gsXG4gIERpcmVjdGlvbmFsTGlnaHQsXG4gIFBsYW5lR2VvbWV0cnksXG4gIFNoYWRvd01hdGVyaWFsXG59IGZyb20gJ3RocmVlJ1xuaW1wb3J0IFJlYWN0LCB7IHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0J1xuaW1wb3J0IFBsYXllciBmcm9tICd2b2x1bWV0cmljL3dlYi9kZWNvZGVyL1BsYXllcidcbi8vIEB0cy1pZ25vcmVcbmltcG9ydCBQbGF5ZXJXb3JrZXIgZnJvbSAndm9sdW1ldHJpYy93ZWIvZGVjb2Rlci93b3JrZXJGdW5jdGlvbi50cz93b3JrZXInXG5cbmNsYXNzIEFSQnV0dG9uIHtcbiAgc3RhdGljIGNyZWF0ZUJ1dHRvbihyZW5kZXJlciwgc2Vzc2lvbkluaXQ6IGFueSA9IHt9KSB7XG4gICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcblxuICAgIGZ1bmN0aW9uIHNob3dTdGFydEFSKC8qZGV2aWNlKi8pIHtcbiAgICAgIGlmIChzZXNzaW9uSW5pdC5kb21PdmVybGF5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFyIG92ZXJsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgICAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChvdmVybGF5KVxuXG4gICAgICAgIHZhciBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3N2ZycpXG4gICAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoJ3dpZHRoJywgJzM4JylcbiAgICAgICAgc3ZnLnNldEF0dHJpYnV0ZSgnaGVpZ2h0JywgJzM4JylcbiAgICAgICAgc3ZnLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJ1xuICAgICAgICBzdmcuc3R5bGUucmlnaHQgPSAnMjBweCdcbiAgICAgICAgc3ZnLnN0eWxlLnRvcCA9ICcyMHB4J1xuICAgICAgICBzdmcuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgY3VycmVudFNlc3Npb24uZW5kKClcbiAgICAgICAgfSlcbiAgICAgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChzdmcpXG5cbiAgICAgICAgdmFyIHBhdGggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BhdGgnKVxuICAgICAgICBwYXRoLnNldEF0dHJpYnV0ZSgnZCcsICdNIDEyLDEyIEwgMjgsMjggTSAyOCwxMiAxMiwyOCcpXG4gICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnI2ZmZicpXG4gICAgICAgIHBhdGguc2V0QXR0cmlidXRlKCdzdHJva2VXaWR0aCcsICcyJylcbiAgICAgICAgc3ZnLmFwcGVuZENoaWxkKHBhdGgpXG5cbiAgICAgICAgaWYgKHNlc3Npb25Jbml0Lm9wdGlvbmFsRmVhdHVyZXMgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHNlc3Npb25Jbml0Lm9wdGlvbmFsRmVhdHVyZXMgPSBbXVxuICAgICAgICB9XG5cbiAgICAgICAgc2Vzc2lvbkluaXQub3B0aW9uYWxGZWF0dXJlcy5wdXNoKCdkb20tb3ZlcmxheScpXG4gICAgICAgIHNlc3Npb25Jbml0LmRvbU92ZXJsYXkgPSB7IHJvb3Q6IG92ZXJsYXkgfVxuICAgICAgfVxuXG4gICAgICAvL1xuXG4gICAgICBsZXQgY3VycmVudFNlc3Npb24gPSBudWxsXG5cbiAgICAgIGFzeW5jIGZ1bmN0aW9uIG9uU2Vzc2lvblN0YXJ0ZWQoc2Vzc2lvbikge1xuICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZCcsIG9uU2Vzc2lvbkVuZGVkKVxuXG4gICAgICAgIHJlbmRlcmVyLnhyLnNldFJlZmVyZW5jZVNwYWNlVHlwZSgnbG9jYWwnKVxuXG4gICAgICAgIGF3YWl0IHJlbmRlcmVyLnhyLnNldFNlc3Npb24oc2Vzc2lvbilcblxuICAgICAgICBidXR0b24udGV4dENvbnRlbnQgPSAnU1RPUCBBUidcbiAgICAgICAgc2Vzc2lvbkluaXQuZG9tT3ZlcmxheS5yb290LnN0eWxlLmRpc3BsYXkgPSAnJ1xuXG4gICAgICAgIGN1cnJlbnRTZXNzaW9uID0gc2Vzc2lvblxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBvblNlc3Npb25FbmRlZCgvKmV2ZW50Ki8pIHtcbiAgICAgICAgY3VycmVudFNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lcignZW5kJywgb25TZXNzaW9uRW5kZWQpXG5cbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1NUQVJUIEFSJ1xuICAgICAgICBzZXNzaW9uSW5pdC5kb21PdmVybGF5LnJvb3Quc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuXG4gICAgICAgIGN1cnJlbnRTZXNzaW9uID0gbnVsbFxuICAgICAgfVxuXG4gICAgICAvL1xuXG4gICAgICBidXR0b24uc3R5bGUuZGlzcGxheSA9ICcnXG5cbiAgICAgIGJ1dHRvbi5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcidcbiAgICAgIGJ1dHRvbi5zdHlsZS5sZWZ0ID0gJ2NhbGMoNTAlIC0gNTBweCknXG4gICAgICBidXR0b24uc3R5bGUud2lkdGggPSAnMTAwcHgnXG5cbiAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdTVEFSVCBBUidcblxuICAgICAgYnV0dG9uLm9ubW91c2VlbnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgYnV0dG9uLnN0eWxlLm9wYWNpdHkgPSAnMS4wJ1xuICAgICAgfVxuXG4gICAgICBidXR0b24ub25tb3VzZWxlYXZlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBidXR0b24uc3R5bGUub3BhY2l0eSA9ICcwLjUnXG4gICAgICB9XG5cbiAgICAgIGJ1dHRvbi5vbmNsaWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY3VycmVudFNlc3Npb24gPT09IG51bGwpIHtcbiAgICAgICAgICA7KG5hdmlnYXRvciBhcyBhbnkpLnhyLnJlcXVlc3RTZXNzaW9uKCdpbW1lcnNpdmUtYXInLCBzZXNzaW9uSW5pdCkudGhlbihvblNlc3Npb25TdGFydGVkKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJlbnRTZXNzaW9uLmVuZCgpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNhYmxlQnV0dG9uKCkge1xuICAgICAgYnV0dG9uLnN0eWxlLmRpc3BsYXkgPSAnJ1xuXG4gICAgICBidXR0b24uc3R5bGUuY3Vyc29yID0gJ2F1dG8nXG4gICAgICBidXR0b24uc3R5bGUubGVmdCA9ICdjYWxjKDUwJSAtIDc1cHgpJ1xuICAgICAgYnV0dG9uLnN0eWxlLndpZHRoID0gJzE1MHB4J1xuXG4gICAgICBidXR0b24ub25tb3VzZWVudGVyID0gbnVsbFxuICAgICAgYnV0dG9uLm9ubW91c2VsZWF2ZSA9IG51bGxcblxuICAgICAgYnV0dG9uLm9uY2xpY2sgPSBudWxsXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0FSTm90U3VwcG9ydGVkKCkge1xuICAgICAgZGlzYWJsZUJ1dHRvbigpXG5cbiAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9ICdBUiBOT1QgU1VQUE9SVEVEJ1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0eWxpemVFbGVtZW50KGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnXG4gICAgICBlbGVtZW50LnN0eWxlLmJvdHRvbSA9ICcyMHB4J1xuICAgICAgZWxlbWVudC5zdHlsZS5wYWRkaW5nID0gJzEycHggNnB4J1xuICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXIgPSAnMXB4IHNvbGlkICNmZmYnXG4gICAgICBlbGVtZW50LnN0eWxlLmJvcmRlclJhZGl1cyA9ICc0cHgnXG4gICAgICBlbGVtZW50LnN0eWxlLmJhY2tncm91bmQgPSAncmdiYSgwLDAsMCwwLjEpJ1xuICAgICAgZWxlbWVudC5zdHlsZS5jb2xvciA9ICcjZmZmJ1xuICAgICAgZWxlbWVudC5zdHlsZS5mb250ID0gJ25vcm1hbCAxM3B4IHNhbnMtc2VyaWYnXG4gICAgICBlbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInXG4gICAgICBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSAnMC41J1xuICAgICAgZWxlbWVudC5zdHlsZS5vdXRsaW5lID0gJ25vbmUnXG4gICAgICBlbGVtZW50LnN0eWxlLnpJbmRleCA9ICc5OTknXG4gICAgfVxuXG4gICAgaWYgKCd4cicgaW4gbmF2aWdhdG9yKSB7XG4gICAgICBidXR0b24uaWQgPSAnQVJCdXR0b24nXG4gICAgICBidXR0b24uc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuXG4gICAgICBzdHlsaXplRWxlbWVudChidXR0b24pXG4gICAgICA7KG5hdmlnYXRvciBhcyBhbnkpLnhyXG4gICAgICAgIC5pc1Nlc3Npb25TdXBwb3J0ZWQoJ2ltbWVyc2l2ZS1hcicpXG4gICAgICAgIC50aGVuKChzdXBwb3J0ZWQpID0+IHtcbiAgICAgICAgICBzdXBwb3J0ZWQgPyBzaG93U3RhcnRBUigpIDogc2hvd0FSTm90U3VwcG9ydGVkKClcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKHNob3dBUk5vdFN1cHBvcnRlZClcblxuICAgICAgcmV0dXJuIGJ1dHRvblxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpXG5cbiAgICAgIGlmICh3aW5kb3cuaXNTZWN1cmVDb250ZXh0ID09PSBmYWxzZSkge1xuICAgICAgICBtZXNzYWdlLmhyZWYgPSBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLnJlcGxhY2UoL15odHRwOi8sICdodHRwczonKVxuICAgICAgICBtZXNzYWdlLmlubmVySFRNTCA9ICdXRUJYUiBORUVEUyBIVFRQUycgLy8gVE9ETyBJbXByb3ZlIG1lc3NhZ2VcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1lc3NhZ2UuaHJlZiA9ICdodHRwczovL2ltbWVyc2l2ZXdlYi5kZXYvJ1xuICAgICAgICBtZXNzYWdlLmlubmVySFRNTCA9ICdXRUJYUiBOT1QgQVZBSUxBQkxFJ1xuICAgICAgfVxuXG4gICAgICBtZXNzYWdlLnN0eWxlLmxlZnQgPSAnY2FsYyg1MCUgLSA5MHB4KSdcbiAgICAgIG1lc3NhZ2Uuc3R5bGUud2lkdGggPSAnMTgwcHgnXG4gICAgICBtZXNzYWdlLnN0eWxlLnRleHREZWNvcmF0aW9uID0gJ25vbmUnXG5cbiAgICAgIHN0eWxpemVFbGVtZW50KG1lc3NhZ2UpXG5cbiAgICAgIHJldHVybiBtZXNzYWdlXG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IEFSQnV0dG9uIH1cblxuZXhwb3J0IGNvbnN0IFZpZGVvUmVjb3JkaW5nID0gKCkgPT4ge1xuICAvKlxuICAgKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICAgKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgJ0xpY2Vuc2UnKTtcbiAgICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICAgKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAgICpcbiAgICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICAgKlxuICAgKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gICAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsXG4gICAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICAgKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gICAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICAgKi9cblxuICBsZXQgY29udGFpbmVyXG4gIGxldCBjYW1lcmEsIHNjZW5lLCByZW5kZXJlclxuICBsZXQgY29udHJvbGxlclxuXG4gIGxldCByZXRpY2xlXG5cbiAgbGV0IGhpdFRlc3RTb3VyY2UgPSBudWxsXG4gIGxldCBoaXRUZXN0U291cmNlUmVxdWVzdGVkID0gZmFsc2VcblxuICB2YXIgaXNSZWNvcmRpbmcgPSBmYWxzZVxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaW5pdCgpXG4gICAgYW5pbWF0ZSgpXG5cbiAgICBjb25zdCBwbGF5ZXIgPSBuZXcgUGxheWVyKHtcbiAgICAgIHNjZW5lLFxuICAgICAgcmVuZGVyZXIsXG4gICAgICB3b3JrZXI6IG5ldyBQbGF5ZXJXb3JrZXIoKSxcbiAgICAgIG1lc2hGaWxlUGF0aDogJy90ZXN0LnV2b2wnLFxuICAgICAgdmlkZW9GaWxlUGF0aDogJy90ZXN0Lm1wNCcsXG4gICAgICBtYW5pZmVzdEZpbGVQYXRoOiAnL3Rlc3QubWFuaWZlc3QnLFxuICAgICAgc2NhbGU6IDEsXG4gICAgICBvbk1lc2hCdWZmZXJpbmc6IChwcm9ncmVzcykgPT4ge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0JVRkZFUklORyEhJywgcHJvZ3Jlc3MpXG4gICAgICAgIC8vIHNldEJ1ZmZlcmluZ1Byb2dyZXNzKE1hdGgucm91bmQocHJvZ3Jlc3MgKiAxMDApKTtcbiAgICAgICAgLy8gc2V0SXNCdWZmZXJpbmcodHJ1ZSk7XG4gICAgICB9LFxuICAgICAgb25GcmFtZVNob3c6ICgpID0+IHtcbiAgICAgICAgY29uc29sZS53YXJuKCdTSE9XSU5HISEnKVxuICAgICAgfVxuICAgIH0pXG4gICAgcGxheWVyLm1lc2gucG9zaXRpb24uc2V0KDAsIDAsIDApXG4gICAgcGxheWVyLm1lc2gubWF0cml4QXV0b1VwZGF0ZSA9IHRydWVcbiAgICBwbGF5ZXIubWVzaC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZVxuICAgIHBsYXllci5tZXNoLnZpc2libGUgPSB0cnVlXG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoY29udGFpbmVyKVxuXG4gICAgICBzY2VuZSA9IG5ldyBTY2VuZSgpXG5cbiAgICAgIGNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSg3MCwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDAuMDEsIDEwMClcbiAgICAgIGNhbWVyYS5wb3NpdGlvbi5zZXQoMCwgMSwgNSlcbiAgICAgIHNjZW5lLmFkZChjYW1lcmEpXG4gICAgICBjb25zdCBsaWdodCA9IG5ldyBIZW1pc3BoZXJlTGlnaHQoMHhmZmZmZmYsIDB4YmJiYmZmLCAxKVxuICAgICAgbGlnaHQucG9zaXRpb24uc2V0KDAuNSwgMSwgMC4yNSlcbiAgICAgIHNjZW5lLmFkZChsaWdodClcblxuICAgICAgLy9cblxuICAgICAgcmVuZGVyZXIgPSBuZXcgV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogdHJ1ZSwgYWxwaGE6IHRydWUgfSlcbiAgICAgIHJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pXG4gICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpXG4gICAgICByZW5kZXJlci54ci5lbmFibGVkID0gdHJ1ZVxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHJlbmRlcmVyLmRvbUVsZW1lbnQpXG5cbiAgICAgIC8vIHZpZGVvOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInZpZGVvXCIpXG5cbiAgICAgIGNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hQaG9uZ01hdGVyaWFsKHsgY29sb3I6IDB4ZmZmZmZmICogTWF0aC5yYW5kb20oKSB9KVxuICAgICAgY29uc3QgbWVzaCA9IG5ldyBNZXNoKG5ldyBDeWxpbmRlckdlb21ldHJ5KDAuMSwgMC4xLCAwLjEpLCBtYXRlcmlhbClcbiAgICAgIG1lc2guc2NhbGUueSA9IE1hdGgucmFuZG9tKCkgKiAyICsgMC4xXG4gICAgICBzY2VuZS5hZGQobWVzaClcblxuICAgICAgLy9cblxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChBUkJ1dHRvbi5jcmVhdGVCdXR0b24ocmVuZGVyZXIsIHsgcmVxdWlyZWRGZWF0dXJlczogWydoaXQtdGVzdCddIH0pKVxuXG4gICAgICBmdW5jdGlvbiBvblNlbGVjdCgpIHtcbiAgICAgICAgaWYgKHJldGljbGUudmlzaWJsZSkge1xuICAgICAgICAgIC8vIHJlY29yZCgpO1xuICAgICAgICAgIHBsYXllci5wbGF5KClcblxuICAgICAgICAgIHBsYXllci5tZXNoLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihyZXRpY2xlLm1hdHJpeClcbiAgICAgICAgICBtZXNoLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbihyZXRpY2xlLm1hdHJpeClcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb250cm9sbGVyID0gcmVuZGVyZXIueHIuZ2V0Q29udHJvbGxlcigwKVxuXG4gICAgICBjb250cm9sbGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3NlbGVjdCcsIG9uU2VsZWN0KVxuICAgICAgc2NlbmUuYWRkKGNvbnRyb2xsZXIpXG5cbiAgICAgIHJldGljbGUgPSBuZXcgTWVzaChuZXcgUmluZ0dlb21ldHJ5KDAuMTUsIDAuMiwgMzIpLnJvdGF0ZVgoLU1hdGguUEkgLyAyKSwgbmV3IE1lc2hCYXNpY01hdGVyaWFsKCkpXG4gICAgICByZXRpY2xlLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZVxuICAgICAgcmV0aWNsZS52aXNpYmxlID0gZmFsc2VcbiAgICAgIHNjZW5lLmFkZChyZXRpY2xlKVxuXG4gICAgICAvL1xuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25TZWxlY3QpXG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBvbldpbmRvd1Jlc2l6ZSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbldpbmRvd1Jlc2l6ZSgpIHtcbiAgICAgIGNhbWVyYS5hc3BlY3QgPSB3aW5kb3cuaW5uZXJXaWR0aCAvIHdpbmRvdy5pbm5lckhlaWdodFxuICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKVxuXG4gICAgICByZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpXG4gICAgfVxuXG4gICAgLy9cblxuICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7XG4gICAgICByZW5kZXJlci5zZXRBbmltYXRpb25Mb29wKHJlbmRlcilcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW5kZXIodGltZXN0YW1wLCBmcmFtZSkge1xuICAgICAgaWYgKGZyYW1lICYmIHJlbmRlcmVyLnhyKSB7XG4gICAgICAgIGNvbnN0IHJlZmVyZW5jZVNwYWNlID0gcmVuZGVyZXIueHIuZ2V0UmVmZXJlbmNlU3BhY2UoKVxuICAgICAgICBjb25zdCBzZXNzaW9uID0gcmVuZGVyZXIueHIuZ2V0U2Vzc2lvbigpXG5cbiAgICAgICAgaWYgKGhpdFRlc3RTb3VyY2VSZXF1ZXN0ZWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoJ3ZpZXdlcicpLnRoZW4oKHJlZmVyZW5jZVNwYWNlKSA9PiB7XG4gICAgICAgICAgICBzZXNzaW9uLnJlcXVlc3RIaXRUZXN0U291cmNlKHsgc3BhY2U6IHJlZmVyZW5jZVNwYWNlIH0pLnRoZW4oKHNvdXJjZSkgPT4ge1xuICAgICAgICAgICAgICBoaXRUZXN0U291cmNlID0gc291cmNlXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgICBzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZCcsICgpID0+IHtcbiAgICAgICAgICAgIGhpdFRlc3RTb3VyY2VSZXF1ZXN0ZWQgPSBmYWxzZVxuICAgICAgICAgICAgaGl0VGVzdFNvdXJjZSA9IG51bGxcbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgaGl0VGVzdFNvdXJjZVJlcXVlc3RlZCA9IHRydWVcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoaXRUZXN0U291cmNlKSB7XG4gICAgICAgICAgY29uc3QgaGl0VGVzdFJlc3VsdHMgPSBmcmFtZS5nZXRIaXRUZXN0UmVzdWx0cyhoaXRUZXN0U291cmNlKVxuXG4gICAgICAgICAgaWYgKGhpdFRlc3RSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgY29uc3QgaGl0ID0gaGl0VGVzdFJlc3VsdHNbMF1cblxuICAgICAgICAgICAgcmV0aWNsZS52aXNpYmxlID0gdHJ1ZVxuICAgICAgICAgICAgcmV0aWNsZS5tYXRyaXguZnJvbUFycmF5KGhpdC5nZXRQb3NlKHJlZmVyZW5jZVNwYWNlKS50cmFuc2Zvcm0ubWF0cml4KVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXRpY2xlLnZpc2libGUgPSBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBsYXllcikge1xuICAgICAgICBwbGF5ZXIuaGFuZGxlUmVuZGVyKCgpID0+IHtcbiAgICAgICAgICByZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSlcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gIH0sIFtdKVxuXG4gIHZhciBpc1JlY29yZGluZyA9IGZhbHNlXG5cbiAgcmV0dXJuIChcbiAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBvbkNsaWNrPXsoKSA9PiB7fX0+XG4gICAgICBIaVxuICAgIDwvYnV0dG9uPlxuICApXG59XG5cbmV4cG9ydCBkZWZhdWx0IFZpZGVvUmVjb3JkaW5nXG4iXSwibmFtZXMiOlsiUGxheWVyV29ya2VyIl0sIm1hcHBpbmdzIjoiNE9Bd0JBLE9BQWUsT0FDTixjQUFhLEVBQVUsRUFBbUIsR0FBSSxNQUM3QyxHQUFTLFNBQVMsY0FBYyxzQkFFTCxJQUMzQixFQUFZLGFBQWUsT0FBVyxJQUNwQyxHQUFVLFNBQVMsY0FBYyxTQUM3QixNQUFNLFFBQVUsZ0JBQ2YsS0FBSyxZQUFZLE1BRXRCLEdBQU0sU0FBUyxnQkFBZ0IsNkJBQThCLFNBQzdELGFBQWEsUUFBUyxRQUN0QixhQUFhLFNBQVUsUUFDdkIsTUFBTSxTQUFXLGFBQ2pCLE1BQU0sTUFBUSxTQUNkLE1BQU0sSUFBTSxTQUNaLGlCQUFpQixRQUFTLElBQU0sR0FDbkIsVUFFVCxZQUFZLE1BRWhCLEdBQU8sU0FBUyxnQkFBZ0IsNkJBQThCLFVBQzdELGFBQWEsSUFBSyxtQ0FDbEIsYUFBYSxTQUFVLFVBQ3ZCLGFBQWEsY0FBZSxPQUM3QixZQUFZLEdBRVosRUFBWSxtQkFBcUIsV0FDdkIsaUJBQW1CLE1BR3JCLGlCQUFpQixLQUFLLGlCQUN0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
